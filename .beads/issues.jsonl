{"id":"mlx-tts-0i3","title":"Update discover_voices() to find .safetensors files","description":"Extend voice discovery in tts_config.py to recognize pre-computed voice embeddings alongside WAV files.\n\n## Background\nWith clone_voice.py generating .safetensors files, the voice discovery system needs to find both formats.\n\n## Requirements\n- Modify discover_voices() to glob both *.wav and *.safetensors in assets/\n- Deduplicate if both formats exist for same voice name (prefer safetensors)\n- Update resolve_voice_path() to return correct path based on available format\n- Maintain security validation (no path traversal, alphanumeric names only)\n\n## Files to Modify\n- scripts/tts_config.py: discover_voices(), resolve_voice_path()\n\n## Testing\n- **MANDATORY: Use /tdd-cycle for implementation**\n- Test discovery with mixed formats\n- Test preference logic when both exist\n- Test security validation still works","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T18:18:55.282391-08:00","updated_at":"2025-12-26T18:34:49.758985-08:00","closed_at":"2025-12-26T18:34:49.758985-08:00","close_reason":"Superseded by detailed sub-tasks under mlx-tts-6j9 epic"}
{"id":"mlx-tts-19j","title":"2.4 Create voice selector widget","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:19.189219-08:00","updated_at":"2025-12-26T13:30:39.134819-08:00","deleted_at":"2025-12-26T13:30:39.134819-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-1gi","title":"Update mlx_tts_core to load pre-computed safetensors directly","description":"Modify the TTS core to load voice embeddings directly from .safetensors files when available, bypassing WAV extraction.\n\n## Background\nWhen a voice is shipped as pre-computed .safetensors, we should load it directly instead of looking for a WAV to extract from.\n\n## Requirements\n- Detect voice format (.wav vs .safetensors) in generate_speech flow\n- For .safetensors: load conditionals directly using voice_cache.load_conditionals() logic\n- For .wav: use existing get_or_prepare_conditionals() flow (extract + cache)\n- Inject loaded conditionals into model before generation\n\n## Technical Details\n- May need to add load_conditionals_direct(safetensors_path) to voice_cache.py\n- The model.generate() needs conditionals set via model._conds or similar\n- Check if model.prepare_conditionals() can accept pre-loaded Conditionals\n\n## Files to Modify\n- scripts/mlx_tts_core.py: _generate_streaming_with_metrics()\n- scripts/voice_cache.py: possibly add direct load function\n\n## Testing\n- **MANDATORY: Use /tdd-cycle for implementation**\n- Test loading from safetensors produces same output as WAV extraction\n- Test fallback to WAV when safetensors missing\n- Integration test with real TTS generation","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T18:19:07.022413-08:00","updated_at":"2025-12-26T18:34:49.760544-08:00","closed_at":"2025-12-26T18:34:49.760544-08:00","close_reason":"Superseded by detailed sub-tasks under mlx-tts-6j9 epic","dependencies":[{"issue_id":"mlx-tts-1gi","depends_on_id":"mlx-tts-1yl","type":"blocks","created_at":"2025-12-26T18:19:14.696077-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-1gi","depends_on_id":"mlx-tts-0i3","type":"blocks","created_at":"2025-12-26T18:19:14.723124-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-1if","title":"Implement bidirectional interpolation (modify both chunk ends)","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nCurrent interpolation only modifies the START of each chunk to match the previous chunk's end. This task explores modifying BOTH ends - also adjusting the END of each chunk to better connect to the next.\n\n## Technical Background\n\nCurrent approach (unidirectional):\n```\nChunk N:   [.......prev_last]\nChunk N+1: [curr_first.......]\n            â†‘ Only this is modified to approach prev_last\n```\n\nBidirectional approach:\n```\nChunk N:   [.......prev_last]  â† Also modify to approach predicted next value\nChunk N+1: [curr_first.......]  â† Modify to approach prev_last\n```\n\n## Implementation Challenge\n\nWe don't know `curr_first` of the next chunk until we receive it. Solutions:\n\n### Option A: One-chunk delay buffer\n- Buffer each chunk\n- When next chunk arrives, modify end of buffered chunk based on next chunk's start\n- Output the modified buffered chunk\n- Trade-off: Adds ~0.5s latency\n\n### Option B: Predictive fade\n- Fade the last N samples of each chunk toward zero or toward running average\n- Less accurate but no added latency\n```python\n# Fade end of chunk toward predicted continuation\nfade_samples = 32\nfade_curve = np.linspace(1.0, 0.8, fade_samples)  # Partial fade\naudio_f32[-fade_samples:] *= fade_curve\n```\n\n### Option C: Symmetric interpolation (both ends fade to/from midpoint)\n- Start of chunk: interpolate from prev_last to actual value\n- End of chunk: interpolate from actual value toward running average\n- Both use symmetric window functions\n\n## Implementation Location\n`scripts/audio_processor.py` in `create_processor()` function\n\n## Files to Modify\n- `scripts/audio_processor.py` - Add end-of-chunk processing\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Unit test: Verify end-of-chunk modification is applied correctly\n2. Unit test: Verify chunk delay (if using Option A) maintains sample accuracy\n3. Integration test: Compare A/B with current unidirectional approach\n4. Latency measurement: Ensure TTFT impact is acceptable\n\n## Success Criteria\n- Improved audio quality over unidirectional approach\n- If using buffer approach, latency increase documented and acceptable\n- No audio artifacts introduced by end-of-chunk modification\n\n## Notes\n- This could be combined with start-of-chunk interpolation\n- Consider testing with and without start interpolation to isolate effect","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-28T18:52:29.657358-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.880708-08:00","deleted_at":"2025-12-28T18:56:28.880708-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-1qu","title":"Add logging to tts-notify.py","description":"## Decision\nLog file location: logs/tts-notify.log\n\n## Rationale\n- Fully contained within plugin directory (no external paths)\n- Conventional logs/ directory name\n- Discoverable for debugging\n- Filename matches script name (tts-notify.py â†’ tts-notify.log)\n\n## Implementation\n1. Create logs/ directory if not exists\n2. Add file logging to scripts/tts-notify.py\n3. Log hook invocations, threshold checks, TTS events\n\n## Already done\n- .gitignore updated to exclude logs/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:42:07.067722-08:00","updated_at":"2025-12-24T15:55:01.574085-08:00","closed_at":"2025-12-24T15:55:01.574085-08:00","close_reason":"Implemented file logging to logs/tts-notify.log. Logs hook invocations, threshold checks, TTS engine selection, and errors."}
{"id":"mlx-tts-1y3","title":"Hook playback uses wrong voice compressor/limiter settings","description":"## Bug Description\n\nHook playback (permission notifications, etc.) sounds significantly louder than Voice Lab previews for the same voice. For example, c3po sounds good in Voice Lab but blasts at much louder volume via permission hooks.\n\n## Root Cause\n\nThe audio processor reads compressor/limiter settings from the **active voice** instead of the **hook voice** being played.\n\n### Bug Location\n\n**mlx_server_utils.py:295** - `speak_mlx_http()`:\n```python\nprocessor = create_processor(sample_rate=samplerate)  # BUG: No voice context\n```\n\nThe `voice` parameter is available (line 204) but not passed to the processor.\n\n**mlx_tts_core.py:270** - `_generate_streaming_with_metrics()`:\nSame issue - `voice_name` is available but `create_processor()` is called without it.\n\n### Evidence\n\nGain difference between c3po and default:\n- **c3po**: input -6 + gain 4 + master -3 = **-5 dB total**\n- **default**: input +3 + gain +8 + master +6 = **+17 dB total**\n\nThat's a **22 dB difference** - explaining the volume blast.\n\n## Fix Required\n\nUse `get_effective_compressor(voice)` and `get_effective_limiter(voice)` to read the correct voice's settings, then pass all parameters explicitly to `create_processor()`.\n\nHelper functions already exist:\n- `tts_config.get_effective_compressor(voice_name)` \n- `tts_config.get_effective_limiter(voice_name)`\n\n## Files to Modify\n\n1. `scripts/mlx_server_utils.py` - `speak_mlx_http()` function (line ~295)\n2. `scripts/mlx_tts_core.py` - `_generate_streaming_with_metrics()` function (line ~270)\n\n## Implementation Notes\n\n- There is ongoing streaming rework - coordinate to avoid conflicts\n- **MANDATORY: Use /tdd-cycle for implementation**\n- Write tests first that verify voice-specific settings are used","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T12:00:05.142891-08:00","created_by":"agrande","updated_at":"2025-12-28T15:10:08.782561-08:00","closed_at":"2025-12-28T14:46:43.373959-08:00"}
{"id":"mlx-tts-1yl","title":"Add clone_voice.py script to pre-compute voice embeddings from WAV files","description":"Create a CLI script that extracts voice conditionals from a WAV file and saves them as .safetensors for distribution.\n\n## Background\nCurrently voice cloning requires shipping ~1MB WAV files. Pre-computed embeddings are ~160KB (6x smaller) and eliminate runtime extraction overhead.\n\n## Requirements\n- Accept input WAV path and output voice name\n- Load MLX model and extract conditionals using model.prepare_conditionals()\n- Save to assets/{voice_name}.safetensors using mx.save_safetensors()\n- Validate input file exists and is valid audio\n- Print success message with file sizes (before/after)\n\n## Implementation Notes\n- Reuse flatten logic from voice_cache.py save_conditionals()\n- Consider adding --output-dir option for flexibility\n- Exit with proper error codes\n\n## Testing\n- **MANDATORY: Use /tdd-cycle for implementation**\n- Unit tests for validation logic\n- Integration test with real model + sample WAV","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T18:18:44.794011-08:00","updated_at":"2025-12-26T18:34:49.7576-08:00","closed_at":"2025-12-26T18:34:49.7576-08:00","close_reason":"Superseded by detailed sub-tasks under mlx-tts-6j9 epic"}
{"id":"mlx-tts-26u","title":"Add in-memory voice cache to HTTP server","description":"## Description\nUpdate `scripts/mlx_server_utils.py` to keep voice conditionals in memory for even faster access.\n\n## Implementation\nUse `/tdd-cycle` skill for TDD implementation.\n\n### Server-side caching strategy:\n1. Disk cache: ~/.cache/claude-mlx-tts/voice_conds/\n2. Memory cache: dict in server process\n\n### Flow:\n```\nRequest with voice_ref\n    â†“\nCheck memory cache â†’ HIT â†’ use immediately\n    â†“ MISS\nCheck disk cache â†’ HIT â†’ load to memory, use\n    â†“ MISS  \nExtract conditionals â†’ save to disk â†’ save to memory â†’ use\n```\n\n### Implementation in server:\n```python\n# Module-level memory cache\n_voice_memory_cache: dict[str, Conditionals] = {}\n\ndef get_cached_conditionals(model, voice_ref: str) -\u003e None:\n    '''Get conditionals from memory \u003e disk \u003e extract.'''\n    cache_key = get_cache_key(voice_ref)\n    \n    if cache_key in _voice_memory_cache:\n        model._conds = _voice_memory_cache[cache_key]\n        return\n    \n    # Try disk, then extract\n    voice_cache.get_or_prepare_conditionals(model, voice_ref)\n    _voice_memory_cache[cache_key] = model._conds\n```\n\n## Acceptance Criteria\n- [ ] Memory cache eliminates disk I/O after first load\n- [ ] Works across multiple requests to same voice\n- [ ] Server restart reloads from disk cache\n- [ ] Memory efficient (conditionals are small ~161KB)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T19:30:10.407006-08:00","updated_at":"2025-12-25T20:07:32.13802-08:00","closed_at":"2025-12-25T20:07:32.138023-08:00","dependencies":[{"issue_id":"mlx-tts-26u","depends_on_id":"mlx-tts-7ex","type":"blocks","created_at":"2025-12-25T19:30:18.553232-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-27o","title":"Phase 1: Config Schema \u0026 Persistence","description":"Update tts_config.py with new per-voice schema. Implement get_voice_config/set_voice_config, voice discovery from assets/*.wav, and active voice management.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:28:37.5365-08:00","updated_at":"2025-12-26T13:30:39.12597-08:00","dependencies":[{"issue_id":"mlx-tts-27o","depends_on_id":"mlx-tts-z1k","type":"blocks","created_at":"2025-12-26T13:28:49.814651-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-27o","depends_on_id":"mlx-tts-6pi","type":"blocks","created_at":"2025-12-26T13:29:18.493032-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-27o","depends_on_id":"mlx-tts-a1f","type":"blocks","created_at":"2025-12-26T13:29:18.517154-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-27o","depends_on_id":"mlx-tts-5bq","type":"blocks","created_at":"2025-12-26T13:29:18.544824-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-27o","depends_on_id":"mlx-tts-6j5","type":"blocks","created_at":"2025-12-26T13:29:18.569398-08:00","created_by":"daemon"}],"deleted_at":"2025-12-26T13:30:39.12597-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-2es","title":"3.3 Add threshold/ratio/gain sliders","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:33.011534-08:00","updated_at":"2025-12-26T13:30:39.136067-08:00","deleted_at":"2025-12-26T13:30:39.136067-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-2ku","title":"2.3 Implement screen navigation (Voice Lab, System, About)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:19.035492-08:00","updated_at":"2025-12-26T13:30:39.134397-08:00","deleted_at":"2025-12-26T13:30:39.134397-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-2v5","title":"Add streaming-aware TTS logging with TTFT measurement","description":"## Goal\n\nAdd comprehensive timing metrics while **preserving streaming playback**:\n- TTFT (time to first audio chunk queued)\n- Total generation time  \n- Total playback time\n- RTF and other GenerationResult metrics\n\n## Implementation Approach\n\nReplace `generate_audio()` with direct `model.generate()` + `AudioPlayer`:\n\n```python\nfrom mlx_audio.tts.audio_player import AudioPlayer\n\ngen_start = time.perf_counter()\nplayer = AudioPlayer(sample_rate=model.sample_rate) if play else None\n\nttft = None\nfor result in model.generate(text, stream=True, streaming_interval=0.5):\n    if ttft is None:\n        ttft = time.perf_counter() - gen_start  # TTFT captured\n    if player:\n        player.queue_audio(result.audio)  # Streaming preserved\n\ngen_time = time.perf_counter() - gen_start\nif player:\n    play_start = time.perf_counter()\n    player.wait_for_drain()\n    play_time = time.perf_counter() - play_start\n\nlog.info(f\"TTS: ttft={ttft:.2f}s gen={gen_time:.2f}s play={play_time:.2f}s chunks={chunk_count}\")\n```\n\n## Expected Log Output\n\n```\nTTS: ttft=0.26s gen=2.45s play=0.12s chunks=7 RTF=0.58\n```\n\n## Metrics Captured\n\n| Metric | Description |\n|--------|-------------|\n| ttft | Time to first chunk generated |\n| gen | Total generation time (all chunks) |\n| play | Time waiting for playback drain |\n| chunks | Number of streaming chunks |\n| RTF | Real-time factor |\n\n## Files to Modify\n\n- `scripts/mlx_tts_core.py` - Replace `generate_audio()` with direct streaming loop\n\n## Implementation Requirements\n\nâš ï¸ **Use `/tdd-cycle` skill** when implementing this feature. Write tests first, then implement.\n\n## Acceptance Criteria\n\n- [ ] TTFT measured and logged for streaming mode\n- [ ] Generation time separate from playback time\n- [ ] Streaming playback NOT broken (audio starts before full generation)\n- [ ] RTF and chunk count logged\n- [ ] Tests verify metrics are captured correctly","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-26T10:56:10.242185-08:00","updated_at":"2025-12-26T11:12:22.618784-08:00","closed_at":"2025-12-26T11:12:22.618784-08:00","close_reason":"Implemented streaming metrics with TTFT, gen_time, play_time, chunks, rtf, and audio_duration. All 25 tests pass."}
{"id":"mlx-tts-2yv","title":"Per-project voice customization","description":"## Overview\nSupport per-project voice profiles. All config lives in plugin config file, not CLAUDE.md or env vars.\n\n## Future Scope\n- Project-specific voice selection within plugin config\n- Project detection and config switching\n\n## Status\n**Deferred**: TUI (mlx-tts-tzk) implements global default first. Config schema designed for future per-project extension.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-25T19:08:27.22017-08:00","updated_at":"2025-12-26T13:39:15.093904-08:00","dependencies":[{"issue_id":"mlx-tts-2yv","depends_on_id":"mlx-tts-tzk","type":"blocks","created_at":"2025-12-26T13:38:05.443838-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-31t","title":"Add playback normalization for TTS output","description":"## Problem\n\nChatterbox TTS outputs **very quiet audio** (-27.7 LUFS) requiring +12 dB gain to reach broadcast standard (-16 LUFS).\n\n## Measurements (Chatterbox-Turbo)\n\n| Metric | Current Output | Target | Gap |\n|--------|----------------|--------|-----|\n| LUFS | -27.7 | -16 | **+12 dB** |\n| Peak | -11.4 dBFS | - | 11 dB headroom |\n| RMS | -28.3 dBFS | - | - |\n\n## Solution\n\nTwo normalization modes depending on playback type:\n\n### 1. Streaming Mode (Fixed Gain)\n\nFor streaming playback, apply **fixed +12 dB gain** per chunk:\n\n```python\nSTREAMING_GAIN_DB = 12.0\ngain_linear = 10 ** (STREAMING_GAIN_DB / 20)  # ~4x\n\n# Per-chunk normalization (zero latency overhead)\nchunk_normalized = chunk * gain_linear\n```\n\nWhy fixed gain works:\n- Chatterbox output levels are **consistent** (same voice reference)\n- Peak at -11.4 dBFS leaves headroom â†’ +12 dB wont clip\n- No per-chunk LUFS measurement needed â†’ zero latency\n\n### 2. Non-Streaming Mode (LUFS)\n\nFor file output or non-streaming playback, use proper LUFS normalization:\n\n```python\nimport pyloudnorm as pyln\n\nTARGET_LUFS = -16.0\nmeter = pyln.Meter(samplerate)\nloudness = meter.integrated_loudness(data)\nif loudness \u003e -70:  # Avoid normalizing silence\n    data = pyln.normalize.loudness(data, loudness, TARGET_LUFS)\n```\n\n## Implementation Requirements\n\nâš ï¸ **Use `/tdd-cycle` skill** when implementing this feature. Write tests first, then implement.\n\n## Acceptance Criteria\n\n- [ ] Add fixed-gain normalization for streaming mode (+12 dB)\n- [ ] Add LUFS normalization for non-streaming/file mode (target -16 LUFS)\n- [ ] Make gain value configurable\n- [ ] Graceful handling of silence/very quiet audio\n- [ ] Add tests verifying normalized output levels","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T09:39:11.030426-08:00","updated_at":"2025-12-26T10:14:38.596596-08:00","closed_at":"2025-12-26T10:14:38.596596-08:00","close_reason":"Superseded by mlx-tts-w4b (dynamic compression). Compressor + limiter + gain handles normalization as part of the processing chain.","dependencies":[{"issue_id":"mlx-tts-31t","depends_on_id":"mlx-tts-r2h","type":"blocks","created_at":"2025-12-26T09:57:20.705216-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-36a","title":"voice_cache.py: Add direct safetensors loading","description":"Add functions to load pre-computed embeddings directly from .safetensors files.\n\n## Parent Epic\nmlx-tts-6j9: Voice Embedding Convention System\n\n## Requirements\n\n### .1.1 - load_conditionals_from_file(path)\nNew function that loads safetensors directly without requiring a source WAV reference:\n```python\ndef load_conditionals_from_file(safetensors_path: Path) -\u003e Conditionals:\n    \"\"\"Load pre-computed conditionals from safetensors file.\"\"\"\n    arrays = mx.load(str(safetensors_path))\n    # Reconstruct T3Cond and gen dict (same as load_conditionals)\n    ...\n```\n\n### .1.2 - get_voice_conditionals(model, voice_name)\nUnified entry point - format-agnostic loading by name:\n```python\ndef get_voice_conditionals(model: Any, voice_name: str) -\u003e Conditionals:\n    assets = Path(__file__).parent.parent / \"assets\"\n    \n    # Priority 1: Pre-computed safetensors\n    safetensors_path = assets / f\"{voice_name}.safetensors\"\n    if safetensors_path.exists():\n        return load_conditionals_from_file(safetensors_path)\n    \n    # Priority 2: WAV with cache fallback\n    wav_path = assets / f\"{voice_name}.wav\"\n    if wav_path.exists():\n        return get_or_prepare_conditionals(model, str(wav_path))\n    \n    raise ValueError(f\"No voice files found for: {voice_name}\")\n```\n\n## Files to Modify\n- scripts/voice_cache.py\n\n## Testing\n**MANDATORY: Use /tdd-cycle**\n- Test load_conditionals_from_file with valid safetensors\n- Test get_voice_conditionals priority (safetensors \u003e wav)\n- Test error handling for missing voice\n- Test that loaded conditionals match extracted ones","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:33:08.239671-08:00","updated_at":"2025-12-26T18:40:27.313212-08:00","closed_at":"2025-12-26T18:40:27.313212-08:00","close_reason":"Closed"}
{"id":"mlx-tts-48c","title":"Prompt Lab: Hook Prompt Customization","description":"# Prompt Lab: Hook Prompt Customization\n\nRename the 'Hooks' tab to 'Prompt Lab' and add prompt customization for each hook type.\n\n## Overview\n\n- **Stop hook**: Customize the \"attention grabber\" phrase that plays before the AI-generated summary\n- **Permission hook**: Customize the full spoken phrase (with {tool_name} placeholder)\n\n## UI Wireframe\n\n```\nâ”Œâ”€ Stop (completion) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Voice:             [-- inherit -- â–¼]                     â”‚\nâ”‚ Attention Grabber: [[clear throat] Attention on deck.  ]â”‚\nâ”‚                                                          â”‚\nâ”‚ Plays before the AI-generated summary          [Reset]  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€ Permission Request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Voice:  [-- inherit -- â–¼]                                â”‚\nâ”‚ Phrase: [Claude needs permission to run {tool_name}.    ]â”‚\nâ”‚                                                          â”‚\nâ”‚ Use {tool_name} for the tool name              [Reset]  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Default Prompts\n\n| Hook | Default |\n|------|---------|\n| Stop | `[clear throat] Attention on deck.` |\n| Permission | `Claude needs permission to run {tool_name}.` |\n\n## Files Affected\n\n- `scripts/tts_config.py` - Config layer\n- `scripts/tts_tui.py` - UI changes\n- `scripts/tts-notify.py` - Stop hook integration\n- `hooks/permission-notify.py` - Permission hook integration","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T16:14:56.327225-08:00","updated_at":"2025-12-27T16:37:37.410682-08:00","closed_at":"2025-12-27T16:37:37.410682-08:00","close_reason":"Closed"}
{"id":"mlx-tts-48c.1","title":"Config layer for hook prompts","description":"# Config Layer for Hook Prompts\n\nAdd configuration functions to manage hook-specific prompts in `scripts/tts_config.py`.\n\n## New Constants\n\n```python\nHOOK_DEFAULT_PROMPTS = {\n    \"stop\": \"[clear throat] Attention on deck.\",\n    \"permission_request\": \"Claude needs permission to run {tool_name}.\",\n}\n```\n\n## New Functions\n\n```python\ndef get_default_hook_prompt(hook_type: str) -\u003e str:\n    \"\"\"Return the default prompt for a hook type.\"\"\"\n\ndef get_hook_prompt(hook_type: str) -\u003e str | None:\n    \"\"\"Return custom prompt override, or None if using default.\"\"\"\n\ndef set_hook_prompt(hook_type: str, prompt: str | None) -\u003e None:\n    \"\"\"Set custom prompt for hook. None clears to default.\"\"\"\n\ndef get_effective_hook_prompt(hook_type: str) -\u003e str:\n    \"\"\"Return custom prompt if set, otherwise default.\"\"\"\n```\n\n## Config Schema Extension\n\n```json\n{\n  \"hooks\": {\n    \"stop\": {\n      \"voice\": \"voice_name\",\n      \"prompt\": \"[clear throat] Attention on deck.\"\n    }\n  }\n}\n```\n\n## TDD Approach\n\nUse `/tdd-cycle` skill for implementation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:16:09.529208-08:00","updated_at":"2025-12-27T16:34:02.776168-08:00","closed_at":"2025-12-27T16:34:02.776168-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.1","depends_on_id":"mlx-tts-48c","type":"parent-child","created_at":"2025-12-27T16:16:09.532699-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.1.1","title":"Add HOOK_DEFAULT_PROMPTS constant","description":"# Add HOOK_DEFAULT_PROMPTS Constant\n\nAdd default prompts constant to `scripts/tts_config.py`.\n\n## Implementation\n\n```python\nHOOK_DEFAULT_PROMPTS: dict[str, str] = {\n    \"stop\": \"[clear throat] Attention on deck.\",\n    \"permission_request\": \"Claude needs permission to run {tool_name}.\",\n}\n```\n\nPlace near other hook-related constants (after `HOOK_TYPES`).\n\n## TDD: Write test first\n\n```python\ndef test_hook_default_prompts_has_all_hook_types():\n    from tts_config import HOOK_DEFAULT_PROMPTS, HOOK_TYPES\n    for hook_type in HOOK_TYPES:\n        assert hook_type in HOOK_DEFAULT_PROMPTS\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:18:26.172061-08:00","updated_at":"2025-12-27T16:34:02.771242-08:00","closed_at":"2025-12-27T16:34:02.771242-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.1.1","depends_on_id":"mlx-tts-48c.1","type":"parent-child","created_at":"2025-12-27T16:18:26.172512-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.1.2","title":"Add get_default_hook_prompt function","description":"# Add get_default_hook_prompt Function\n\nAdd function to retrieve default prompt for a hook type.\n\n## Implementation\n\n```python\ndef get_default_hook_prompt(hook_type: str) -\u003e str:\n    \"\"\"Return the default prompt for a hook type.\n    \n    Args:\n        hook_type: One of HOOK_TYPES (e.g., \"stop\", \"permission_request\")\n    \n    Returns:\n        The default prompt string for that hook type.\n    \n    Raises:\n        ValueError: If hook_type is not recognized.\n    \"\"\"\n    if hook_type not in HOOK_DEFAULT_PROMPTS:\n        raise ValueError(f\"Unknown hook type: {hook_type}\")\n    return HOOK_DEFAULT_PROMPTS[hook_type]\n```\n\n## TDD: Write tests first\n\n```python\ndef test_get_default_hook_prompt_stop():\n    assert \"[clear throat]\" in get_default_hook_prompt(\"stop\")\n\ndef test_get_default_hook_prompt_permission():\n    assert \"{tool_name}\" in get_default_hook_prompt(\"permission_request\")\n\ndef test_get_default_hook_prompt_invalid():\n    with pytest.raises(ValueError):\n        get_default_hook_prompt(\"invalid_hook\")\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:18:33.928352-08:00","updated_at":"2025-12-27T16:34:02.772609-08:00","closed_at":"2025-12-27T16:34:02.772609-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.1.2","depends_on_id":"mlx-tts-48c.1","type":"parent-child","created_at":"2025-12-27T16:18:33.928764-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.1.3","title":"Add get/set_hook_prompt functions","description":"# Add get/set_hook_prompt Functions\n\nAdd functions to read/write custom hook prompts to config.\n\n## Implementation\n\n```python\ndef get_hook_prompt(hook_type: str) -\u003e str | None:\n    \"\"\"Return custom prompt override, or None if using default.\n    \n    Args:\n        hook_type: One of HOOK_TYPES\n    \n    Returns:\n        Custom prompt string if set, None otherwise.\n    \"\"\"\n    config = load_config()\n    hooks = config.get(\"hooks\", {})\n    hook_config = hooks.get(hook_type, {})\n    return hook_config.get(\"prompt\")\n\n\ndef set_hook_prompt(hook_type: str, prompt: str | None) -\u003e None:\n    \"\"\"Set custom prompt for hook. None clears to default.\n    \n    Args:\n        hook_type: One of HOOK_TYPES\n        prompt: Custom prompt string, or None to clear\n    \"\"\"\n    if hook_type not in HOOK_TYPES:\n        raise ValueError(f\"Unknown hook type: {hook_type}\")\n    \n    config = load_config()\n    if \"hooks\" not in config:\n        config[\"hooks\"] = {}\n    if hook_type not in config[\"hooks\"]:\n        config[\"hooks\"][hook_type] = {}\n    \n    if prompt is None:\n        config[\"hooks\"][hook_type].pop(\"prompt\", None)\n    else:\n        config[\"hooks\"][hook_type][\"prompt\"] = prompt\n    \n    save_config(config)\n```\n\n## TDD: Write tests first\n\n```python\ndef test_get_hook_prompt_returns_none_when_not_set(tmp_config):\n    assert get_hook_prompt(\"stop\") is None\n\ndef test_set_and_get_hook_prompt(tmp_config):\n    set_hook_prompt(\"stop\", \"Hey!\")\n    assert get_hook_prompt(\"stop\") == \"Hey!\"\n\ndef test_set_hook_prompt_none_clears(tmp_config):\n    set_hook_prompt(\"stop\", \"Hey!\")\n    set_hook_prompt(\"stop\", None)\n    assert get_hook_prompt(\"stop\") is None\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:18:43.682302-08:00","updated_at":"2025-12-27T16:34:02.773657-08:00","closed_at":"2025-12-27T16:34:02.773657-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.1.3","depends_on_id":"mlx-tts-48c.1","type":"parent-child","created_at":"2025-12-27T16:18:43.685991-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.1.4","title":"Add get_effective_hook_prompt function","description":"# Add get_effective_hook_prompt Function\n\nAdd function that returns custom prompt if set, otherwise default.\n\n## Implementation\n\n```python\ndef get_effective_hook_prompt(hook_type: str) -\u003e str:\n    \"\"\"Return custom prompt if set, otherwise default.\n    \n    This is the main function hook scripts should call.\n    \n    Args:\n        hook_type: One of HOOK_TYPES\n    \n    Returns:\n        The effective prompt string (custom or default).\n    \"\"\"\n    custom = get_hook_prompt(hook_type)\n    if custom is not None:\n        return custom\n    return get_default_hook_prompt(hook_type)\n```\n\n## TDD: Write tests first\n\n```python\ndef test_get_effective_hook_prompt_returns_default_when_not_set(tmp_config):\n    result = get_effective_hook_prompt(\"stop\")\n    assert result == get_default_hook_prompt(\"stop\")\n\ndef test_get_effective_hook_prompt_returns_custom_when_set(tmp_config):\n    set_hook_prompt(\"stop\", \"Listen up!\")\n    result = get_effective_hook_prompt(\"stop\")\n    assert result == \"Listen up!\"\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:18:53.415847-08:00","updated_at":"2025-12-27T16:34:02.77482-08:00","closed_at":"2025-12-27T16:34:02.77482-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.1.4","depends_on_id":"mlx-tts-48c.1","type":"parent-child","created_at":"2025-12-27T16:18:53.418158-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.2","title":"UI: Refactor HookSettingsWidget with prompt fields","description":"# UI: Refactor HookSettingsWidget\n\nRefactor `HookVoiceSelector` to `HookSettingsWidget` with prompt customization in `scripts/tts_tui.py`.\n\n## Widget Structure\n\nUse Textual's `Container` with `border` and `border_title` for each hook section:\n\n```\nContainer(border=\"round\", border_title=\"Stop (completion)\")\nâ”œâ”€ Horizontal\nâ”‚  â”œâ”€ Label(\"Voice:\")\nâ”‚  â””â”€ Select(voices)\nâ”œâ”€ Horizontal\nâ”‚  â”œâ”€ Label(\"Attention Grabber:\")\nâ”‚  â””â”€ Input(prompt)\nâ”œâ”€ Horizontal\nâ”‚  â”œâ”€ Static(help_text, classes=\"muted\")\nâ”‚  â””â”€ Button(\"Reset\")\n```\n\n## Changes\n\n1. Rename `HookVoiceSelector` â†’ `HookSettingsWidget`\n2. Add `Input` field for prompt/attention grabber\n3. Add `Reset` button (resets prompt only, not voice)\n4. Add help text per hook type:\n   - Stop: \"Plays before the AI-generated summary\"\n   - Permission: \"Use {tool_name} for the tool name\"\n\n## TDD Approach\n\nUse `/tdd-cycle` skill for implementation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:17:58.265621-08:00","updated_at":"2025-12-27T16:37:37.409684-08:00","closed_at":"2025-12-27T16:37:37.409684-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.2","depends_on_id":"mlx-tts-48c","type":"parent-child","created_at":"2025-12-27T16:17:58.269197-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.2.1","title":"Create bordered Container layout per hook","description":"# Create Bordered Container Layout\n\nUpdate widget to use Textual's `Container` with `border` and `border_title`.\n\n## Current Layout\n\n```python\nclass HookVoiceSelector(Static):\n    # Flat layout with labels and selects\n```\n\n## New Layout\n\n```python\nclass HookSettingsWidget(Container):\n    DEFAULT_CSS = \"\"\"\n    HookSettingsWidget {\n        height: auto;\n        margin-bottom: 1;\n    }\n    HookSettingsWidget \u003e Container {\n        border: round $accent;\n        padding: 1;\n        height: auto;\n    }\n    \"\"\"\n    \n    def compose(self) -\u003e ComposeResult:\n        with Container() as c:\n            c.border_title = HOOK_LABELS[self.hook_type]\n            # ... fields inside\n```\n\n## Wireframe\n\n```\nâ”Œâ”€ Stop (completion) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Voice:             [-- inherit -- â–¼]                     â”‚\nâ”‚ Attention Grabber: [                                    ]â”‚\nâ”‚ Plays before the AI-generated summary          [Reset]  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:19:30.795037-08:00","updated_at":"2025-12-27T16:37:37.40592-08:00","closed_at":"2025-12-27T16:37:37.40592-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.2.1","depends_on_id":"mlx-tts-48c.2","type":"parent-child","created_at":"2025-12-27T16:19:30.795538-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.2.2","title":"Add prompt Input field with dynamic label","description":"# Add Prompt Input Field\n\nAdd text input for prompt customization with hook-specific labels.\n\n## Labels Per Hook\n\n```python\nHOOK_PROMPT_LABELS = {\n    \"stop\": \"Attention Grabber\",\n    \"permission_request\": \"Phrase\",\n}\n```\n\n## Implementation\n\n```python\n# In compose():\nwith Horizontal():\n    yield Label(HOOK_PROMPT_LABELS[self.hook_type] + \":\")\n    yield Input(\n        value=get_effective_hook_prompt(self.hook_type),\n        id=f\"prompt-{self.hook_type}\",\n    )\n```\n\n## Behavior\n\n- On change: Call `set_hook_prompt(hook_type, value)`\n- Empty input: Treat as reset to default (call with None)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:19:30.968107-08:00","updated_at":"2025-12-27T16:37:37.40722-08:00","closed_at":"2025-12-27T16:37:37.40722-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.2.2","depends_on_id":"mlx-tts-48c.2","type":"parent-child","created_at":"2025-12-27T16:19:30.968546-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.2.3","title":"Add Reset button and help text","description":"# Add Reset Button and Help Text\n\nAdd Reset button that clears prompt to default, with contextual help.\n\n## Help Text Per Hook\n\n```python\nHOOK_HELP_TEXT = {\n    \"stop\": \"Plays before the AI-generated summary\",\n    \"permission_request\": \"Use {tool_name} for the tool name\",\n}\n```\n\n## Implementation\n\n```python\n# In compose():\nwith Horizontal():\n    yield Static(\n        HOOK_HELP_TEXT[self.hook_type],\n        classes=\"muted\",\n    )\n    yield Button(\"Reset\", id=f\"reset-{self.hook_type}\")\n```\n\n## Reset Behavior\n\n```python\ndef on_button_pressed(self, event: Button.Pressed) -\u003e None:\n    if event.button.id.startswith(\"reset-\"):\n        hook_type = event.button.id.replace(\"reset-\", \"\")\n        set_hook_prompt(hook_type, None)  # Clear to default\n        # Update input field with default value\n        input_field = self.query_one(f\"#prompt-{hook_type}\", Input)\n        input_field.value = get_default_hook_prompt(hook_type)\n        self.notify(\"Reset to default\")\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:19:34.237186-08:00","updated_at":"2025-12-27T16:37:37.408444-08:00","closed_at":"2025-12-27T16:37:37.408444-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-48c.2.3","depends_on_id":"mlx-tts-48c.2","type":"parent-child","created_at":"2025-12-27T16:19:34.240855-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-48c.3","title":"UI: Rename Hooks tab to Prompt Lab","description":"# Rename Hooks Tab to Prompt Lab\n\nSimple rename in `scripts/tts_tui.py`.\n\n## Changes\n\n1. Update `TabPane` title from \"Hooks\" to \"Prompt Lab\"\n2. Update tab ID from \"hooks\" to \"prompt-lab\"\n3. Update keyboard shortcut label in footer\n4. Update any references to the old tab name\n\n## Files\n\n- `scripts/tts_tui.py`\n\n## TDD Approach\n\nUse `/tdd-cycle` skill for implementation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:17:41.416627-08:00","updated_at":"2025-12-27T16:42:11.704421-08:00","closed_at":"2025-12-27T16:42:11.704421-08:00","close_reason":"Already completed as part of mlx-tts-48c.2"}
{"id":"mlx-tts-48c.4","title":"Hook integration: Stop hook reads attention grabber from config","description":"# Stop Hook Integration\n\nUpdate `scripts/tts-notify.py` to read attention grabber from config.\n\n## Current Code (line 52)\n\n```python\nATTENTION_PREFIX = \"[clear throat] Attention on deck.\"\n```\n\n## New Code\n\n```python\nfrom tts_config import get_effective_hook_prompt\n\n# In the message building section:\nattention_grabber = get_effective_hook_prompt(\"stop\")\nmessage = f\"{attention_grabber} ... {summary}\"\n```\n\n## Fallback\n\nKeep hardcoded default as fallback if config import fails (for standalone usage).\n\n## TDD Approach\n\nUse `/tdd-cycle` skill for implementation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:17:41.60283-08:00","updated_at":"2025-12-27T17:27:08.61341-08:00","closed_at":"2025-12-27T17:27:08.61341-08:00","close_reason":"Implemented hook prompt integration from config with fallbacks"}
{"id":"mlx-tts-48c.5","title":"Hook integration: Permission hook reads phrase from config","description":"# Permission Hook Integration\n\nUpdate `hooks/permission-notify.py` to read phrase template from config.\n\n## Current Code (line 233)\n\n```python\nmessage = f\"Claude needs permission to run {tool_name}.\"\n```\n\n## New Code\n\n```python\nfrom tts_config import get_effective_hook_prompt\n\n# In the message building section:\nphrase_template = get_effective_hook_prompt(\"permission_request\")\nmessage = phrase_template.format(tool_name=tool_name)\n```\n\n## Placeholder Support\n\n- `{tool_name}` - The tool being requested (e.g., \"Bash\", \"Write\", \"Edit\")\n\n## Fallback\n\nKeep hardcoded default as fallback if config import fails.\n\n## TDD Approach\n\nUse `/tdd-cycle` skill for implementation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T16:17:41.786506-08:00","updated_at":"2025-12-27T17:27:08.614715-08:00","closed_at":"2025-12-27T17:27:08.614715-08:00","close_reason":"Implemented hook prompt integration from config with fallbacks"}
{"id":"mlx-tts-4hc","title":"Add questionary + platformdirs dependencies","description":"Add optional dependencies for config TUI:\n- questionary: interactive prompts (~100KB)\n- platformdirs: cross-platform config/cache paths (~20KB)\n\nAdd as new optional extra in pyproject.toml:\n```toml\nconfig = [\"questionary\u003e=2.0\", \"platformdirs\u003e=4.0\"]\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T10:13:26.3164-08:00","updated_at":"2025-12-26T10:25:10.397252-08:00","closed_at":"2025-12-26T10:25:10.397252-08:00","close_reason":"Obsolete - using plugin-local .config/ directory instead of platformdirs. Already implemented in tts_config.py","labels":["epic:mlx-tts-tzk"]}
{"id":"mlx-tts-5bq","title":"1.3 Add voice discovery from assets/*.wav","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:08.175263-08:00","updated_at":"2025-12-26T13:30:39.132334-08:00","deleted_at":"2025-12-26T13:30:39.132334-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-5lo","title":"Build Textual TUI for config","description":"Create a Textual-based terminal UI for TTS configuration.\n\nFeatures:\n- Display current settings\n- Speed preset selection\n- Voice selection (macOS voices list)\n- MLX settings (model, voice ref path)\n- Save/cancel with confirmation\n\nEntry point: scripts/tts_tui.py\nInvoke via: /tts-config prompts user to run it","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T10:27:38.27188-08:00","updated_at":"2025-12-26T13:30:44.100872-08:00","labels":["epic:mlx-tts-tzk"],"deleted_at":"2025-12-26T13:30:44.100872-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-5x9","title":"Implement TTS background daemon","description":"## Objective\nImplement TTS server lifecycle management with mlx_audio.server for sub-second response times.\n\n## ğŸ”´ğŸŸ¢ TDD Workflow - Use `/tdd-workflows:tdd-orchestrator` Skill\n\n**IMPORTANT**: This task follows strict TDD discipline. Use the TDD orchestrator skill to guide red-green-refactor cycles.\n\n### How to Execute\n1. Start with: `/tdd-workflows:tdd-orchestrator`\n2. Follow the red-green-refactor discipline the skill enforces\n3. Never write implementation before failing tests\n\n---\n\n## Architecture: Built-in mlx_audio.server (Option B)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP POST        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ tts-notify  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ mlx_audio.server â”‚\nâ”‚   (hook)    â”‚  localhost:21099     â”‚  (keeps model    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  /v1/audio/speech    â”‚     warm)        â”‚\n                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Configuration\n- **Port**: 21099 (avoiding common ports like 9000)\n- **Idle timeout**: 15 min (configurable via TTS_IDLE_TIMEOUT env)\n- **Model**: mlx-community/chatterbox-turbo-fp16 (~4GB)\n\n## Lifecycle\n\n```\nHook fires â†’ Server alive? â”€â”€Yesâ”€â”€â–¶ Send TTS request\n                  â”‚\n                  No\n                  â†“\n            Start server\n            Wait for ready (~10s cold)\n            Preload model via POST /v1/models\n            Send TTS request\n\nServer: Auto-shutdown after 15 min idle\nUser: Can run /tts-stop to reclaim memory immediately\n```\n\n## Implementation Phases (TDD Approach)\n\n### Phase 1: Server Health Check\n**ğŸ”´ Red Phase**\n1. Create `tests/test_server_lifecycle.py`\n2. Test `is_server_alive(port=21099)` function\n3. Test `wait_for_ready(port, timeout)` function\n4. All tests FAIL\n\n**ğŸŸ¢ Green Phase**\n1. Implement health check in `mlx_server_utils.py`\n2. Tests PASS\n\n### Phase 2: Auto-Start Logic\n**ğŸ”´ Red Phase**\n1. Test `ensure_server_running()` starts server if not alive\n2. Test server preloads model after start\n3. All tests FAIL\n\n**ğŸŸ¢ Green Phase**\n1. Implement auto-start with subprocess.Popen\n2. Add model preload via `POST /v1/models`\n3. Tests PASS\n\n### Phase 3: TTS via HTTP\n**ğŸ”´ Red Phase**\n1. Test `speak_mlx_http(text, speed)` sends to server\n2. Test fallback to direct API if server fails\n3. All tests FAIL\n\n**ğŸŸ¢ Green Phase**\n1. Implement HTTP client for `/v1/audio/speech`\n2. Add fallback logic\n3. Tests PASS\n\n### Phase 4: Stop Utility \u0026 Skill\n**ğŸ”µ Refactor Phase**\n1. Create `scripts/tts-stop.sh`\n2. Register `/tts-stop` skill in hooks.json\n3. Optional: `/tts-status` skill\n\n## Key Code\n\n**Server startup:**\n```python\ndef ensure_server_running():\n    if is_server_alive(21099):\n        return\n    \n    subprocess.Popen([\n        sys.executable, \"-m\", \"mlx_audio.server\",\n        \"--port\", \"21099\",\n        \"--idle-timeout\", str(TTS_IDLE_TIMEOUT)\n    ])\n    wait_for_ready(21099, timeout=30)\n    preload_model(\"mlx-community/chatterbox-turbo-fp16\")\n```\n\n**TTS request:**\n```python\ndef speak_mlx_http(text: str, speed: float = 1.6):\n    ensure_server_running()\n    response = requests.post(\n        \"http://localhost:21099/v1/audio/speech\",\n        json={\"text\": text, \"speed\": speed, \"play\": True}\n    )\n```\n\n## Test Cases\n\n```python\ndef test_is_server_alive_returns_false_when_not_running():\n    assert is_server_alive(21099) is False\n\ndef test_ensure_server_starts_when_not_running():\n    ensure_server_running()\n    assert is_server_alive(21099) is True\n\ndef test_speak_mlx_http_warm_latency():\n    ensure_server_running()\n    start = time.time()\n    speak_mlx_http(\"Quick test\")\n    assert time.time() - start \u003c 1.0\n```\n\n## Success Metrics\n- [ ] Warm latency \u003c1s\n- [ ] Cold start \u003c15s (server + model load)\n- [ ] Auto-shutdown after 15 min idle\n- [ ] /tts-stop reclaims memory immediately\n- [ ] Graceful fallback if server fails\n\n## Blocked By\n- mlx-tts-dno (need direct API as fallback)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:51:54.004142-08:00","updated_at":"2025-12-25T15:55:33.688616-08:00","closed_at":"2025-12-25T15:55:33.688616-08:00","close_reason":"All implementation phases complete - server lifecycle management, HTTP TTS, and control skills fully implemented","dependencies":[{"issue_id":"mlx-tts-5x9","depends_on_id":"mlx-tts-dno","type":"blocks","created_at":"2025-12-24T15:52:10.264515-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-603","title":"Implement /tts-config status display command","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T17:45:27.451565-08:00","created_by":"agrande","updated_at":"2025-12-31T17:45:27.451565-08:00","comments":[{"id":5,"issue_id":"mlx-tts-603","author":"agrande","text":"## Overview\n\nThe /tts-config skill should display a comprehensive status view of all TTS configuration, providing users visibility into current settings and a copy-paste command to launch the TUI for interactive configuration.\n\n## Output Format\n\n```\nTTS Configuration\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nVoice Settings\n  Active Voice: scarlett [embedded]\n  Available: alex, c3po, default, jerry, scarlett, snoop\n\nHook Overrides\n  Stop:       scarlett â†’ \"Attention on deck.\"\n  Permission: c3po     â†’ \"Claude needs permission to run {tool_name}.\"\n\nServer Status\n  Status: â— Running\n  Port:   21099\n  Model:  mlx-community/chatterbox-turbo-fp16\n\nAudio Processing (scarlett)\n  Compressor: enabled (input: 0dB, threshold: -18dB, ratio: 4:1, makeup: 8dB)\n  Limiter:    enabled (threshold: -0.3dB)\n  Master:     0dB\n\nConfig: /Users/user/path/to/plugin/.config/config.json\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nOpen TUI in a new terminal:\n  cd /Users/user/path/to/plugin \u0026\u0026 uv run --extra mlx python scripts/tts_tui.py\n```","created_at":"2026-01-01T01:46:20Z"},{"id":6,"issue_id":"mlx-tts-603","author":"agrande","text":"## Data Sources\n\n| Section | Source | API |\n|---------|--------|-----|\n| Active Voice | tts_config.py | get_active_voice() |\n| Available Voices | tts_config.py | discover_voices() + get_voice_format() |\n| Hook Voice Overrides | tts_config.py | get_hook_voice(hook_type) |\n| Hook Prompts | tts_config.py | get_effective_hook_prompt(hook_type) |\n| Server Status | mlx_server_utils.py | is_server_alive(), get_server_status() |\n| Audio Processing | tts_config.py | get_effective_compressor/limiter(voice) |\n| Config Path | tts_config.py | get_config_path() |\n| Plugin Root | Environment | $CLAUDE_PLUGIN_ROOT (resolve to absolute path) |","created_at":"2026-01-01T01:46:29Z"},{"id":7,"issue_id":"mlx-tts-603","author":"agrande","text":"## Implementation Notes\n\n1. **Voice format indicator**: Use get_voice_format() to show [embedded] for .safetensors, [wav] for .wav files\n\n2. **Hook overrides display**:\n   - Show configured voice (or 'default' if inheriting from active voice)\n   - Show effective prompt (custom override or default from HOOK_DEFAULT_PROMPTS)\n   - Hook types to display: 'stop', 'permission_request'\n   - HOOK_LABELS dict has human-friendly names: 'Stop (completion)', 'Permission Request'\n\n3. **Server status indicator**:\n   - â— Running (green) or â—‹ Stopped (dim)\n   - Port from TTS_SERVER_PORT constant (default 21099)\n   - Model from MLX_MODEL constant\n\n4. **Audio processing summary** (for active voice):\n   - Compressor: enabled state + key params (input_gain_db, threshold_db, ratio, gain_db)\n   - Limiter: enabled state + threshold_db  \n   - Master gain from compressor.master_gain_db\n\n5. **TUI command**:\n   - Resolve $CLAUDE_PLUGIN_ROOT to absolute path at runtime\n   - Include --extra mlx flag to ensure textual dependencies are available\n   - Format: cd \u003cresolved_path\u003e \u0026\u0026 uv run --extra mlx python scripts/tts_tui.py","created_at":"2026-01-01T01:46:40Z"},{"id":8,"issue_id":"mlx-tts-603","author":"agrande","text":"## Files to Modify\n\n1. **scripts/tts_config.py**: Add new cmd_full_status() function that outputs the formatted status\n   - Import mlx_server_utils for server status\n   - Use existing getters for all config values\n   - Resolve plugin root path\n\n2. **hooks/hooks.json**: Update tts-config skill\n   - Change instruction to simply display the status output\n   - Point command to the new status function\n\n3. **scripts/tts-config.sh** (if exists): Update to call the Python status function\n\n## NOT Included (Internal Details)\n\nThese should NOT be shown in /tts-config output:\n- streaming_interval (internal optimization parameter)\n- Detailed compressor/limiter parameters beyond the summary\n- Profile system (not user-facing currently)\n- Voice defaults/captured defaults internals","created_at":"2026-01-01T01:46:51Z"},{"id":9,"issue_id":"mlx-tts-603","author":"agrande","text":"## Acceptance Criteria\n\n- [ ] Running /tts-config displays formatted status matching the spec\n- [ ] Active voice shown with format indicator [embedded] or [wav]\n- [ ] All available voices listed\n- [ ] Hook overrides show voice + effective prompt for each hook type\n- [ ] Server status shows running indicator (â— or â—‹), port, model\n- [ ] Audio processing summary shows compressor/limiter state for active voice\n- [ ] Config file path is absolute and resolved\n- [ ] TUI command is fully resolved (no env vars), includes --extra mlx\n- [ ] TUI command works when copy-pasted into a new terminal","created_at":"2026-01-01T01:46:59Z"}]}
{"id":"mlx-tts-69x","title":"4.3 Position limiter as distinct section below compressor","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:43.308687-08:00","updated_at":"2025-12-26T13:30:39.138176-08:00","deleted_at":"2025-12-26T13:30:39.138176-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-6b7","title":"Voice Conditionals Caching - Eliminate per-request voice encoding","description":"## Overview\nImplement voice conditionals caching to eliminate the ~1.5s voice encoding overhead on every TTS request.\n\n## Problem\nCurrently, voice cloning re-processes the reference audio on every invocation:\n- Voice Encoder extracts speaker embedding (~1.5s)\n- S3 tokenizer generates conditioning tokens\n- This happens even for the same voice file\n\n## Solution\nThe mlx_audio API already supports caching via:\n- `model.prepare_conditionals(ref_audio)` - extracts all conditioning\n- `model._conds.save(path)` / `Conditionals.load(path)` - serialization\n- `model.generate()` without ref_audio - uses cached conditionals\n\n## Measured Performance\n| Operation | Time |\n|-----------|------|\n| Extract conditionals | ~1.58s |\n| Load cached conditionals | ~0.0002s (7,900x faster) |\n| Cache file size | 161 KB (vs 960KB audio) |\n\n## Implementation\nUse `/tdd-cycle` skill for each child task to ensure test coverage.\n\n## Acceptance Criteria\n- [ ] First TTS request caches voice conditionals to disk\n- [ ] Subsequent requests load from cache (~0.2ms vs ~1.5s)\n- [ ] Cache invalidates when voice file changes (content hash)\n- [ ] /tts-init bootstraps cache for default voice\n- [ ] Server keeps conditionals in memory for even faster access","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-25T19:29:22.810883-08:00","updated_at":"2025-12-25T20:44:24.095036-08:00","closed_at":"2025-12-25T20:44:24.095036-08:00","close_reason":"All child tasks completed: voice caching implemented, integrated, server updated, bootstrapping added, and tests written","dependencies":[{"issue_id":"mlx-tts-6b7","depends_on_id":"mlx-tts-7ex","type":"blocks","created_at":"2025-12-25T19:30:56.739266-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-6b7","depends_on_id":"mlx-tts-9wg","type":"blocks","created_at":"2025-12-25T19:30:56.811787-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-6b7","depends_on_id":"mlx-tts-9rk","type":"blocks","created_at":"2025-12-25T19:30:56.890113-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-6b7","depends_on_id":"mlx-tts-26u","type":"blocks","created_at":"2025-12-25T19:30:56.962612-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-6b7","depends_on_id":"mlx-tts-ww0","type":"blocks","created_at":"2025-12-25T19:30:57.034449-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-6j5","title":"1.4 Add get_active_voice/set_active_voice","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:08.320797-08:00","updated_at":"2025-12-26T13:30:39.13303-08:00","deleted_at":"2025-12-26T13:30:39.13303-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-6j9","title":"Voice Embedding Convention System - Epic","description":"Implement convention-over-configuration system for voice embeddings.\n\n## Overview\nVoice name is the abstract identifier. File extension determines format:\n- `.safetensors` = pre-computed embeddings (preferred)\n- `.wav` = source audio (extracts on first use, caches)\n\n## Resolution Priority\n1. assets/{name}.safetensors â†’ load directly\n2. assets/{name}.wav â†’ check cache â†’ extract if miss\n3. Error if neither exists\n\n## Key Principles\n- Config stores name only, no format field\n- Processing settings (compressor/limiter) are per-voice\n- Clone Lab outputs only .safetensors (no WAV copy)\n- Single entry point: get_voice_conditionals(model, voice_name)\n\n## Sub-tasks\n\n| ID | Task | Dependencies |\n|----|------|--------------|\n| mlx-tts-36a | voice_cache.py: direct safetensors loading | - |\n| mlx-tts-e6g | tts_config.py: format-aware discovery | - |\n| mlx-tts-awr | mlx_tts_core.py: format-agnostic loading | 36a, e6g |\n| mlx-tts-twa | tts_server.py: pre-load conditionals | 36a |\n| mlx-tts-f6w | tts_tui.py: format indicator | e6g |\n| mlx-tts-n2i | clone_voice.py: CLI script | 36a |\n| mlx-tts-ah7 | Clone Lab TUI tab | n2i, f6w |\n\n## Testing\n**MANDATORY: All sub-tasks must use /tdd-cycle**","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-26T18:32:36.23441-08:00","updated_at":"2025-12-27T06:53:47.627539-08:00","closed_at":"2025-12-27T06:53:47.627539-08:00","close_reason":"All 7 sub-tasks complete. Voice embedding convention system fully implemented with format-agnostic loading, safetensors support, and Clone Lab TUI."}
{"id":"mlx-tts-6pi","title":"1.1 Update tts_config.py with per-voice schema","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:07.88189-08:00","updated_at":"2025-12-26T13:30:39.12888-08:00","deleted_at":"2025-12-26T13:30:39.12888-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-6ye","title":"Implement true end-to-end HTTP streaming for TTS client","description":"## Problem\n\nThe HTTP TTS client path does NOT actually stream audio - it buffers the entire response before playback begins.\n\n### Current Architecture (Broken Streaming)\n\n**Server side** (works correctly):\n- `tts_server.py:157` yields chunks via generator\n- Chunks generated every ~0.5s (configurable via `tts_config.py:11`)\n- Server returns StreamingResponse with chunked transfer encoding\n\n**Client side** (the bottleneck):\n```python\n# mlx_server_utils.py:254,262\nresponse = requests.post(url, json=payload, timeout=timeout)\naudio_data = response.content  # â† BLOCKS until entire response received!\n```\n\nThen plays from buffer:\n```python\n# mlx_server_utils.py:303-304\nsd.play(data, samplerate)  # Plays entire buffer, not streaming\nsd.wait()\n```\n\n### Impact\n\n- User waits for FULL generation time before hearing anything\n- TTFT for HTTP path: ~2.5s+ (full generation)\n- TTFT for Direct API path: ~260ms (true streaming)\n- HTTP path wastes the streaming capability the server provides\n\n### Solution\n\n1. Use `requests.post(..., stream=True)` to get chunked response iterator\n2. Parse WAV chunks as they arrive (handle WAV header separately)\n3. Use `AudioPlayer.queue_audio()` pattern (already proven in mlx_tts_core.py:303)\n4. Maintain stateful audio compression across chunks (audio_processor.py pattern)\n\n### Key Files to Modify\n\n| File | Current | Target |\n|------|---------|--------|\n| mlx_server_utils.py:254 | `requests.post()` | `requests.post(..., stream=True)` |\n| mlx_server_utils.py:262 | `response.content` | `response.iter_content()` loop |\n| mlx_server_utils.py:303 | `sd.play(data)` | `AudioPlayer.queue_audio()` |\n\n### Implementation Mandate\n\n**All implementation tasks MUST use `/tdd-cycle` workflow**:\n1. Write failing test first\n2. Implement minimal code to pass\n3. Refactor while tests pass\n4. Repeat\n\n### Success Criteria\n\n- [ ] HTTP client streams audio chunks as they arrive\n- [ ] TTFT for HTTP path reduced to \u003c500ms (from ~2.5s)\n- [ ] Audio quality identical to current buffered approach\n- [ ] Compression artifacts avoided at chunk boundaries\n- [ ] All tests pass with \u003e90% coverage on new code","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T11:12:01.861498-08:00","created_by":"agrande","updated_at":"2025-12-28T12:12:35.988589-08:00","closed_at":"2025-12-28T12:12:35.988589-08:00","close_reason":"All HTTP streaming tasks complete: WAV parser, streaming client, AudioPlayer integration, and metrics"}
{"id":"mlx-tts-6ye.1","title":"Design streaming WAV chunk parser","description":"## Task: mlx-tts-6ye.1\n\nDesign and implement a streaming WAV parser that can handle chunked audio data.\n\n### Challenge\n\nWAV files have a header (44 bytes typically) followed by raw PCM data. When streaming:\n1. First chunk contains header + some audio\n2. Subsequent chunks are raw PCM only\n3. Must parse header once, then stream remaining data\n\n### Requirements\n\n- Parse WAV header from first chunk\n- Extract sample rate, channels, bit depth\n- Return audio data iterator for subsequent chunks\n- Handle partial chunk boundaries gracefully\n\n### Implementation\n\n**MUST use `/tdd-cycle` workflow**\n\n### Test Cases to Write First\n\n1. Parse valid WAV header from bytes\n2. Handle header split across chunks\n3. Extract correct audio format metadata\n4. Yield audio samples from data chunks\n5. Handle malformed/truncated input gracefully\n\n### Reference\n\n- Current WAV parsing: `mlx_server_utils.py:287` uses `sf.read()` on complete buffer\n- Target: Incremental parsing without full buffer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T11:14:20.166215-08:00","created_by":"agrande","updated_at":"2025-12-28T11:21:42.259015-08:00","closed_at":"2025-12-28T11:21:42.259015-08:00","close_reason":"Implemented StreamingWavParser with 24 passing tests covering header parsing, partial chunk handling, audio iteration, error handling, and streaming integration","dependencies":[{"issue_id":"mlx-tts-6ye.1","depends_on_id":"mlx-tts-6ye","type":"parent-child","created_at":"2025-12-28T11:14:20.168084-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-6ye.2","title":"Implement streaming HTTP client with iter_content","description":"## Task: mlx-tts-6ye.2\n\nRefactor HTTP client to use streaming response iteration.\n\n### Current Code (mlx_server_utils.py:254-262)\n\n```python\nresponse = requests.post(url, json=payload, timeout=timeout)\naudio_data = response.content  # Blocks!\n```\n\n### Target Implementation\n\n```python\nresponse = requests.post(url, json=payload, timeout=timeout, stream=True)\nfor chunk in response.iter_content(chunk_size=8192):\n    # Parse and yield audio data\n    yield process_chunk(chunk)\n```\n\n### Requirements\n\n- Use `stream=True` parameter\n- Use `iter_content()` or `iter_lines()` for chunked reading\n- Integrate with streaming WAV parser (mlx-tts-6ye.1)\n- Maintain timeout handling for first byte\n- Add proper connection cleanup on errors\n\n### Implementation\n\n**MUST use `/tdd-cycle` workflow**\n\n### Dependencies\n\n- Depends on: mlx-tts-6ye.1 (WAV parser)\n\n### Test Cases to Write First\n\n1. Stream response yields chunks\n2. Timeout on slow first byte\n3. Connection cleanup on error\n4. Chunk size handling\n5. Integration with WAV parser","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T11:14:49.182207-08:00","created_by":"agrande","updated_at":"2025-12-28T11:52:29.443315-08:00","closed_at":"2025-12-28T11:52:29.443315-08:00","close_reason":"Implemented stream_tts_http() generator function with 22 tests. Uses stream=True and iter_content() for chunked HTTP response processing, integrates with StreamingWavParser for incremental WAV parsing.","dependencies":[{"issue_id":"mlx-tts-6ye.2","depends_on_id":"mlx-tts-6ye","type":"parent-child","created_at":"2025-12-28T11:14:49.185303-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-6ye.2","depends_on_id":"mlx-tts-6ye.1","type":"blocks","created_at":"2025-12-28T11:14:55.233521-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-6ye.3","title":"Integrate AudioPlayer for streaming HTTP playback","description":"## Task: mlx-tts-6ye.3\n\nReplace `sounddevice.play()` with `AudioPlayer.queue_audio()` pattern for HTTP path.\n\n### Current Code (mlx_server_utils.py:303-304)\n\n```python\nsd.play(data, samplerate)\nsd.wait()\n```\n\n### Target Implementation\n\nUse same pattern as direct API (mlx_tts_core.py:263-320):\n\n```python\nplayer = AudioPlayer(sample_rate=sample_rate)\nfor chunk in streaming_http_response:\n    processed = audio_processor(chunk)\n    player.queue_audio(processed)\nplayer.start_stream()\nplayer.wait_for_drain()\n```\n\n### Requirements\n\n- Create AudioPlayer instance for HTTP path\n- Queue audio chunks as they arrive from HTTP stream\n- Apply stateful audio compression (audio_processor.py pattern)\n- Handle playback lifecycle (start, drain, cleanup)\n- Capture TTFT and streaming metrics\n\n### Implementation\n\n**MUST use `/tdd-cycle` workflow**\n\n### Dependencies\n\n- Depends on: mlx-tts-6ye.2 (HTTP streaming)\n\n### Test Cases to Write First\n\n1. AudioPlayer receives chunks from HTTP stream\n2. Audio compression stateful across chunks\n3. TTFT metric captured correctly\n4. Playback completes without underruns\n5. Cleanup on error/interruption","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T11:14:49.339023-08:00","created_by":"agrande","updated_at":"2025-12-28T12:02:52.937028-08:00","closed_at":"2025-12-28T12:02:52.937028-08:00","close_reason":"Implemented play_streaming_http() function with AudioPlayer integration, stateful audio compression, TTFT metrics capture, and 18 unit tests. All tests pass.","dependencies":[{"issue_id":"mlx-tts-6ye.3","depends_on_id":"mlx-tts-6ye","type":"parent-child","created_at":"2025-12-28T11:14:49.339458-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-6ye.3","depends_on_id":"mlx-tts-6ye.2","type":"blocks","created_at":"2025-12-28T11:14:55.251992-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-6ye.4","title":"Add streaming metrics and comprehensive tests","description":"## Task: mlx-tts-6ye.4\n\nAdd metrics collection and comprehensive test coverage for HTTP streaming.\n\n### Metrics to Capture\n\n- `http_ttft`: Time from request to first audio chunk played\n- `http_chunk_count`: Number of chunks received\n- `http_total_bytes`: Total audio data transferred\n- `http_rtf`: Real-time factor for HTTP path\n- `http_buffer_underruns`: Count of playback gaps\n\n### Comparison Metrics\n\nTrack both paths for comparison:\n| Metric | Direct API | HTTP Streaming |\n|--------|------------|----------------|\n| TTFT | ~260ms | Target \u003c500ms |\n| RTF | ~0.58 | Similar |\n\n### Implementation\n\n**MUST use `/tdd-cycle` workflow**\n\n### Dependencies\n\n- Depends on: mlx-tts-6ye.3 (AudioPlayer integration)\n\n### Test Cases to Write First\n\n1. TTFT measured correctly for streaming path\n2. Chunk count matches server output\n3. RTF calculation accurate\n4. Metrics logged/exported properly\n5. End-to-end integration test with mock server","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T11:14:49.491847-08:00","created_by":"agrande","updated_at":"2025-12-28T12:12:35.850139-08:00","closed_at":"2025-12-28T12:12:35.850139-08:00","close_reason":"Implemented streaming metrics (total_bytes, audio_duration, rtf) with TDD tests","dependencies":[{"issue_id":"mlx-tts-6ye.4","depends_on_id":"mlx-tts-6ye","type":"parent-child","created_at":"2025-12-28T11:14:49.492284-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-6ye.4","depends_on_id":"mlx-tts-6ye.3","type":"blocks","created_at":"2025-12-28T11:14:55.269576-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-7ex","title":"Create voice_cache.py module with caching utilities","description":"## Description\nCreate a new `scripts/voice_cache.py` module that provides voice conditionals caching.\n\n## Implementation\nUse `/tdd-cycle` skill for TDD implementation.\n\n### Functions to implement:\n```python\nCACHE_DIR = Path.home() / '.cache' / 'claude-mlx-tts' / 'voice_conds'\n\ndef get_cache_path(voice_ref: str) -\u003e Path:\n    '''Generate cache path based on file content hash (sha256[:16]).'''\n\ndef is_cache_valid(voice_ref: str) -\u003e bool:\n    '''Check if cached conditionals exist for this voice file.'''\n\ndef save_conditionals(conds: Conditionals, voice_ref: str) -\u003e Path:\n    '''Save conditionals to cache, return cache path.'''\n\ndef load_conditionals(voice_ref: str) -\u003e Conditionals | None:\n    '''Load cached conditionals, return None if not cached.'''\n\ndef get_or_prepare_conditionals(model, voice_ref: str) -\u003e None:\n    '''Main entry point - load from cache or extract and cache.'''\n```\n\n## Acceptance Criteria\n- [ ] Content-based hashing for cache invalidation\n- [ ] Cache stored in ~/.cache/claude-mlx-tts/voice_conds/\n- [ ] Handles missing cache gracefully\n- [ ] Logging for cache hits/misses","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T19:30:09.677031-08:00","updated_at":"2025-12-25T20:07:20.264602-08:00","closed_at":"2025-12-25T20:07:20.264605-08:00"}
{"id":"mlx-tts-7me","title":"Phase 5: Preview System","description":"Add preview phrase display, Play Preview button, integrate with speak_mlx_http(), and add loading indicator during playback.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:28:38.204745-08:00","updated_at":"2025-12-26T13:30:39.127954-08:00","dependencies":[{"issue_id":"mlx-tts-7me","depends_on_id":"mlx-tts-z1k","type":"blocks","created_at":"2025-12-26T13:28:49.915291-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-7me","depends_on_id":"mlx-tts-cpr","type":"blocks","created_at":"2025-12-26T13:28:50.564607-08:00","created_by":"daemon"}],"deleted_at":"2025-12-26T13:30:39.127954-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-7q8","title":"Voice CRUD operations UX in Clone Lab","description":"Add voice management actions to Voice selector: Copy, Delete, Rename. Operations must refresh associated configs and handle edge cases.\n\n## UI Design\n\n### Voice Selector with Action Bar\n```\nâ”Œâ”€ Voices â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ â–¸ default                    â”‚\nâ”‚   scarlett                   â”‚\nâ”‚   c3po                       â”‚\nâ”‚   snoop                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ [Copy] [Rename] [Del]        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Delete Confirmation Modal\n```\nâ”Œâ”€ Delete Voice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Delete \"scarlett\"?          â”‚\nâ”‚                              â”‚\nâ”‚  âš  This voice is used by:    â”‚\nâ”‚    â€¢ Stop hook override      â”‚\nâ”‚    â€¢ Permission hook         â”‚\nâ”‚                              â”‚\nâ”‚  These will revert to the    â”‚\nâ”‚  default voice.              â”‚\nâ”‚                              â”‚\nâ”‚     [Cancel]  [Delete]       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Copy/Rename Input Modal\n```\nâ”Œâ”€ Copy Voice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Copy \"scarlett\" as:         â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚ scarlett_loud          â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚     [Cancel]  [Copy]         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Requirements\n\n### Operations\n1. **Copy Voice**: Copy voice file + settings to new name\n   - Copy `assets/{name}.safetensors` (or `.wav`) to new name\n   - Copy `config.voices[name]` settings to new entry\n2. **Delete Voice**: Remove voice file and clean up references\n3. **Rename Voice**: Rename voice file and update all config references\n\n### Config Updates\nEach operation must update:\n- `assets/{name}.safetensors` or `.wav` file\n- `config.voices[name]` (compressor/limiter settings)\n- `config.active_voice` if affected\n- `config.hooks[*].voice` overrides if affected\n\n## Edge Cases\n\n### Delete Voice\n1. **Deleting active voice**: Set `active_voice` to another available voice (first remaining)\n2. **Deleting hook-assigned voice**: Clear `hooks[hook_type].voice` override (falls back to active)\n3. **Deleting last voice**: Block operation - at least one voice must exist\n\n### Rename Voice\n1. **Name collision**: Block if target name already exists\n2. **Invalid characters**: Validate against VOICE_NAME_PATTERN (alphanumeric, underscore, hyphen)\n3. **Renaming active voice**: Update `active_voice` to new name\n4. **Renaming hook-assigned voice**: Update `hooks[hook_type].voice` to new name\n5. **Per-voice settings**: Move `config.voices[old]` to `config.voices[new]`\n\n### Copy Voice\n1. **Name collision**: Block if target name already exists\n2. **Invalid characters**: Same validation as rename\n3. **Copy file**: Duplicate the .safetensors or .wav file\n4. **Copy settings**: Duplicate compressor/limiter settings\n\n## Functions to Add (tts_config.py)\n- `delete_voice(name)` -\u003e remove file + clean up all config references\n- `rename_voice(old, new)` -\u003e rename file + update all config references\n- `copy_voice(source, target)` -\u003e copy file + settings\n- `get_voice_usage(name)` -\u003e list where voice is referenced (active, hooks)\n\n## Textual Components\n- `VoiceSelector`: Add Horizontal footer with Button widgets\n- `DeleteVoiceModal`: ModalScreen with usage warning\n- `InputModal`: Reusable ModalScreen with Input validation for Copy/Rename","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T07:19:02.934056-08:00","updated_at":"2025-12-27T07:45:11.641097-08:00","closed_at":"2025-12-27T07:45:11.641097-08:00","close_reason":"Implemented via TDD: 74 tests passing. Added get_voice_usage(), delete_voice(), rename_voice(), copy_voice() to tts_config.py. Added DeleteVoiceModal, InputModal, and action buttons to VoiceSelector in tts_tui.py. Handles all edge cases: deleting active voice, hook cleanup, last voice protection, name validation."}
{"id":"mlx-tts-7qw","title":"Implement adaptive interpolation window based on discontinuity magnitude","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nInstead of a fixed interpolation window, dynamically size the window based on how large the discontinuity is. Large jumps need more samples to smooth out; small jumps can use fewer.\n\n## Technical Rationale\n\nCurrent approach uses fixed 20ms window regardless of discontinuity size:\n- 3% jump and 0.1% jump get same treatment\n- Small jumps may not need correction at all (wasted processing)\n- Large jumps may need longer correction window\n\n## Implementation Approach\n\n```python\ndef calculate_adaptive_window(discontinuity, sample_rate, base_ms=20.0, max_ms=100.0):\n    \"\"\"\n    Scale window size based on discontinuity magnitude.\n    \n    Args:\n        discontinuity: Absolute difference between prev_last and curr_first\n        sample_rate: Audio sample rate\n        base_ms: Minimum window size\n        max_ms: Maximum window size\n    \"\"\"\n    # Discontinuity thresholds (percentage of full scale)\n    SMALL_DISC = 0.01   # 1% - minimal correction needed\n    LARGE_DISC = 0.05   # 5% - full correction window\n    \n    disc_abs = abs(discontinuity)\n    \n    if disc_abs \u003c SMALL_DISC:\n        # Small discontinuity - minimal or no correction\n        return int(sample_rate * base_ms / 1000)\n    elif disc_abs \u003e= LARGE_DISC:\n        # Large discontinuity - maximum window\n        return int(sample_rate * max_ms / 1000)\n    else:\n        # Linear interpolation between base and max\n        ratio = (disc_abs - SMALL_DISC) / (LARGE_DISC - SMALL_DISC)\n        ms = base_ms + ratio * (max_ms - base_ms)\n        return int(sample_rate * ms / 1000)\n```\n\n### Integration Point\nIn `audio_processor.py`, replace fixed `interp_samples` with dynamic calculation:\n```python\n# Before (current)\ninterp_samples = max(4, int(sample_rate * INTERP_MS / 1000))\n\n# After (adaptive)\ndisc = audio_f32[0] - state[\"prev_last\"]\ninterp_samples = calculate_adaptive_window(disc, sample_rate)\ninterp_curve = generate_curve(interp_samples)  # May need to cache common sizes\n```\n\n### Performance Consideration\nGenerating new curves for each chunk is expensive. Solution:\n- Pre-compute curves for common sizes (e.g., 10, 20, 50, 100ms)\n- Round to nearest pre-computed size\n- Or use a formula that doesn't require pre-computation\n\n## Files to Modify\n- `scripts/audio_processor.py` - Add adaptive window logic\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Unit test: Verify window scaling function with known inputs\n2. Unit test: Small discontinuity â†’ small window\n3. Unit test: Large discontinuity â†’ large window\n4. Integration: Run diagnose_clipping.py to analyze actual discontinuity distribution\n5. Manual listening test\n\n```bash\n# Analyze discontinuity distribution in real audio\nuv run python scripts/diagnose_clipping.py --real \"Test text\" --verbose\n```\n\n## Success Criteria\n- Crackles eliminated for typical discontinuity sizes\n- Processing overhead not significantly increased\n- No audible artifacts from variable window sizes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-28T18:52:10.144-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.88021-08:00","deleted_at":"2025-12-28T18:56:28.88021-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-8fl","title":"tts_config.py: per-voice getters/setters","description":"- get_voice_compressor(voice_name) -\u003e dict\n- set_voice_compressor(voice_name, key, value)\n- get_voice_limiter(voice_name) -\u003e dict  \n- set_voice_limiter(voice_name, key, value)\n- reset_voice_to_defaults(voice_name)\n- Fallback to DEFAULT_COMPRESSOR/LIMITER for missing keys","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T17:25:21.997542-08:00","updated_at":"2025-12-26T17:43:47.094933-08:00","closed_at":"2025-12-26T17:43:47.094933-08:00","close_reason":"Implemented per-voice getters/setters: get_voice_compressor, set_voice_compressor, get_voice_limiter, set_voice_limiter, reset_voice_to_defaults. All 94 tests pass.","dependencies":[{"issue_id":"mlx-tts-8fl","depends_on_id":"mlx-tts-sdi","type":"blocks","created_at":"2025-12-26T17:25:34.392056-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-8y5","title":"Add TTS notifications for tool permission prompts","description":"## Objective\nAdd TTS notifications when Claude requests tool permissions, using similar heuristics to detect if the user may have stepped away.\n\n## ğŸ› ï¸ Development Workflow\n\n### Feature Design\nUse `/feature-dev:feature-dev` skill to:\n- Analyze existing tts-notify.py patterns\n- Design heuristics for \"user stepped away\" detection\n- Plan integration with tool permission hooks\n\n### Implementation\nUse `/tdd-workflows:tdd-orchestrator` skill to:\n- Follow red-green-refactor discipline\n- Write tests before implementation\n\n---\n\n## Context\nCurrently TTS only fires on Stop hooks (when Claude finishes responding). Users may also step away during long operations and miss tool permission prompts, causing Claude to wait indefinitely.\n\n## Heuristics to Consider\n- Time since last user interaction\n- Duration of current operation\n- Type of tool requesting permission\n- Whether previous tools in sequence were auto-approved\n\n## TODO\n- [ ] Research tool permission hook structure\n- [ ] Design detection heuristics\n- [ ] Implement with TDD approach","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T16:27:56.131055-08:00","updated_at":"2025-12-25T16:53:47.731416-08:00","closed_at":"2025-12-25T16:53:47.731416-08:00","close_reason":"Implemented permission notification hook with TTS, 54 tests, configurable thresholds","comments":[{"id":1,"issue_id":"mlx-tts-8y5","author":"agrande","text":"## Research Findings: Hook Execution Order\n\n### Key Discovery: Parallel Execution\nAll matching PermissionRequest hooks run **in parallel**, not sequentially. This means:\n- Cannot detect if another hook will auto-approve before TTS fires\n- No short-circuiting on first allow/deny\n- Must consolidate logic into a single hook\n\n### Revised Architecture\nInstead of separate auto-approve + notification hooks, use **ONE consolidated hook**:\n\n1. Check if command is TTS script â†’ auto-approve silently\n2. Check 30s heuristic (time since last user interaction)\n3. If should notify â†’ speak â†’ return no decision (normal permission flow)\n\n### Recursion Avoidance (existing patterns)\nReference `scripts/tts-notify.py`:\n- Line 323: `stop_hook_active` flag check\n- Lines 187-202: Skip TTS if turn included TTS scripts\n\n### Matchers\n- Empty string or '*' matches all tools\n- Case-sensitive: 'Bash' â‰  'bash'\n- Regex supported: 'Edit|Write'\n\n### PermissionRequest Input (undocumented but inferred)\n- tool_name, tool_input\n- session_id, transcript_path, cwd\n- permission_mode (bypassPermissions, acceptEdits, etc.)","created_at":"2025-12-26T00:13:05Z"},{"id":2,"issue_id":"mlx-tts-8y5","author":"agrande","text":"## Implementation Plan\n\n### 1. Create `scripts/permission-notify.py`\nConsolidated hook handling both auto-approve and notification:\n\n```python\n# Pseudo-code\ndef main():\n    hook_input = get_hook_input()\n    tool_name = hook_input.get('tool_name')\n    tool_input = hook_input.get('tool_input', {})\n    command = tool_input.get('command', '')\n    \n    # 1. Auto-approve TTS scripts silently (no speak)\n    TTS_SCRIPTS = ['tts-init.sh', 'tts-start.sh', ...]\n    if any(script in command for script in TTS_SCRIPTS):\n        return allow_decision()\n    \n    # 2. Check 30s heuristic\n    transcript_path = hook_input.get('transcript_path')\n    if not user_away_30s(transcript_path):\n        return  # User is active, no notification needed\n    \n    # 3. Speak notification\n    speak(f'Claude needs permission to run {tool_name}')\n    \n    # 4. Return nothing - let normal permission flow continue\n```\n\n### 2. Update `hooks/hooks.json`\nReplace current PermissionRequest with:\n```json\n\"PermissionRequest\": [{\n  \"matcher\": \"\",\n  \"hooks\": [{\n    \"type\": \"command\",\n    \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/permission-notify.py\"\n  }]\n}]\n```\n\n### 3. Delete `hooks/approve-tts.py`\nLogic consolidated into permission-notify.py\n\n### 4. Add 30s heuristic function\nUse transcript_path to find last user message timestamp, compare to now","created_at":"2025-12-26T00:13:18Z"},{"id":3,"issue_id":"mlx-tts-8y5","author":"agrande","text":"## Clarified Requirements\n\n### Scope\n**Pure notification hook** â€” no auto-approval logic.\n\n### Behavior\n1. PermissionRequest hook fires ONLY when a permission dialog is about to be shown\n2. Check 30s heuristic (time since last user interaction)\n3. If user away 30s+ â†’ Speak: \"Claude needs permission to run [tool_name]\"\n4. Return nothing â†’ Normal dialog appears â†’ User decides\n\n### What This Means\n- Pre-approved tools (allowedTools, session approval, etc.) â†’ Hook doesn't fire â†’ No TTS\n- Permission dialog shown â†’ Hook fires â†’ TTS if 30s away\n- **No auto-approval in this hook**\n- Existing `approve-tts.py` remains separate (unchanged)\n\n### Implementation Constraint\n**Must use `/tdd-workflows:tdd-orchestrator` for implementation** â€” write tests first, then implement.\n\n### Files to Create/Modify\n- CREATE: `scripts/permission-notify.py` (notification only)\n- MODIFY: `hooks/hooks.json` (add new PermissionRequest entry)\n- KEEP: `hooks/approve-tts.py` (separate, unchanged)","created_at":"2025-12-26T00:20:26Z"}]}
{"id":"mlx-tts-93p","title":"Implement higher-order interpolation (cubic spline, match derivatives)","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nCurrent interpolation matches only the VALUE at chunk boundaries (0th derivative). This task explores matching higher-order derivatives (velocity, acceleration) for smoother transitions.\n\n## Technical Background\n\nAudio waveforms have continuity in multiple derivatives:\n- 0th derivative: amplitude (currently matched)\n- 1st derivative: rate of change (velocity)\n- 2nd derivative: acceleration\n\nDiscontinuities in higher derivatives can also be audible as \"harshness\" even if amplitude is continuous.\n\n## Approach: Cubic Hermite Spline\n\nMatch both value AND first derivative at boundary:\n\n```python\ndef cubic_hermite_interpolation(y0, y1, dy0, dy1, n_samples):\n    \"\"\"\n    Interpolate from (0, y0) with slope dy0 to (1, y1) with slope dy1.\n    \n    Uses Hermite basis functions:\n    h00(t) = 2tÂ³ - 3tÂ² + 1\n    h10(t) = tÂ³ - 2tÂ² + t\n    h01(t) = -2tÂ³ + 3tÂ²\n    h11(t) = tÂ³ - tÂ²\n    \"\"\"\n    t = np.linspace(0, 1, n_samples)\n    \n    h00 = 2*t**3 - 3*t**2 + 1\n    h10 = t**3 - 2*t**2 + t\n    h01 = -2*t**3 + 3*t**2\n    h11 = t**3 - t**2\n    \n    return h00*y0 + h10*dy0 + h01*y1 + h11*dy1\n```\n\n### Estimating Derivatives\nNeed to estimate the derivative (slope) at chunk boundaries:\n\n```python\n# End of previous chunk (last few samples)\nprev_derivative = (prev_samples[-1] - prev_samples[-3]) / 2  # Central difference\n\n# Start of current chunk (first few samples)  \ncurr_derivative = (curr_samples[2] - curr_samples[0]) / 2\n```\n\n### Integration with Current Code\n```python\nif state[\"prev_last\"] is not None and state[\"prev_derivative\"] is not None:\n    # Estimate current chunk's starting derivative\n    curr_deriv = (audio_f32[2] - audio_f32[0]) / 2 if len(audio_f32) \u003e 2 else 0\n    \n    # Generate correction curve using cubic Hermite\n    correction = cubic_hermite_interpolation(\n        y0=state[\"prev_last\"],     # Where we're coming from\n        y1=audio_f32[0],           # Where we're going\n        dy0=state[\"prev_derivative\"],  # Slope at end of prev\n        dy1=curr_deriv,                # Slope at start of curr\n        n_samples=interp_samples\n    )\n    \n    # Apply correction\n    audio_f32[:interp_samples] = correction\n```\n\n## Files to Modify\n- `scripts/audio_processor.py` - Replace raised cosine with cubic spline\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Unit test: Verify cubic Hermite produces smooth curve\n2. Unit test: Verify derivative estimation from samples\n3. Unit test: Verify boundary conditions are met (y0, y1, dy0, dy1)\n4. Visual test: Plot interpolated curves to verify smoothness\n5. Manual listening test\n\n## Success Criteria\n- Smoother transitions than current raised cosine\n- No audible artifacts from derivative matching\n- Comparable or better computational cost\n\n## References\n- https://en.wikipedia.org/wiki/Cubic_Hermite_spline\n- https://en.wikipedia.org/wiki/Hermite_interpolation\n\n## Notes\n- May want to fall back to linear if derivative estimation is unstable\n- Consider using more samples for derivative estimation (5-point stencil)","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-28T18:53:12.101294-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.881202-08:00","deleted_at":"2025-12-28T18:56:28.881202-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-9po","title":"Experiment with different interpolation curve shapes","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nCurrent implementation uses a raised cosine (cosÂ²) curve for interpolation correction. Different curve shapes may produce more natural-sounding transitions.\n\n## Current Implementation\n```python\n# Raised cosine: cosÂ²(0 to Ï€/2) = 1.0 to 0.0\ninterp_curve = np.cos(np.linspace(0, np.pi / 2, interp_samples, dtype=np.float32)) ** 2\n```\n\nThis provides smooth start (derivative=0 at boundary) but may not be optimal for audio.\n\n## Curves to Test\n\n### 1. Linear\n```python\n# Simple linear ramp from 1 to 0\ncurve = np.linspace(1, 0, n_samples)\n```\nPros: Simple, predictable\nCons: Discontinuous derivative at boundaries\n\n### 2. Exponential decay\n```python\n# Exponential: e^(-t/tau) where tau controls decay rate\nt = np.linspace(0, 5, n_samples)  # 5 time constants\ncurve = np.exp(-t)\ncurve = curve / curve[0]  # Normalize to start at 1\n```\nPros: Natural decay, commonly used in audio\nCons: Never truly reaches zero\n\n### 3. Gaussian\n```python\n# Gaussian: e^(-tÂ²/2ÏƒÂ²)\nt = np.linspace(0, 3, n_samples)  # 3 sigma\ncurve = np.exp(-t**2 / 2)\n```\nPros: Very smooth, used in audio windowing\nCons: May be too gradual\n\n### 4. Hann window (half)\n```python\n# Half Hann window: 0.5 * (1 + cos(Ï€ * t))\nt = np.linspace(0, 1, n_samples)\ncurve = 0.5 * (1 + np.cos(np.pi * t))\n```\nPros: Standard in audio processing, smooth derivatives\nCons: Similar to current raised cosine\n\n### 5. Blackman-Harris (half)\n```python\n# Half Blackman-Harris - excellent sidelobe suppression\nt = np.linspace(0, 0.5, n_samples)\na0, a1, a2, a3 = 0.35875, 0.48829, 0.14128, 0.01168\ncurve = a0 - a1*np.cos(2*np.pi*t) + a2*np.cos(4*np.pi*t) - a3*np.cos(6*np.pi*t)\ncurve = curve / curve[0]  # Normalize\n```\nPros: Minimizes spectral artifacts\nCons: More complex\n\n### 6. S-curve (sigmoid)\n```python\n# Inverted sigmoid for smooth 1â†’0 transition\nt = np.linspace(-6, 6, n_samples)\ncurve = 1 - 1/(1 + np.exp(-t))\n```\nPros: Very smooth, equal derivatives at both ends\nCons: Might smear more audio than necessary\n\n## Testing Approach\n\nCreate parameterized test:\n```python\nCURVES = {\n    \"raised_cosine\": lambda n: np.cos(np.linspace(0, np.pi/2, n))**2,\n    \"linear\": lambda n: np.linspace(1, 0, n),\n    \"exponential\": lambda n: np.exp(-np.linspace(0, 5, n)),\n    \"hann\": lambda n: 0.5 * (1 + np.cos(np.pi * np.linspace(0, 1, n))),\n    # ... etc\n}\n\nfor name, curve_fn in CURVES.items():\n    # Generate speech with this curve\n    # Listen and rate quality\n```\n\n## Files to Modify\n- `scripts/audio_processor.py` - Make curve configurable or test variations\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Unit test: Each curve function produces valid 1â†’0 transition\n2. Unit test: Curve lengths match expected samples\n3. Visual test: Plot all curves for comparison\n4. Listening test: A/B comparison with same test text\n\n## Success Criteria\n- Identify if any curve shape significantly outperforms raised cosine\n- Document findings for future reference\n- If better curve found, update default\n\n## Notes\n- Differences may be subtle - use consistent test text\n- Consider testing at multiple window sizes (20ms, 50ms)\n- The \"best\" curve may depend on window size","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-28T18:55:14.254263-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.883629-08:00","deleted_at":"2025-12-28T18:56:28.883629-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-9rk","title":"Add voice bootstrapping to /tts-init command","description":"## Description\nUpdate `scripts/tts-init.sh` to pre-compute and cache voice conditionals for the default voice during initialization.\n\n## Implementation\nUse `/tdd-cycle` skill for TDD implementation.\n\n### Changes to tts-init.sh:\n1. After model download, run voice bootstrapping\n2. Create inline Python or separate script to:\n   - Load model\n   - Call `prepare_conditionals()` on default voice\n   - Save to cache\n\n### Example addition:\n```bash\necho ''\necho 'Bootstrapping voice conditionals...'\necho 'This pre-computes voice embeddings for faster first use.'\n\nuv run python -c \"\nfrom mlx_audio.tts.utils import load_model\nfrom scripts.voice_cache import save_conditionals\nmodel = load_model('')\nmodel.prepare_conditionals('assets/default_voice.wav')\nsave_conditionals(model._conds, 'assets/default_voice.wav')\nprint('Voice conditionals cached!')\n\"\n```\n\n## Acceptance Criteria\n- [ ] /tts-init bootstraps default voice cache\n- [ ] First TTS after init is fast (no extraction needed)\n- [ ] Clear progress message to user\n- [ ] Handles errors gracefully","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T19:30:10.188022-08:00","updated_at":"2025-12-25T20:07:32.208278-08:00","closed_at":"2025-12-25T20:07:32.20828-08:00","dependencies":[{"issue_id":"mlx-tts-9rk","depends_on_id":"mlx-tts-7ex","type":"blocks","created_at":"2025-12-25T19:30:18.479888-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-9sf","title":"Integrate config loading into tts-notify.py","description":"Modify tts-notify.py to:\n1. Check for config file in platformdirs location\n2. Fall back to current hardcoded defaults if missing\n3. Override settings from config.toml when present\n\nMaintain backward compatibility - no config file = current behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T10:13:26.96448-08:00","updated_at":"2025-12-26T10:26:04.54474-08:00","closed_at":"2025-12-26T10:26:04.54474-08:00","close_reason":"Already integrated - tts-notify.py imports and uses get_playback_speed() from tts_config","labels":["epic:mlx-tts-tzk"],"dependencies":[{"issue_id":"mlx-tts-9sf","depends_on_id":"mlx-tts-gzg","type":"blocks","created_at":"2025-12-26T10:14:02.36936-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-9uh","title":"4.2 Add ceiling and release sliders","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:43.1536-08:00","updated_at":"2025-12-26T13:30:39.137756-08:00","deleted_at":"2025-12-26T13:30:39.137756-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-9wg","title":"Integrate voice caching into mlx_tts_core.py","description":"## Description\nUpdate `scripts/mlx_tts_core.py` to use the voice caching module.\n\n## Implementation\nUse `/tdd-cycle` skill for TDD implementation.\n\n### Changes needed:\n1. Import `voice_cache` module\n2. Modify `generate_speech()` to use cached conditionals\n3. Update model initialization to check cache first\n4. Add cache warmup on first use\n\n### Key change in generate_speech():\n```python\ndef generate_speech(text, model=None, ref_audio=None, ...):\n    if model is None:\n        model = get_model()\n    \n    # Use cached conditionals instead of ref_audio\n    voice_cache.get_or_prepare_conditionals(model, ref_audio or MLX_VOICE_REF)\n    \n    # Generate WITHOUT ref_audio - uses cached conditionals\n    for result in model.generate(text=text, ...):\n        # handle result\n```\n\n## Acceptance Criteria\n- [ ] First call extracts and caches (~1.5s)\n- [ ] Subsequent calls use cache (~0.2ms)\n- [ ] Falls back gracefully if caching fails\n- [ ] Backward compatible API","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T19:30:09.932696-08:00","updated_at":"2025-12-25T20:07:20.335257-08:00","closed_at":"2025-12-25T20:07:20.33526-08:00","dependencies":[{"issue_id":"mlx-tts-9wg","depends_on_id":"mlx-tts-7ex","type":"blocks","created_at":"2025-12-25T19:30:18.401993-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-a1f","title":"1.2 Implement get_voice_config/set_voice_config","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:08.025944-08:00","updated_at":"2025-12-26T13:30:39.129326-08:00","deleted_at":"2025-12-26T13:30:39.129326-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-a2p","title":"Add path autocomplete to Clone Lab Source WAV field","description":"Add filesystem path autocomplete/fuzzy matching to the Clone Lab's Source WAV input field using textual-autocomplete library's PathAutoComplete widget.\n\n## Context\n- Users must manually type full paths to WAV files for voice cloning\n- No discoverability of available WAV files in the filesystem\n\n## Solution\n- Add textual-autocomplete\u003e=4.0.6 dependency to mlx optional deps\n- Use PathAutoComplete widget targeting the wav-path-input\n- Consider filtering to show only .wav files\n\n## Implementation Notes\n- textual-autocomplete has built-in PathAutoComplete widget\n- Compatible with Textual 2.0+ (project uses 6.11+)\n- Shows dropdown below input with fuzzy matching","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T08:23:55.582384-08:00","updated_at":"2025-12-27T08:28:36.770523-08:00","closed_at":"2025-12-27T08:28:36.770523-08:00","close_reason":"Implemented path autocomplete for Clone Lab Source WAV field using textual-autocomplete PathAutoComplete widget"}
{"id":"mlx-tts-a3b","title":"3.4 Create preset dropdown (Punchy, Broadcast, Gentle, Podcast)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:33.180587-08:00","updated_at":"2025-12-26T13:30:39.136472-08:00","deleted_at":"2025-12-26T13:30:39.136472-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-a88","title":"Test bead for worktree sync verification","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-30T10:38:15.442883-08:00","created_by":"agrande","updated_at":"2025-12-30T11:00:00.61155-08:00","closed_at":"2025-12-30T11:00:00.61155-08:00","close_reason":"Worktree sync verification successful"}
{"id":"mlx-tts-ah7","title":"Clone Lab TUI tab for voice cloning workflow","description":"New TUI tab for user-friendly voice cloning interface.\n\n## Parent Epic\nmlx-tts-6j9: Voice Embedding Convention System\n\n## Requirements\n\n### .7.1 - Tab layout\n```\nâ”Œâ”€ Clone Lab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                                                      â”‚\nâ”‚  Source WAV: [/path/to/voice.wav________] [Browse]   â”‚\nâ”‚                                                      â”‚\nâ”‚  Voice Name: [my_new_voice______________]            â”‚\nâ”‚                                                      â”‚\nâ”‚  [Clone Voice]                                       â”‚\nâ”‚                                                      â”‚\nâ”‚  Status: Ready                                       â”‚\nâ”‚                                                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### .7.2 - Cloning workflow\n1. User enters/browses WAV path\n2. User names the voice (validated live)\n3. Click Clone â†’ show progress\n4. On success: show size savings, enable test button\n5. Auto-refresh voice selector\n\n### .7.3 - Voice testing\nAfter successful clone:\n```\nâ”Œâ”€ Clone Lab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  âœ“ Created: my_new_voice (161KB, 83% smaller)        â”‚\nâ”‚                                                      â”‚\nâ”‚  Test: [Hello, this is my new voice!___] [Speak]     â”‚\nâ”‚                                                      â”‚\nâ”‚  [Clone Another]                                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### .7.4 - Error handling\n- Invalid WAV file\n- Duplicate voice name (offer --force)\n- Model loading errors\n\n## Files to Modify\n- scripts/tts_tui.py\n\n## Dependencies\n- Requires mlx-tts-n2i (clone_voice.py)\n- Requires mlx-tts-f6w (voice format indicator)\n\n## Testing\n**MANDATORY: Use /tdd-cycle**\n- Test UI layout and navigation\n- Test input validation\n- Test clone workflow end-to-end\n- Test error states","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:34:03.617877-08:00","updated_at":"2025-12-26T18:55:30.348987-08:00","closed_at":"2025-12-26T18:55:30.348987-08:00","close_reason":"Implemented Clone Lab TUI tab with WAV input, voice name input with validation, background cloning workflow, success display with size savings, and voice testing functionality","dependencies":[{"issue_id":"mlx-tts-ah7","depends_on_id":"mlx-tts-n2i","type":"blocks","created_at":"2025-12-26T18:34:28.045483-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-ah7","depends_on_id":"mlx-tts-f6w","type":"blocks","created_at":"2025-12-26T18:34:28.074399-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-at6","title":"Add DC offset removal / high-pass filter at chunk boundaries","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nSome chunk boundary discontinuities may be caused by DC offset drift between chunks. A high-pass filter or DC blocker can remove low-frequency components that cause baseline shifts.\n\n## Technical Background\n\nDC offset in audio appears as the waveform not being centered around zero. If different chunks have different DC offsets, stitching them creates a step discontinuity.\n\n### DC Blocker Formula\nSimple first-order high-pass filter:\n```python\ny[n] = x[n] - x[n-1] + R * y[n-1]\n\nwhere R = 0.995 to 0.999 (controls cutoff frequency)\n```\n\nThis removes frequencies below ~20Hz while preserving speech.\n\n### Implementation Options\n\n**Option A: Per-chunk DC removal**\n```python\ndef remove_dc(audio):\n    \"\"\"Remove DC offset from audio chunk.\"\"\"\n    return audio - np.mean(audio)\n```\nSimple but doesn't account for running DC offset.\n\n**Option B: Streaming DC blocker**\n```python\ndef create_dc_blocker(R=0.998):\n    state = {\"x_prev\": 0.0, \"y_prev\": 0.0}\n    \n    def process(audio):\n        output = np.zeros_like(audio)\n        x_prev = state[\"x_prev\"]\n        y_prev = state[\"y_prev\"]\n        \n        for i, x in enumerate(audio):\n            y = x - x_prev + R * y_prev\n            output[i] = y\n            x_prev = x\n            y_prev = y\n        \n        state[\"x_prev\"] = x_prev\n        state[\"y_prev\"] = y_prev\n        return output\n    \n    return process\n```\n\n**Option C: Chunk boundary DC matching**\n```python\ndef match_dc_at_boundary(prev_chunk, curr_chunk):\n    \"\"\"Adjust curr_chunk's DC to match prev_chunk's ending DC.\"\"\"\n    # Estimate DC at end of previous chunk\n    prev_dc = np.mean(prev_chunk[-100:])\n    \n    # Estimate DC at start of current chunk\n    curr_dc = np.mean(curr_chunk[:100])\n    \n    # Shift current chunk to match\n    return curr_chunk - (curr_dc - prev_dc)\n```\n\n## Integration Point\nIn `audio_processor.py`, add DC processing BEFORE interpolation:\n1. Remove/match DC offset\n2. Apply interpolation correction\n3. Apply compressor/limiter\n\n## Files to Modify\n- `scripts/audio_processor.py` - Add DC blocker to processing chain\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Unit test: Verify DC blocker removes DC offset\n2. Unit test: Verify speech frequencies are preserved (\u003e80Hz)\n3. Diagnostic: Measure DC offset at chunk boundaries in real audio\n4. Integration: A/B comparison with/without DC removal\n\n```bash\n# Check if chunks have DC offset issues\nuv run python -c \"\nimport sys; sys.path.insert(0, 'scripts')\nfrom mlx_tts_core import get_model\nfrom voice_cache import get_voice_conditionals\nfrom tts_config import get_active_voice\nimport numpy as np\n\nmodel = get_model()\nmodel._conds = get_voice_conditionals(model, get_active_voice())\n\nchunks = []\nfor result in model.generate('Test sentence for DC analysis', stream=True):\n    chunks.append(np.array(result.audio))\n\nfor i, chunk in enumerate(chunks):\n    dc = np.mean(chunk)\n    print(f'Chunk {i}: DC offset = {dc:.6f} ({dc*100:.3f}%)')\n\"\n```\n\n## Success Criteria\n- Reduced discontinuities if DC offset is a contributing factor\n- No degradation of audio quality (bass frequencies preserved)\n- Minimal computational overhead\n\n## Notes\n- DC offset may not be the primary cause (amplitude jumps seen in investigation suggest otherwise)\n- Worth investigating to rule out as a contributing factor\n- Can be combined with interpolation for belt-and-suspenders approach","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-28T18:53:43.439822-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.881687-08:00","deleted_at":"2025-12-28T18:56:28.881687-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-awr","title":"mlx_tts_core.py: Use format-agnostic voice loading","description":"Refactor TTS core to use get_voice_conditionals() instead of loading audio directly.\n\n## Parent Epic\nmlx-tts-6j9: Voice Embedding Convention System\n\n## Requirements\n\n### .3.1 - Refactor _generate_streaming_with_metrics()\nReplace audio loading with conditionals injection:\n```python\n# OLD:\nref_audio_data = load_audio(ref_audio, sample_rate=model.sample_rate)\nfor result in model.generate(text, ref_audio=ref_audio_data, ...):\n\n# NEW:\nfrom voice_cache import get_voice_conditionals\nfrom tts_config import get_active_voice\n\nvoice_name = get_active_voice()\nmodel._conds = get_voice_conditionals(model, voice_name)\nfor result in model.generate(text, stream=True, ...):  # No ref_audio\n```\n\n### .3.2 - Update generate_speech() signature\n- Remove ref_audio parameter or make it voice_name\n- Keep backwards compatibility if needed\n\n### .3.3 - Update _generate_non_streaming_with_metrics()\nSame pattern - inject conditionals instead of passing ref_audio\n\n## Files to Modify\n- scripts/mlx_tts_core.py\n\n## Dependencies\n- Requires mlx-tts-6j9.1 (voice_cache updates)\n- Requires mlx-tts-6j9.2 (tts_config updates)\n\n## Testing\n**MANDATORY: Use /tdd-cycle**\n- Test generation with safetensors voice\n- Test generation with wav voice\n- Test fallback behavior\n- Integration test comparing output quality","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:33:08.581027-08:00","updated_at":"2025-12-26T18:45:17.702688-08:00","closed_at":"2025-12-26T18:45:17.702688-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-awr","depends_on_id":"mlx-tts-36a","type":"blocks","created_at":"2025-12-26T18:34:27.901179-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-awr","depends_on_id":"mlx-tts-e6g","type":"blocks","created_at":"2025-12-26T18:34:27.930521-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-aye","title":"Build interactive config wizard","description":"Create scripts/tts_config.py with questionary-based wizard:\n- Voice selection (list macOS voices, show MLX option)\n- Backend toggle (say vs MLX)\n- Threshold configuration\n- Save to platformdirs config location\n\nAdd /tts-config skill to invoke it.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T10:13:26.637613-08:00","updated_at":"2025-12-26T10:25:49.866244-08:00","closed_at":"2025-12-26T10:25:49.866244-08:00","close_reason":"Already implemented in scripts/tts_config.py with show/set/wizard commands","labels":["epic:mlx-tts-tzk"],"dependencies":[{"issue_id":"mlx-tts-aye","depends_on_id":"mlx-tts-gzg","type":"blocks","created_at":"2025-12-26T10:14:02.318227-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-b82","title":"Phase 2: Core TUI Framework","description":"Set up Textual app structure with screen navigation (Voice Lab, System Settings, About). Add textual dependency and create voice selector widget.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:28:37.701845-08:00","updated_at":"2025-12-26T13:30:39.126488-08:00","dependencies":[{"issue_id":"mlx-tts-b82","depends_on_id":"mlx-tts-z1k","type":"blocks","created_at":"2025-12-26T13:28:49.839254-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-b82","depends_on_id":"mlx-tts-27o","type":"blocks","created_at":"2025-12-26T13:28:50.096102-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-b82","depends_on_id":"mlx-tts-hes","type":"blocks","created_at":"2025-12-26T13:29:32.447706-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-b82","depends_on_id":"mlx-tts-q05","type":"blocks","created_at":"2025-12-26T13:29:32.475146-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-b82","depends_on_id":"mlx-tts-2ku","type":"blocks","created_at":"2025-12-26T13:29:32.501905-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-b82","depends_on_id":"mlx-tts-19j","type":"blocks","created_at":"2025-12-26T13:29:32.52737-08:00","created_by":"daemon"}],"deleted_at":"2025-12-26T13:30:39.126488-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-brq","title":"TTS config status reporter (/tts-config)","description":"Simplify /tts-config to:\n1. Fetch and report currently active settings from config file (use same consistent config read invocation as tts-notify.py)\n2. Print full command to launch configurator TUI (placeholder for now)\n\nNo wizard/interactive prompts - just status reporting and TUI launch hint.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T21:39:04.33914-08:00","updated_at":"2025-12-26T12:46:59.075328-08:00","closed_at":"2025-12-26T12:46:59.075328-08:00","close_reason":"Implemented simplified /tts-config: shows current settings and TUI launch command","comments":[{"id":4,"issue_id":"mlx-tts-brq","author":"agrande","text":"## Implementation Progress (Handoff)\n\n### Completed\n- Config module (scripts/tts_config.py): Profile-based with speed presets\n- Config at ${PLUGIN_ROOT}/.config/config.json (git-ignored)\n- CLI: tts-config.sh wizard|show|set \u003cspeed\u003e\n- Skill: commands/tts-config.md + hooks/hooks.json\n- Auto-approval in hooks/approve-tts.py\n- All TTS clients read from config (removed MLX_SPEED constants)\n- 24 tests passing\n\n### Remaining\n1. Reload plugin, verify /tts-config appears\n2. Test AskUserQuestion wizard flow\n3. Verify TTS uses configured speed\n\n### Key Files (uncommitted)\n- scripts/tts_config.py (new)\n- scripts/tts-config.sh (new)\n- commands/tts-config.md (new)\n- tests/test_tts_config.py (new)\n- hooks/hooks.json, approve-tts.py (modified)\n- scripts/tts-notify.py, mlx_server_utils.py, mlx_tts_core.py (modified)\n- scripts/say.sh, summary-say.sh (modified)\n- .gitignore (modified)","created_at":"2025-12-26T17:29:06Z"}]}
{"id":"mlx-tts-c8b","title":"Customize prompts per voice","description":"Allow users to customize the TTS prompt per voice in the Voice Lab UI.\n\n## What\nThe hook uses a prompt when generating speech (e.g., instructing the TTS model how to speak). Users should be able to edit this prompt for each voice.\n\n## UI\n- Add a text input field in Voice Lab for the prompt\n- Show current prompt (or default if not customized)\n- Save prompt alongside voice selection in config\n\n## Storage\n- Store in voice config JSON alongside the voice embedding path\n- Fall back to default prompt if not set for a voice\n\n## Hook Integration\n- When hook fires, use the voice's custom prompt if available\n- Otherwise use the default prompt","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-27T07:29:06.094909-08:00","updated_at":"2025-12-27T07:30:29.666638-08:00"}
{"id":"mlx-tts-cif","title":"3.5 Wire compressor Enabled toggle","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:33.345643-08:00","updated_at":"2025-12-26T13:30:39.136885-08:00","deleted_at":"2025-12-26T13:30:39.136885-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-cpr","title":"Phase 4: Limiter Section","description":"Build ceiling visualization widget, add ceiling and release sliders. Position as distinct section below compressor.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:28:38.030123-08:00","updated_at":"2025-12-26T13:30:39.127496-08:00","dependencies":[{"issue_id":"mlx-tts-cpr","depends_on_id":"mlx-tts-z1k","type":"blocks","created_at":"2025-12-26T13:28:49.88978-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-cpr","depends_on_id":"mlx-tts-d44","type":"blocks","created_at":"2025-12-26T13:28:50.410598-08:00","created_by":"daemon"}],"deleted_at":"2025-12-26T13:30:39.127496-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-cqf","title":"Update /tts-config to show settings and prompt for TUI","description":"Update the /tts-config skill to:\n1. Display current configuration (speed, voice, backend)\n2. Prompt user to launch the Textual TUI for full configuration\n\nRemove the AskUserQuestion wizard approach - just show info and suggest TUI.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T10:29:11.160212-08:00","updated_at":"2025-12-26T12:56:34.639641-08:00","closed_at":"2025-12-26T12:56:34.639641-08:00","close_reason":"Duplicate of mlx-tts-brq (already implemented)","labels":["epic:mlx-tts-tzk"],"dependencies":[{"issue_id":"mlx-tts-cqf","depends_on_id":"mlx-tts-5lo","type":"blocks","created_at":"2025-12-26T10:29:18.873488-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-d44","title":"Phase 3: Compressor Section","description":"Build ADSR envelope canvas widget, attack/release/threshold/ratio/gain sliders, preset dropdown (Punchy, Broadcast, Gentle, Podcast), and enabled toggle.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:28:37.866041-08:00","updated_at":"2025-12-26T13:30:39.127025-08:00","dependencies":[{"issue_id":"mlx-tts-d44","depends_on_id":"mlx-tts-z1k","type":"blocks","created_at":"2025-12-26T13:28:49.863476-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-d44","depends_on_id":"mlx-tts-b82","type":"blocks","created_at":"2025-12-26T13:28:50.24861-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-d44","depends_on_id":"mlx-tts-ux8","type":"blocks","created_at":"2025-12-26T13:29:42.737458-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-d44","depends_on_id":"mlx-tts-lc7","type":"blocks","created_at":"2025-12-26T13:29:42.761823-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-d44","depends_on_id":"mlx-tts-2es","type":"blocks","created_at":"2025-12-26T13:29:42.786207-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-d44","depends_on_id":"mlx-tts-a3b","type":"blocks","created_at":"2025-12-26T13:29:42.81092-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-d44","depends_on_id":"mlx-tts-cif","type":"blocks","created_at":"2025-12-26T13:29:42.835952-08:00","created_by":"daemon"}],"deleted_at":"2025-12-26T13:30:39.127025-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-ded","title":"Add Clone Lab tab to TTS TUI for voice cloning workflow","description":"Create a new tab in the TTS TUI that provides a user-friendly interface for cloning voices from WAV files.\n\n## Background\nThe clone_voice.py script handles the technical extraction, but users need a discoverable UI to:\n- Select/browse for WAV files\n- Preview the source audio\n- Name the new voice\n- Trigger cloning and see progress\n- Test the cloned voice immediately\n\n## UX Requirements\n- New 'Clone Lab' tab in tts_tui.py\n- File browser or path input for WAV selection\n- Voice name input with validation (alphanumeric, underscore, hyphen only)\n- Clone button that calls clone_voice.py logic\n- Progress/status feedback during extraction\n- Success state showing file size savings\n- Quick test button to speak sample text with new voice\n\n## Technical Notes\n- Import cloning logic from clone_voice.py (don't shell out)\n- Integrate with existing voice selector - auto-refresh after clone\n- Consider async extraction to keep UI responsive\n- Handle errors gracefully (invalid audio, model not loaded, etc.)\n\n## Design Decisions Needed\n- Tab placement (before or after existing tabs?)\n- Should it show existing cloned voices for management?\n- Audio preview capability (play source WAV before cloning)\n\n## Testing\n- **MANDATORY: Use /tdd-cycle for implementation**\n- Unit tests for UI components\n- Integration test for full clone workflow\n- Test error handling (bad files, duplicate names)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T18:19:27.877697-08:00","updated_at":"2025-12-26T18:34:49.761885-08:00","closed_at":"2025-12-26T18:34:49.761885-08:00","close_reason":"Superseded by detailed sub-tasks under mlx-tts-6j9 epic","dependencies":[{"issue_id":"mlx-tts-ded","depends_on_id":"mlx-tts-1yl","type":"blocks","created_at":"2025-12-26T18:19:33.756254-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-ded","depends_on_id":"mlx-tts-0i3","type":"blocks","created_at":"2025-12-26T18:19:33.785259-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-dej","title":"4.1 Build ceiling visualization widget","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:42.994488-08:00","updated_at":"2025-12-26T13:30:39.137323-08:00","deleted_at":"2025-12-26T13:30:39.137323-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-df0","title":"Migrate to direct mlx_audio Python API","description":"## Goal\nReplace subprocess-based MLX TTS with HTTP API to mlx_audio.server. Enable model caching via persistent server for sub-second response times.\n\n## ğŸ”´ğŸŸ¢ TDD Workflow Required\n\n**All child tasks use strict TDD discipline with `/tdd-workflows:tdd-orchestrator` skill.**\n\nEach implementation phase follows red-green-refactor:\n1. **ğŸ”´ Red**: Write failing tests first\n2. **ğŸŸ¢ Green**: Minimal implementation to pass\n3. **ğŸ”µ Refactor**: Clean up without breaking tests\n\n---\n\n## Architecture Decision: Built-in Server (Option B)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP POST        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ tts-notify  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ mlx_audio.server â”‚\nâ”‚   (hook)    â”‚  localhost:21099     â”‚  (model cached)  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  /v1/audio/speech    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                            â–²\nUser control:                               â”‚\n  /tts-start  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n  /tts-stop   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n  /tts-status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Why Option B over custom daemon:**\n- Less code to maintain\n- Server already battle-tested\n- Model management endpoints built-in\n- Idle timeout support\n\n## Configuration\n- **Port**: 21099\n- **Idle timeout**: 15 min\n- **Model**: mlx-community/chatterbox-turbo-fp16\n\n## Current Problem\nEach TTS call forks a process and loads ~4GB model from scratch. Latency is 5-10+ seconds.\n\n## Target State\nServer auto-starts on first TTS, stays warm for 15 min. Subsequent calls \u003c1s.\nUser can manually control via /tts-start, /tts-stop, /tts-status skills.\n\n## Version History\n- **v0.1.0**: Subprocess-based implementation âœ… (tagged)\n- **v0.2.0**: Direct Python API (in progress)\n- **v0.3.0**: HTTP to mlx_audio.server + control skills (planned)\n\n## Implementation Roadmap\n\n### âœ… Phase 1: Research (mlx-tts-sqn) - COMPLETE\n- Documented mlx_audio Python API\n- Confirmed model reuse pattern works\n\n### ğŸ”² Phase 2: Direct API (mlx-tts-dno) - READY\n- Replace subprocess with direct API calls\n- Serves as fallback when server unavailable\n- **Use `/tdd-workflows:tdd-orchestrator`**\n\n### ğŸ”² Phase 3: Server Integration (mlx-tts-5x9) - BLOCKED\n- Auto-start mlx_audio.server on port 21099\n- 15 min idle timeout\n- **Use `/tdd-workflows:tdd-orchestrator`**\n\n### ğŸ”² Phase 4: Control Skills (mlx-tts-lc0) - BLOCKED\n- /tts-start - manual server start + model preload\n- /tts-stop - immediate shutdown, reclaim memory\n- /tts-status - show server state, memory, idle time\n- **Use `/tdd-workflows:tdd-orchestrator`**\n\n## Success Metrics\n- Warm latency: \u003c1s\n- Cold start: \u003c15s (acceptable for first call)\n- Memory: Auto-free after 15 min idle\n- User control: /tts-start, /tts-stop, /tts-status\n\n## Dependencies\n```\nmlx-tts-sqn âœ… â†’ mlx-tts-dno ğŸ”² â†’ mlx-tts-5x9 ğŸ”² â†’ mlx-tts-lc0 ğŸ”²\n```","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-24T15:51:13.414815-08:00","updated_at":"2025-12-25T15:55:33.690185-08:00","closed_at":"2025-12-25T15:55:33.690185-08:00","close_reason":"All implementation phases complete - server lifecycle management, HTTP TTS, and control skills fully implemented","dependencies":[{"issue_id":"mlx-tts-df0","depends_on_id":"mlx-tts-5x9","type":"blocks","created_at":"2025-12-24T15:52:10.341169-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-dm5","title":"TUI: wire voice selection to load/save per-voice settings","description":"- On voice select: reload CompressorWidget/LimiterWidget with voice's settings\n- On field change: save to selected voice (not global)\n- Reset button: reset selected voice to defaults\n- Preview: use selected voice's audio chain","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T17:25:28.676539-08:00","updated_at":"2025-12-26T17:54:20.783795-08:00","closed_at":"2025-12-26T17:54:20.783795-08:00","close_reason":"Implemented VoiceChanged message in VoiceSelector that triggers widget refresh when voice is selected","dependencies":[{"issue_id":"mlx-tts-dm5","depends_on_id":"mlx-tts-8fl","type":"blocks","created_at":"2025-12-26T17:25:34.364151-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-dno","title":"Implement direct mlx_audio API calls","description":"## Objective\nReplace subprocess-based MLX TTS with direct Python API calls.\n\n## Prerequisites\n- mlx-tts-sqn (Research) - COMPLETE\n\n## ğŸ”´ğŸŸ¢ TDD Workflow - Use `/tdd-workflows:tdd-orchestrator` Skill\n\n**IMPORTANT**: This task follows strict TDD discipline. Use the TDD orchestrator skill to guide red-green-refactor cycles.\n\n### How to Execute\n1. Start with: `/tdd-workflows:tdd-orchestrator`\n2. Follow the red-green-refactor discipline the skill enforces\n3. Never write implementation before failing tests\n\n---\n\n## Implementation Phases (TDD Approach)\n\n### Phase 1: Test Infrastructure\n**ğŸ”´ Red Phase** - Write failing tests first\n1. Create `tests/test_mlx_tts.py` with pytest fixtures\n2. Write tests for model loading (mock mlx_audio imports)\n3. Write tests for audio generation with preloaded model\n4. Write tests for play=True behavior\n5. Run tests - all should FAIL (no implementation yet)\n\n### Phase 2: Core API Integration  \n**ğŸŸ¢ Green Phase** - Minimal implementation to pass tests\n1. Create `mlx_tts_core.py` module with:\n   - `load_tts_model()` - wraps load_model with error handling\n   - `generate_speech()` - wraps generate_audio with our defaults\n2. Update `tts-notify.py` to import and use new module\n3. Run tests - all should PASS\n\n### Phase 3: Refactor \u0026 Optimize\n**ğŸ”µ Refactor Phase** - Clean up without breaking tests\n1. Add model caching at module level\n2. Add lazy loading with `@functools.lru_cache`\n3. Add timeout handling for generation\n4. Run tests - all should still PASS\n\n## Key Code Changes\n\n**Before (subprocess):**\n```python\nsubprocess.run([\n    sys.executable, \"-m\", \"mlx_audio.tts.generate\",\n    \"--model\", MLX_MODEL,\n    \"--text\", message,\n    ...\n])\n```\n\n**After (direct API):**\n```python\nfrom mlx_audio.tts.utils import load_model\nfrom mlx_audio.tts.generate import generate_audio\n\n_model = None\n\ndef get_model():\n    global _model\n    if _model is None:\n        _model = load_model(\"mlx-community/chatterbox-turbo-fp16\")\n    return _model\n\ndef speak_mlx(message: str):\n    generate_audio(\n        text=message,\n        model=get_model(),\n        ref_audio=MLX_VOICE_REF,\n        ref_text=\".\",\n        speed=MLX_SPEED,\n        play=True,\n        verbose=False,\n    )\n```\n\n## Test Cases\n\n### Unit Tests\n```python\ndef test_load_tts_model_returns_valid_model():\n    model = load_tts_model()\n    assert hasattr(model, 'sample_rate')\n\ndef test_generate_speech_with_preloaded_model():\n    model = load_tts_model()\n    # Should not raise, should play audio\n    generate_speech(\"Test\", model=model, play=True)\n\ndef test_model_reuse_no_reload():\n    m1 = get_model()\n    m2 = get_model()\n    assert m1 is m2  # Same instance\n```\n\n### Integration Tests  \n```python\ndef test_warm_latency_under_1_second():\n    model = get_model()  # Cold load\n    start = time.time()\n    generate_speech(\"Quick test\", model=model, play=False)\n    assert time.time() - start \u003c 1.0\n```\n\n## Success Metrics\n- [ ] All unit tests pass\n- [ ] Warm latency \u003c1s\n- [ ] No subprocess calls for MLX TTS\n- [ ] Graceful fallback to macOS say on failure\n\n## Blocked By\n- mlx-tts-sqn (Research) âœ… COMPLETE","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:51:53.806082-08:00","updated_at":"2025-12-24T16:51:18.190151-08:00","closed_at":"2025-12-24T16:51:18.190151-08:00","close_reason":"Implemented direct mlx_audio API calls with model caching. All 15 unit tests pass. No subprocess calls for MLX TTS.","dependencies":[{"issue_id":"mlx-tts-dno","depends_on_id":"mlx-tts-sqn","type":"blocks","created_at":"2025-12-24T15:52:10.187281-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e6g","title":"tts_config.py: Format-aware voice discovery","description":"Update voice discovery to find both .wav and .safetensors files.\n\n## Parent Epic\nmlx-tts-6j9: Voice Embedding Convention System\n\n## Requirements\n\n### .2.1 - Update discover_voices()\nFind both extensions, deduplicate by stem:\n```python\ndef discover_voices() -\u003e list[str]:\n    assets = _PLUGIN_ROOT / \"assets\"\n    voices = set()\n    for ext in (\"*.safetensors\", \"*.wav\"):\n        for f in assets.glob(ext):\n            voices.add(f.stem)\n    return sorted(voices)\n```\n\n### .2.2 - Add get_voice_format()\nReturn format indicator for UI:\n```python\ndef get_voice_format(voice_name: str) -\u003e str | None:\n    \"\"\"Return 'safetensors', 'wav', or None.\"\"\"\n    assets = _PLUGIN_ROOT / \"assets\"\n    if (assets / f\"{voice_name}.safetensors\").exists():\n        return \"safetensors\"\n    if (assets / f\"{voice_name}.wav\").exists():\n        return \"wav\"\n    return None\n```\n\n### .2.3 - Update resolve_voice_path()\nReturn preferred path (safetensors \u003e wav):\n```python\ndef resolve_voice_path(voice_name: str) -\u003e Path:\n    # Security validation (existing)\n    ...\n    # Check safetensors first\n    safetensors_path = assets / f\"{voice_name}.safetensors\"\n    if safetensors_path.exists():\n        return safetensors_path\n    # Fall back to wav\n    wav_path = assets / f\"{voice_name}.wav\"\n    if wav_path.exists():\n        return wav_path\n    raise ValueError(...)\n```\n\n## Files to Modify\n- scripts/tts_config.py\n\n## Testing\n**MANDATORY: Use /tdd-cycle**\n- Test discover_voices finds both formats\n- Test deduplication when both exist\n- Test get_voice_format returns correct type\n- Test resolve_voice_path priority\n- Test security validation still works for both extensions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:33:08.408359-08:00","updated_at":"2025-12-26T18:40:27.314594-08:00","closed_at":"2025-12-26T18:40:27.314594-08:00","close_reason":"Closed"}
{"id":"mlx-tts-e95","title":"Epic: Fix streaming mode audio quality (eliminate crackles/clicks)","description":"## Problem Statement\n\nStreaming mode TTS produces audible crackles/clicks at chunk boundaries. Non-streaming mode produces perfect audio, confirming the root cause is discontinuities between streaming chunks.\n\n## Root Cause Analysis\n\nThe MLX Chatterbox model's streaming output (`stream=True` with `streaming_interval=0.5`) produces audio chunks that don't smoothly connect:\n\n```\nTransition 4-\u003e5: prev[-1]=0.00204, curr[0]=-0.03491, Jump=3.7%\nTransition 5-\u003e6: prev[-1]=0.00568, curr[0]=-0.03960, Jump=4.5%\n```\n\nThese 3-5% amplitude jumps cause audible clicks when chunks are stitched together.\n\n## Current State\n\n- 20ms raised-cosine interpolation in `audio_processor.py` helps but doesn't eliminate issue\n- Tested windows from 8 samples to 20ms - improvement but not resolution\n- Compressor/limiter not the cause (crackles present even when disabled)\n\n## Key Files\n\n- `scripts/audio_processor.py` - Audio processing with interpolation fix\n- `scripts/mlx_tts_core.py` - Streaming generation in `_generate_streaming_with_metrics()`\n- `scripts/diagnose_clipping.py` - Diagnostic tool\n- `scripts/tts_config.py` - Configuration\n\n## Success Criteria\n\nStreaming mode audio should be indistinguishable from non-streaming mode - no audible artifacts at chunk boundaries while maintaining low TTFT (~0.2s).\n\n## Testing Approach\n\nAll child tasks MUST use `/tdd-cycle` skill. Test with:\n```bash\nuv run python -c \"\nimport sys; sys.path.insert(0, 'scripts')\nfrom mlx_tts_core import generate_speech, get_model\ntest_text = 'The quick brown fox jumps over the lazy dog. This is a longer sentence to test audio quality.'\ngenerate_speech(test_text, stream=True, play=True)\n\"\n```\n\nCompare against non-streaming baseline for quality assessment.","notes":"## Final Conclusion (2025-12-28)\n\n### Listening Test Results\nConducted comprehensive listening tests comparing:\n- Baseline (no processing) - audible clicks\n- OLA with 10ms, 20ms, 30ms crossfade - 20ms eliminates clicks\n- DC blocker alone (R=0.998, 0.995, 0.99) - still has clicks\n- OLA + DC combined - no improvement over OLA alone\n- Order test (OLAâ†’DC vs DCâ†’OLA) - order doesn't matter because DC doesn't help\n\n### Key Finding\n**DC blocker does not contribute to audio quality.** The crackles are caused by instantaneous sample value discontinuities (3-5% amplitude jumps), not DC offset drift. DC blocker operates on very low frequencies (~3-15Hz) which is irrelevant to click artifacts.\n\n### Recommended Solution\n**OLA with 20ms crossfade is the complete solution.**\n\nSignal chain: Raw chunks â†’ OLA (20ms) â†’ Compressor/Limiter â†’ Output\n\nNo DC blocker needed.\n\n### Implementation Status\n- OLA implementation complete in audio_processor.py (create_ola_processor, create_processor_with_ola)\n- 25 unit tests passing\n- Ready for integration into streaming pipeline","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-28T18:50:07.061385-08:00","created_by":"agrande","updated_at":"2025-12-28T21:00:08.328648-08:00","closed_at":"2025-12-28T21:00:08.328648-08:00"}
{"id":"mlx-tts-e95.1","title":"Implement overlap-add synthesis for seamless chunk stitching","description":"## Overview\nImplement overlap-add (OLA) synthesis - the standard DSP technique for artifact-free audio chunk processing.\n\n## Technical Approach\n1. Each chunk gets windowed with a symmetric window (Hann recommended)\n2. Consecutive chunks overlap by 50%\n3. Overlapping regions are summed together\n4. The window function ensures smooth amplitude transitions\n\n## Implementation Location\n`scripts/audio_processor.py` - modify `create_processor()` function\n\n## Key Code\n```python\ndef overlap_add_processor(chunk_size, overlap_ratio=0.5):\n    hop_size = int(chunk_size * (1 - overlap_ratio))\n    window = np.hanning(chunk_size)\n    buffer = None\n    \n    def process(audio_chunk):\n        nonlocal buffer\n        windowed = audio_chunk * window\n        if buffer is None:\n            buffer = windowed\n            return np.array([])\n        output = buffer[:hop_size].copy()\n        # Handle overlap-add logic...\n        return output\n    return process\n```\n\n## Challenges\n- Variable chunk sizes from MLX\n- First/last chunk edge cases\n- ~50% chunk buffer adds slight latency\n- Must integrate with compressor/limiter pipeline\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Unit: OLA produces continuous output for discontinuous input\n2. Unit: Window function correctly applied\n3. Integration: Compare streaming vs non-streaming quality\n4. Manual: Listening test with long text\n\n## Success Criteria\n- No audible clicks/crackles\n- TTFT \u003c 0.5s\n- RTF not significantly degraded","notes":"## Methodology (Required)\n\n**Before writing any code or tests:**\n\n1. Create a subjective human listening test script\n2. Generate long spoken text that explicitly mentions the current setting value\n3. Test with several potential parameter values (e.g., 10ms, 20ms, 50ms, 100ms)\n4. Present audio samples for human judgment\n5. Only proceed with full `/tdd-cycle` after user approves the direction\n\nExample test text template:\n\"This audio is using [SETTING_NAME] set to [VALUE]. Listen for any clicks, crackles, or artifacts in this longer passage that gives you time to evaluate the audio quality...\"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T18:56:47.945332-08:00","created_by":"agrande","updated_at":"2025-12-28T21:00:01.907073-08:00","closed_at":"2025-12-28T21:00:01.907073-08:00","dependencies":[{"issue_id":"mlx-tts-e95.1","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:56:47.947135-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.10","title":"Experiment with larger streaming_interval chunk sizes","description":"## Overview\nCurrent `streaming_interval=0.5` produces many small chunks (~29 for a 14s clip). Larger intervals mean fewer chunk boundaries = fewer discontinuities.\n\n## Current Setting\nIn `scripts/tts_config.py`:\n```python\nDEFAULT_STREAMING_INTERVAL = 0.5  # seconds\n```\n\nUsed in `mlx_tts_core.py`:\n```python\nfor result in model.generate(\n    text,\n    stream=True,\n    streaming_interval=streaming_interval,  # 0.5s default\n):\n```\n\n## Trade-off Analysis\n| Interval | Chunks (14s audio) | TTFT | Boundaries |\n|----------|-------------------|------|------------|\n| 0.5s     | ~29               | ~0.2s| 28         |\n| 1.0s     | ~14               | ~0.5s| 13         |\n| 2.0s     | ~7                | ~1.0s| 6          |\n| 3.0s     | ~5                | ~1.5s| 4          |\n\nHypothesis: Fewer boundaries = fewer crackles, but higher TTFT.\n\n## Experiment\n```bash\n# Test different intervals\nfor interval in 0.5 1.0 2.0 3.0; do\n  echo \"Testing streaming_interval=$interval\"\n  TTS_STREAMING_INTERVAL=$interval uv run python -c \"\nimport sys; sys.path.insert(0, 'scripts')\nfrom mlx_tts_core import generate_speech\ngenerate_speech('The quick brown fox jumps over the lazy dog. This is a longer test.', stream=True, play=True, return_metrics=True)\n\"\ndone\n```\n\n## Implementation (make configurable)\nIn `tts_config.py`, add env var override:\n```python\ndef get_streaming_interval() -\u003e float:\n    return float(os.environ.get(\"TTS_STREAMING_INTERVAL\", \n                 _load_config().get(\"streaming_interval\", DEFAULT_STREAMING_INTERVAL)))\n```\n\n## Key Questions\n1. At what interval do crackles become inaudible?\n2. Is the TTFT trade-off acceptable?\n3. Does interval affect audio quality beyond boundaries?\n4. Could this combine with interpolation fixes for best of both?\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Parameterized test with intervals: 0.5, 1.0, 2.0, 3.0s\n2. Measure TTFT for each\n3. Count chunks produced\n4. Manual listening for crackles at each interval\n5. Document sweet spot (if found)\n\n## Success Criteria\n- Identify if larger intervals eliminate crackles\n- Quantify TTFT vs quality trade-off\n- Recommend optimal default or add to config options","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T19:01:39.986594-08:00","created_by":"agrande","updated_at":"2025-12-28T19:17:29.885325-08:00","closed_at":"2025-12-28T19:17:29.885325-08:00","dependencies":[{"issue_id":"mlx-tts-e95.10","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T19:01:39.990307-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.2","title":"Experiment with larger interpolation windows (50-100ms)","description":"## Overview\nQuick experiment to test if larger interpolation windows eliminate crackles. Current 20ms helps but doesn't fully resolve.\n\n## Current Implementation\nIn `scripts/audio_processor.py`:\n```python\nINTERP_MS = 20.0\ninterp_samples = max(4, int(sample_rate * INTERP_MS / 1000))\ninterp_curve = np.cos(np.linspace(0, np.pi / 2, interp_samples, dtype=np.float32)) ** 2\n```\n\n## Experiment Plan\nTest: 50ms, 75ms, 100ms windows\nFor each: listen for crackles, check quality degradation, assess intelligibility\n\n## Quick Test\n```python\nINTERP_MS = float(os.environ.get(\"TTS_INTERP_MS\", \"20.0\"))\n```\n```bash\nTTS_INTERP_MS=50 uv run python -c \"\nimport sys; sys.path.insert(0, 'scripts')\nfrom mlx_tts_core import generate_speech\ngenerate_speech('The quick brown fox jumps over the lazy dog.', stream=True, play=True)\n\"\n```\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Parameterized test with different window sizes\n2. Verify curve sizing\n3. Manual A/B listening comparison\n\n## Success Criteria\n- Find optimal window size that eliminates crackles\n- Document quality trade-offs\n- Update default if successful","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-28T18:57:07.9362-08:00","created_by":"agrande","updated_at":"2025-12-28T19:10:28.144341-08:00","closed_at":"2025-12-28T19:10:28.144341-08:00","dependencies":[{"issue_id":"mlx-tts-e95.2","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:57:07.937855-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.3","title":"Implement adaptive interpolation window based on discontinuity magnitude","description":"## Overview\nDynamically size the interpolation window based on discontinuity magnitude. Large jumps need more samples; small jumps need fewer.\n\n## Implementation\n```python\ndef calculate_adaptive_window(discontinuity, sample_rate, base_ms=20.0, max_ms=100.0):\n    SMALL_DISC = 0.01   # 1% - minimal correction\n    LARGE_DISC = 0.05   # 5% - full correction\n    \n    disc_abs = abs(discontinuity)\n    if disc_abs \u003c SMALL_DISC:\n        return int(sample_rate * base_ms / 1000)\n    elif disc_abs \u003e= LARGE_DISC:\n        return int(sample_rate * max_ms / 1000)\n    else:\n        ratio = (disc_abs - SMALL_DISC) / (LARGE_DISC - SMALL_DISC)\n        ms = base_ms + ratio * (max_ms - base_ms)\n        return int(sample_rate * ms / 1000)\n```\n\n## Integration in audio_processor.py\n```python\ndisc = audio_f32[0] - state[\"prev_last\"]\ninterp_samples = calculate_adaptive_window(disc, sample_rate)\n# Pre-compute curves for common sizes to avoid regeneration cost\n```\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Unit: Window scaling function with known inputs\n2. Unit: Small discontinuity â†’ small window\n3. Unit: Large discontinuity â†’ large window\n4. Integration: Run diagnose_clipping.py to analyze discontinuity distribution\n\n## Success Criteria\n- Crackles eliminated for typical discontinuity sizes\n- Processing overhead not increased\n- No artifacts from variable windows","notes":"## Finding: Approach Not Viable\n\nAll tested interpolation window sizes (5ms, 10ms, 20ms, 50ms, 100ms) produced audible artifacts during subjective listening tests.\n\n**Discontinuity Distribution Observed:**\n- Small (\u003c1%): 52.1% of boundaries\n- Medium (1-5%): 37.5%\n- Large (\u003e=5%): 10.4% (max 14.9%)\n\n**Conclusion:** The linear interpolation approach to fixing chunk boundary discontinuities does not eliminate artifacts regardless of window size. Adaptive window sizing would not help since even the best fixed window sizes had artifacts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T18:57:21.145293-08:00","created_by":"agrande","updated_at":"2025-12-28T20:11:09.207436-08:00","closed_at":"2025-12-28T20:11:09.207436-08:00","dependencies":[{"issue_id":"mlx-tts-e95.3","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:57:21.14698-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.4","title":"Implement bidirectional interpolation (modify both chunk ends)","description":"## Overview\nCurrent interpolation only modifies START of each chunk. Explore modifying BOTH ends for smoother transitions.\n\n## Options\n\n### A: One-chunk delay buffer (accurate, +0.5s latency)\nBuffer each chunk, modify end when next chunk arrives\n\n### B: Predictive fade (no latency)\n```python\nfade_samples = 32\nfade_curve = np.linspace(1.0, 0.8, fade_samples)\naudio_f32[-fade_samples:] *= fade_curve\n```\n\n### C: Symmetric interpolation\n- Start: interpolate from prev_last to actual\n- End: interpolate from actual toward running average\n\n## Implementation Location\n`scripts/audio_processor.py` in `create_processor()`\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Unit: End-of-chunk modification applied correctly\n2. Unit: Chunk delay maintains sample accuracy (Option A)\n3. Integration: A/B compare with unidirectional\n4. Latency: Measure TTFT impact\n\n## Success Criteria\n- Improved quality over unidirectional\n- Acceptable latency increase\n- No new artifacts","notes":"## Methodology (Required)\n\n**Before writing any code or tests:**\n\n1. Create a subjective human listening test script\n2. Generate long spoken text that explicitly mentions the current setting value\n3. Test with several potential parameter values (e.g., 10ms, 20ms, 50ms, 100ms)\n4. Present audio samples for human judgment\n5. Only proceed with full `/tdd-cycle` after user approves the direction\n\nExample test text template:\n\"This audio is using [SETTING_NAME] set to [VALUE]. Listen for any clicks, crackles, or artifacts in this longer passage that gives you time to evaluate the audio quality...\"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T18:57:34.433572-08:00","created_by":"agrande","updated_at":"2025-12-28T20:18:27.447399-08:00","closed_at":"2025-12-28T20:18:27.447399-08:00","dependencies":[{"issue_id":"mlx-tts-e95.4","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:57:34.43516-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.5","title":"Implement higher-order interpolation (cubic spline, match derivatives)","description":"## Overview\nCurrent interpolation matches only VALUE (0th derivative). Match higher derivatives (velocity, acceleration) for smoother transitions.\n\n## Cubic Hermite Spline\n```python\ndef cubic_hermite_interpolation(y0, y1, dy0, dy1, n_samples):\n    t = np.linspace(0, 1, n_samples)\n    h00 = 2*t**3 - 3*t**2 + 1\n    h10 = t**3 - 2*t**2 + t\n    h01 = -2*t**3 + 3*t**2\n    h11 = t**3 - t**2\n    return h00*y0 + h10*dy0 + h01*y1 + h11*dy1\n```\n\n## Derivative Estimation\n```python\n# End of previous chunk\nprev_derivative = (prev_samples[-1] - prev_samples[-3]) / 2\n\n# Start of current chunk\ncurr_derivative = (curr_samples[2] - curr_samples[0]) / 2\n```\n\n## Integration\n```python\nif state[\"prev_last\"] is not None and state[\"prev_derivative\"] is not None:\n    curr_deriv = (audio_f32[2] - audio_f32[0]) / 2\n    correction = cubic_hermite_interpolation(\n        y0=state[\"prev_last\"], y1=audio_f32[0],\n        dy0=state[\"prev_derivative\"], dy1=curr_deriv,\n        n_samples=interp_samples\n    )\n    audio_f32[:interp_samples] = correction\n```\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Unit: Cubic Hermite produces smooth curve\n2. Unit: Derivative estimation accuracy\n3. Unit: Boundary conditions met\n4. Visual: Plot curves\n5. Manual listening test\n\n## Success Criteria\n- Smoother than raised cosine\n- No new artifacts\n- Comparable computational cost","notes":"## Methodology (Required)\n\n**Before writing any code or tests:**\n\n1. Create a subjective human listening test script\n2. Generate long spoken text that explicitly mentions the current setting value\n3. Test with several potential parameter values (e.g., 10ms, 20ms, 50ms, 100ms)\n4. Present audio samples for human judgment\n5. Only proceed with full `/tdd-cycle` after user approves the direction\n\nExample test text template:\n\"This audio is using [SETTING_NAME] set to [VALUE]. Listen for any clicks, crackles, or artifacts in this longer passage that gives you time to evaluate the audio quality...\"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T18:57:49.014729-08:00","created_by":"agrande","updated_at":"2025-12-28T20:22:24.716079-08:00","closed_at":"2025-12-28T20:22:24.716079-08:00","dependencies":[{"issue_id":"mlx-tts-e95.5","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:57:49.016449-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.6","title":"Add DC offset removal / high-pass filter at chunk boundaries","description":"## Overview\nSome discontinuities may be DC offset drift. A high-pass filter or DC blocker removes low-frequency baseline shifts.\n\n## Options\n\n### A: Per-chunk DC removal\n```python\ndef remove_dc(audio):\n    return audio - np.mean(audio)\n```\n\n### B: Streaming DC blocker\n```python\ndef create_dc_blocker(R=0.998):\n    state = {\"x_prev\": 0.0, \"y_prev\": 0.0}\n    def process(audio):\n        # y[n] = x[n] - x[n-1] + R * y[n-1]\n        output = np.zeros_like(audio)\n        for i, x in enumerate(audio):\n            y = x - state[\"x_prev\"] + R * state[\"y_prev\"]\n            output[i] = y\n            state[\"x_prev\"], state[\"y_prev\"] = x, y\n        return output\n    return process\n```\n\n### C: Boundary DC matching\n```python\nprev_dc = np.mean(prev_chunk[-100:])\ncurr_dc = np.mean(curr_chunk[:100])\nreturn curr_chunk - (curr_dc - prev_dc)\n```\n\n## Diagnostic\n```bash\nuv run python -c \"\nimport sys; sys.path.insert(0, 'scripts')\nfrom mlx_tts_core import get_model\nimport numpy as np\nmodel = get_model()\nfor i, result in enumerate(model.generate('Test', stream=True)):\n    dc = np.mean(result.audio)\n    print(f'Chunk {i}: DC = {dc:.6f}')\n\"\n```\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Unit: DC blocker removes offset\n2. Unit: Speech frequencies preserved (\u003e80Hz)\n3. Diagnostic: Measure DC at boundaries\n4. A/B: With/without DC removal\n\n## Success Criteria\n- Reduced discontinuities if DC is a factor\n- No bass degradation\n- Minimal overhead","notes":"## Experiment Results (2025-12-28)\n\n### Diagnostic Findings\n- Overall DC offset is tiny (~0.00006)\n- Boundary jumps observed: up to +0.021 (2% of dynamic range)\n- Pattern: chunk starts sometimes have transient DC offset\n\n### Listening Test Results\nTested 7 approaches:\n1. No DC removal (baseline)\n2. Per-chunk DC removal (mean subtraction)\n3. Streaming DC blocker (R=0.998)\n4. **Streaming DC blocker (R=0.995)** - Strong candidate\n5. Boundary DC matching\n6. High-pass filter (20Hz)\n7. High-pass filter (40Hz)\n\n### Recommendation\nStreaming DC blocker with R=0.995 identified as strong candidate.\n\n### Next Steps\n- Implement streaming DC blocker in audio_processor.py\n- Add configurable R parameter\n- Write unit tests","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-28T18:58:13.02044-08:00","created_by":"agrande","updated_at":"2025-12-28T20:59:43.455576-08:00","closed_at":"2025-12-28T20:59:43.455576-08:00","dependencies":[{"issue_id":"mlx-tts-e95.6","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:58:13.022817-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.7","title":"Investigate mlx_audio AudioPlayer for buffer underrun issues","description":"## Overview\nCrackles might be from buffer underruns in AudioPlayer, not just chunk discontinuities. Investigate buffer management.\n\n## Investigation Areas\n\n### 1. Buffer Size Analysis\n```python\nfrom mlx_audio.tts.audio_player import AudioPlayer\nimport inspect\nprint(inspect.getsource(AudioPlayer))\n```\n\n### 2. Buffer Monitoring\n```python\nfor result in model.generate(...):\n    buffer_samples = player.buffered_samples()\n    print(f\"Buffer: {buffer_samples} ({buffer_samples/sample_rate*1000:.1f}ms)\")\n    player.queue_audio(chunk)\n```\n\n### 3. Timing Analysis\n```python\nfor result in model.generate(...):\n    chunk_duration = len(result.audio) / sample_rate\n    time_since_last = now - last_time\n    if time_since_last \u003e chunk_duration:\n        print(f\"WARNING: Slower than realtime!\")\n```\n\n## Potential Fixes\n\n### A: Increase buffer size (if configurable)\n### B: Pre-buffer before starting\n```python\nchunks_to_buffer = 3\nfor result in model.generate(...):\n    if len(buffered) \u003c chunks_to_buffer:\n        buffered.append(chunk)\n    else:\n        if not player.playing:\n            for c in buffered: player.queue_audio(c)\n            player.start_stream()\n        player.queue_audio(chunk)\n```\n### C: Custom AudioPlayer using sounddevice/pyaudio\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Diagnostic: Log buffer levels\n2. Correlate buffer levels with crackles\n3. Before/after if fix found\n\n## Success Criteria\n- Determine if buffer underrun is a factor\n- If yes, fix while maintaining low TTFT\n- Document AudioPlayer behavior","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-28T18:58:31.749632-08:00","created_by":"agrande","updated_at":"2025-12-28T20:00:07.705538-08:00","closed_at":"2025-12-28T20:00:07.705538-08:00","dependencies":[{"issue_id":"mlx-tts-e95.7","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:58:31.752077-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.8","title":"Add config option for streaming quality vs latency trade-off","description":"## Overview\nProvide config to choose: low latency (streaming), high quality (non-streaming), or balanced.\n\n## Implementation\n\n### tts_config.py\n```python\nDEFAULT_AUDIO_MODE = \"streaming\"\n\ndef get_audio_mode() -\u003e str:\n    config = _load_config()\n    return config.get(\"audio_mode\", DEFAULT_AUDIO_MODE)\n\ndef set_audio_mode(mode: str) -\u003e None:\n    if mode not in (\"streaming\", \"quality\", \"balanced\"):\n        raise ValueError(f\"Invalid: {mode}\")\n    _update_config(\"audio_mode\", mode)\n```\n\n### mlx_tts_core.py\n```python\ndef generate_speech(...):\n    audio_mode = tts_config.get_audio_mode()\n    if audio_mode == \"quality\":\n        effective_stream = False\n    elif audio_mode == \"balanced\":\n        effective_stream = True  # + aggressive processing\n    else:\n        effective_stream = stream\n```\n\n### Environment Override\n```python\nAUDIO_MODE = os.environ.get(\"TTS_AUDIO_MODE\", get_audio_mode())\n```\n\n### Usage\n```bash\nTTS_AUDIO_MODE=quality uv run python -c \"from mlx_tts_core import speak_mlx; speak_mlx('Test')\"\n```\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Unit: get_audio_mode() default\n2. Unit: set_audio_mode() validation\n3. Unit: Env var override\n4. Integration: \"quality\" uses non-streaming\n5. Integration: \"streaming\" uses streaming\n\n## Success Criteria\n- Easy mode switching\n- Default \"streaming\" for backwards compat\n- Clear documentation","notes":"## Methodology (Required)\n\n**Before writing any code or tests:**\n\n1. Create a subjective human listening test script\n2. Generate long spoken text that explicitly mentions the current setting value\n3. Test with several potential parameter values (e.g., 10ms, 20ms, 50ms, 100ms)\n4. Present audio samples for human judgment\n5. Only proceed with full `/tdd-cycle` after user approves the direction\n\nExample test text template:\n\"This audio is using [SETTING_NAME] set to [VALUE]. Listen for any clicks, crackles, or artifacts in this longer passage that gives you time to evaluate the audio quality...\"","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-28T18:58:56.198263-08:00","created_by":"agrande","updated_at":"2025-12-28T21:00:02.04139-08:00","closed_at":"2025-12-28T21:00:02.04139-08:00","dependencies":[{"issue_id":"mlx-tts-e95.8","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:58:56.200472-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-e95.9","title":"Experiment with different interpolation curve shapes","description":"## Overview\nCurrent raised cosine (cosÂ²) may not be optimal. Test different curve shapes.\n\n## Current\n```python\ninterp_curve = np.cos(np.linspace(0, np.pi/2, n))**2\n```\n\n## Curves to Test\n\n### 1. Linear\n```python\ncurve = np.linspace(1, 0, n)\n```\n\n### 2. Exponential\n```python\ncurve = np.exp(-np.linspace(0, 5, n))\n```\n\n### 3. Gaussian\n```python\ncurve = np.exp(-np.linspace(0, 3, n)**2 / 2)\n```\n\n### 4. Hann\n```python\ncurve = 0.5 * (1 + np.cos(np.pi * np.linspace(0, 1, n)))\n```\n\n### 5. Blackman-Harris\n```python\nt = np.linspace(0, 0.5, n)\na0, a1, a2, a3 = 0.35875, 0.48829, 0.14128, 0.01168\ncurve = a0 - a1*np.cos(2*np.pi*t) + a2*np.cos(4*np.pi*t) - a3*np.cos(6*np.pi*t)\n```\n\n### 6. Sigmoid\n```python\ncurve = 1 - 1/(1 + np.exp(-np.linspace(-6, 6, n)))\n```\n\n## Testing Approach\n```python\nCURVES = {\n    \"raised_cosine\": lambda n: np.cos(np.linspace(0, np.pi/2, n))**2,\n    \"linear\": lambda n: np.linspace(1, 0, n),\n    # ...\n}\nfor name, fn in CURVES.items():\n    # Generate, listen, rate\n```\n\n## Testing\n**MANDATORY: Use `/tdd-cycle` skill**\n\n1. Unit: Each curve produces valid 1â†’0 transition\n2. Unit: Lengths match expected\n3. Visual: Plot all curves\n4. Listening: A/B comparison\n\n## Success Criteria\n- Identify if any curve outperforms raised cosine\n- Document findings\n- Update default if better found","notes":"## Methodology (Required)\n\n**Before writing any code or tests:**\n\n1. Create a subjective human listening test script\n2. Generate long spoken text that explicitly mentions the current setting value\n3. Test with several potential parameter values (e.g., 10ms, 20ms, 50ms, 100ms)\n4. Present audio samples for human judgment\n5. Only proceed with full `/tdd-cycle` after user approves the direction\n\nExample test text template:\n\"This audio is using [SETTING_NAME] set to [VALUE]. Listen for any clicks, crackles, or artifacts in this longer passage that gives you time to evaluate the audio quality...\"","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-28T18:59:12.443568-08:00","created_by":"agrande","updated_at":"2025-12-28T20:40:02.402902-08:00","closed_at":"2025-12-28T20:40:02.402902-08:00","dependencies":[{"issue_id":"mlx-tts-e95.9","depends_on_id":"mlx-tts-e95","type":"parent-child","created_at":"2025-12-28T18:59:12.445783-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-f6w","title":"tts_tui.py: Voice format indicator in selector","description":"Add format indicator to voice selector showing embedding vs wav status.\n\n## Parent Epic\nmlx-tts-6j9: Voice Embedding Convention System\n\n## Requirements\n\n### .5.1 - Format indicator display\nShow format in voice selector:\n```\nâ”Œâ”€ Voice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ â— sarah          [embedded]      â”‚  â† .safetensors exists\nâ”‚ â—‹ default_voice  [embedded]      â”‚\nâ”‚ â—‹ john           [wav]           â”‚  â† .wav only, not cached\nâ”‚ â—‹ custom_test    [wavâ€¢cached]    â”‚  â† .wav with cache\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### .5.2 - Helper function\n```python\ndef get_voice_display(voice_name: str) -\u003e str:\n    fmt = get_voice_format(voice_name)\n    if fmt == \"safetensors\":\n        return f\"{voice_name}  [embedded]\"\n    elif fmt == \"wav\":\n        if is_cache_valid(f\"assets/{voice_name}.wav\"):\n            return f\"{voice_name}  [wavâ€¢cached]\"\n        return f\"{voice_name}  [wav]\"\n    return voice_name\n```\n\n### .5.3 - Refresh on voice change\nUpdate display after Clone Lab creates new voice\n\n## Files to Modify\n- scripts/tts_tui.py\n\n## Dependencies\n- Requires mlx-tts-6j9.2 (get_voice_format)\n\n## Testing\n**MANDATORY: Use /tdd-cycle**\n- Test indicator shows correct format\n- Test cache status detection\n- Test UI refresh after voice creation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:33:46.77132-08:00","updated_at":"2025-12-26T18:48:39.243241-08:00","closed_at":"2025-12-26T18:48:39.243241-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-f6w","depends_on_id":"mlx-tts-e6g","type":"blocks","created_at":"2025-12-26T18:34:27.989048-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-gzg","title":"Create config schema and TOML structure","description":"Define config.toml schema with sections:\n- [tts] backend, voice, rate, volume\n- [mlx] model, voice_ref, exaggeration, cfg_weight\n- [hooks] enabled hooks, thresholds (duration, tool_calls)\n- [audio] normalization, compression settings\n\nCreate default config template and schema validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T10:13:26.47903-08:00","updated_at":"2025-12-26T10:25:10.425239-08:00","closed_at":"2025-12-26T10:25:10.425239-08:00","close_reason":"Obsolete - config schema already exists as JSON in scripts/tts_config.py. No TOML needed.","labels":["epic:mlx-tts-tzk"],"dependencies":[{"issue_id":"mlx-tts-gzg","depends_on_id":"mlx-tts-4hc","type":"blocks","created_at":"2025-12-26T10:14:02.292472-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-he3","title":"Multi-voice support with bundled and user-provided voices","description":"Bundle multiple voice references in assets/ and allow users to drop custom .wav files in ~/.claude-mlx-tts/voices/. Config wizard will discover available voices and let user select. Requires config wizard infrastructure first.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-25T21:39:04.532291-08:00","updated_at":"2025-12-26T13:06:09.086669-08:00","closed_at":"2025-12-26T13:06:09.086669-08:00","close_reason":"Duplicate of mlx-tts-2yv which has complete architecture","dependencies":[{"issue_id":"mlx-tts-he3","depends_on_id":"mlx-tts-brq","type":"blocks","created_at":"2025-12-25T21:39:09.349734-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-hes","title":"2.1 Add textual dependency to pyproject.toml","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:18.716884-08:00","updated_at":"2025-12-26T13:30:39.133506-08:00","deleted_at":"2025-12-26T13:30:39.133506-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-ikg","title":"Add /say command for direct TTS of any text (smoke test)","description":"Create /say skill that speaks any text directly via TTS. Serves as smoke test for TTS setup. Usage: /say Hello world. Should use MLX if available, fallback to macOS say.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T18:21:33.267385-08:00","updated_at":"2025-12-24T19:03:16.997923-08:00","closed_at":"2025-12-24T19:03:16.997923-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-ikg","depends_on_id":"mlx-tts-pmk","type":"blocks","created_at":"2025-12-24T18:22:16.102692-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-ipj","title":"Phase 6: Polish \u0026 Integration","description":"Add unsaved changes indicator, Save/Reset buttons, System Settings screen, shell wrapper and skill definition.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:28:38.36727-08:00","updated_at":"2025-12-26T13:30:39.128416-08:00","dependencies":[{"issue_id":"mlx-tts-ipj","depends_on_id":"mlx-tts-z1k","type":"blocks","created_at":"2025-12-26T13:28:49.939735-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-ipj","depends_on_id":"mlx-tts-7me","type":"blocks","created_at":"2025-12-26T13:28:50.718596-08:00","created_by":"daemon"}],"deleted_at":"2025-12-26T13:30:39.128416-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-jna","title":"Remove speed controls (Chatterbox doesn't support speed)","description":"## Context\n\nResearch confirmed that the Chatterbox model does NOT support speed control. The `speed` parameter is passed through the mlx_audio server but completely ignored by the model.\n\n### Evidence\n\n```python\n# model.generate() parameters - NO speed parameter!\ntext, ref_audio, temperature, top_p, top_k, \nrepetition_penalty, stream, streaming_interval, ...\n```\n\nThe `speed` field in `SpeechRequest` is designed for OpenAI-compatible TTS models, but Chatterbox doesn't implement it.\n\n### Why not add time-stretching?\n\nTime-stretching (rubberband, WSOLA, phase vocoder) requires lookahead buffering which conflicts with streaming playback:\n- Adds 50-100ms latency per chunk\n- Complex state management across chunks\n- For notifications, latency matters more than speed control\n\n## Scope\n\nRemove speed-related code from:\n\n1. **tts_config.py**\n   - `SPEED_PRESETS` dict\n   - `DEFAULT_SPEED` constant\n   - `get_profile_speed()` / `get_playback_speed()` / `set_playback_speed()`\n   - Speed from `DEFAULT_CONFIG.profiles.default`\n\n2. **tts_tui.py** (System tab)\n   - Speed selector dropdown\n   - `on_select_changed` handling for speed\n\n3. **mlx_server_utils.py**\n   - `_get_configured_speed()` function\n   - `speed` parameter in `speak_mlx_http()`\n   - Speed in payload (or keep but document it's unused)\n\n4. **mlx_tts_core.py**\n   - `_get_configured_speed()` function\n   - `speed` parameter handling in `generate_speech()` / `speak_mlx()`\n\n5. **Tests**\n   - Any speed-related test cases\n\n## Notes\n\n- Keep the code simple - don't pass unused parameters\n- Update any documentation that mentions speed\n- Consider adding a comment explaining why speed isn't supported","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T15:23:39.780142-08:00","updated_at":"2025-12-26T16:52:37.721146-08:00","closed_at":"2025-12-26T16:52:37.721146-08:00","close_reason":"Speed controls removed. Chatterbox model does not support speed adjustment - mlx_audio explicitly ignores the speed parameter for Chatterbox. Removed SPEED_PRESETS, DEFAULT_SPEED, get_playback_speed(), set_playback_speed() from tts_config.py. Removed speed selector from TUI. Updated mlx_server_utils.py and mlx_tts_core.py to remove speed handling. Updated all related tests. All 101 tests pass."}
{"id":"mlx-tts-jyh","title":"Add voice preview/test functionality","description":"Voice preview functionality within the Textual TUI:\n- Play sample text with selected voice\n- Show voice characteristics (language, gender if available)\n- Test MLX voice with reference audio\n\nPart of the Textual TUI implementation.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-26T10:13:26.800861-08:00","updated_at":"2025-12-26T13:30:44.101498-08:00","labels":["epic:mlx-tts-tzk"],"dependencies":[{"issue_id":"mlx-tts-jyh","depends_on_id":"mlx-tts-aye","type":"blocks","created_at":"2025-12-26T10:14:02.342902-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-jyh","depends_on_id":"mlx-tts-5lo","type":"blocks","created_at":"2025-12-26T10:27:53.84341-08:00","created_by":"daemon"}],"deleted_at":"2025-12-26T13:30:44.101498-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-lc0","title":"Add TTS control skills (start/stop/status)","description":"## Objective\nAdd Claude Code slash commands for manual TTS server lifecycle control.\nPackage as part of the plugin for easy install.\n\n## ğŸ”´ğŸŸ¢ TDD Workflow - Use `/tdd-workflows:tdd-orchestrator` Skill\n\n**IMPORTANT**: This task follows strict TDD discipline. Use the TDD orchestrator skill to guide red-green-refactor cycles.\n\n### How to Execute\n1. Start with: `/tdd-workflows:tdd-orchestrator`\n2. Follow the red-green-refactor discipline the skill enforces\n3. Write shell script tests (bats) before implementation\n\n---\n\n## Research Finding\nPlugins support **slash commands** in `commands/` directory:\n- User-invoked via `/plugin-name:command` or just `/command`\n- Defined as Markdown files with YAML frontmatter\n- Scripts referenced via `${CLAUDE_PLUGIN_ROOT}`\n\n## Plugin Structure\n\n```\nclaude-mlx-tts/\nâ”œâ”€â”€ .claude-plugin/\nâ”‚   â””â”€â”€ plugin.json          â† add \"commands\": \"./commands/\"\nâ”œâ”€â”€ commands/                 â† NEW\nâ”‚   â”œâ”€â”€ tts-start.md\nâ”‚   â”œâ”€â”€ tts-stop.md\nâ”‚   â””â”€â”€ tts-status.md\nâ”œâ”€â”€ hooks/\nâ”‚   â””â”€â”€ hooks.json\nâ”œâ”€â”€ tests/                    â† NEW (TDD)\nâ”‚   â””â”€â”€ test_tts_commands.bats\nâ””â”€â”€ scripts/\n    â”œâ”€â”€ tts-notify.py\n    â”œâ”€â”€ tts-start.sh         â† NEW\n    â”œâ”€â”€ tts-stop.sh          â† NEW\n    â””â”€â”€ tts-status.sh        â† NEW\n```\n\n## Implementation Phases (TDD Approach)\n\n### Phase 1: Test Infrastructure\n**ğŸ”´ Red Phase**\n1. Create `tests/test_tts_commands.bats`\n2. Write tests for tts-start.sh behavior\n3. Write tests for tts-stop.sh behavior  \n4. Write tests for tts-status.sh behavior\n5. All tests FAIL (scripts don't exist)\n\n### Phase 2: Script Implementation\n**ğŸŸ¢ Green Phase**\n1. Implement tts-start.sh\n2. Implement tts-stop.sh\n3. Implement tts-status.sh\n4. Tests PASS\n\n### Phase 3: Plugin Integration\n**ğŸ”µ Refactor Phase**\n1. Create command markdown files\n2. Update plugin.json\n3. Verify commands work via Claude\n\n---\n\n## Commands to Implement\n\n### /tts-start\n```markdown\n---\nname: tts-start\ndescription: Start TTS server and preload MLX model (~4GB, takes ~10s)\n---\n\nStart the MLX TTS server on port 21099 and preload the Chatterbox model.\n\n\\`\\`\\`bash\n${CLAUDE_PLUGIN_ROOT}/scripts/tts-start.sh\n\\`\\`\\`\n```\n\n**Script logic:**\n```bash\n#\\!/bin/bash\nPORT=21099\nif lsof -i :$PORT \u003e/dev/null 2\u003e\u00261; then\n    echo \"TTS server already running on port $PORT\"\n    exit 0\nfi\necho \"Starting TTS server on port $PORT...\"\nmlx_audio.server --port $PORT \u0026\nsleep 2\necho \"Preloading model...\"\ncurl -X POST http://localhost:$PORT/v1/models \\\n  -d '{\"model\": \"mlx-community/chatterbox-turbo-fp16\"}'\necho \"Server ready.\"\n```\n\n### /tts-stop\n```markdown\n---\nname: tts-stop\ndescription: Stop TTS server and reclaim ~4GB memory\n---\n\nStop the MLX TTS server and free memory.\n\n\\`\\`\\`bash\n${CLAUDE_PLUGIN_ROOT}/scripts/tts-stop.sh\n\\`\\`\\`\n```\n\n**Script logic:**\n```bash\n#\\!/bin/bash\nPORT=21099\nPID=$(lsof -ti :$PORT)\nif [ -z \"$PID\" ]; then\n    echo \"TTS server not running\"\n    exit 0\nfi\nkill $PID\necho \"TTS server stopped. Memory reclaimed.\"\n```\n\n### /tts-status\n```markdown\n---\nname: tts-status\ndescription: Check TTS server status, model loaded, memory usage\n---\n\nShow TTS server status.\n\n\\`\\`\\`bash\n${CLAUDE_PLUGIN_ROOT}/scripts/tts-status.sh\n\\`\\`\\`\n```\n\n**Script logic:**\n```bash\n#\\!/bin/bash\nPORT=21099\nif \\! lsof -i :$PORT \u003e/dev/null 2\u003e\u00261; then\n    echo \"TTS Server: not running\"\n    echo \"Hint: Will auto-start on next TTS, or run /tts-start\"\n    exit 0\nfi\n\necho \"TTS Server: running on port $PORT\"\n# Query server for model info\nMODELS=$(curl -s http://localhost:$PORT/v1/models)\necho \"Models: $MODELS\"\n# Memory usage\nPID=$(lsof -ti :$PORT)\nMEM=$(ps -o rss= -p $PID | awk '{print $1/1024 \"MB\"}')\necho \"Memory: $MEM\"\n```\n\n## plugin.json Update\n\n```json\n{\n  \"name\": \"claude-mlx-tts\",\n  \"description\": \"Voice-cloned TTS notifications using MLX Chatterbox Turbo\",\n  \"version\": \"1.2.0\",\n  \"author\": {\"name\": \"aperepel\"},\n  \"commands\": \"./commands/\",\n  \"hooks\": \"./hooks/hooks.json\"\n}\n```\n\n## Test Cases (Bats)\n```bash\n@test \"tts-start when not running starts server\" {\n    run ./scripts/tts-start.sh\n    [ \"$status\" -eq 0 ]\n    [[ \"$output\" =~ \"Server ready\" ]]\n}\n\n@test \"tts-start when running says already running\" {\n    # Start first\n    ./scripts/tts-start.sh\n    run ./scripts/tts-start.sh\n    [[ \"$output\" =~ \"already running\" ]]\n}\n\n@test \"tts-stop when running stops server\" {\n    ./scripts/tts-start.sh\n    run ./scripts/tts-stop.sh\n    [ \"$status\" -eq 0 ]\n    [[ \"$output\" =~ \"stopped\" ]]\n}\n```\n\n## Success Metrics\n- [ ] All bats tests pass\n- [ ] Commands packaged in plugin (easy install)\n- [ ] All three commands work from Claude prompt\n- [ ] No manual PATH setup required\n\n## Depends On\n- mlx-tts-5x9 (server integration)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T16:10:58.266754-08:00","updated_at":"2025-12-24T18:03:06.967658-08:00","closed_at":"2025-12-24T18:03:06.967658-08:00","close_reason":"Implemented /tts-start, /tts-stop, /tts-status commands with PermissionRequest hook for auto-approval","dependencies":[{"issue_id":"mlx-tts-lc0","depends_on_id":"mlx-tts-5x9","type":"blocks","created_at":"2025-12-24T16:11:07.607257-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-lc7","title":"3.2 Implement attack/release sliders with envelope update","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:32.848573-08:00","updated_at":"2025-12-26T13:30:39.135655-08:00","deleted_at":"2025-12-26T13:30:39.135655-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-lse","title":"Investigate mlx_audio AudioPlayer for buffer underrun issues","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nThe crackles might not only be from chunk discontinuities but also from buffer underruns in the AudioPlayer. When the player's buffer runs dry, it can cause clicks/pops as the audio stream stutters.\n\n## Investigation Areas\n\n### 1. Buffer Size Analysis\nCheck if AudioPlayer buffer is large enough:\n```python\nfrom mlx_audio.tts.audio_player import AudioPlayer\nimport inspect\n\n# Examine AudioPlayer implementation\nprint(inspect.getsource(AudioPlayer))\n```\n\nKey questions:\n- What's the default buffer size?\n- Is it configurable?\n- Does it auto-tune based on chunk delivery rate?\n\n### 2. Buffer State Monitoring\nAdd logging to monitor buffer fill level:\n```python\n# In mlx_tts_core.py streaming loop\nfor result in model.generate(...):\n    buffer_samples = player.buffered_samples()\n    print(f\"Buffer: {buffer_samples} samples ({buffer_samples/sample_rate*1000:.1f}ms)\")\n    player.queue_audio(audio_chunk)\n```\n\nLook for:\n- Buffer dropping to zero (underrun)\n- Large buffer fluctuations\n- Correlation between low buffer and crackles\n\n### 3. Timing Analysis\nCheck if chunk generation is fast enough:\n```python\nimport time\nfor result in model.generate(...):\n    now = time.perf_counter()\n    chunk_duration = len(result.audio) / sample_rate\n    time_since_last = now - last_time\n    \n    if time_since_last \u003e chunk_duration:\n        print(f\"WARNING: Generation slower than realtime! gap={time_since_last-chunk_duration:.3f}s\")\n    \n    last_time = now\n```\n\n### 4. AudioPlayer Source Review\nLocation of AudioPlayer in mlx_audio package:\n```bash\npython -c \"import mlx_audio.tts.audio_player as ap; print(ap.__file__)\"\n```\n\nReview for:\n- How it handles chunk concatenation internally\n- Buffer management strategy\n- Any known issues or TODOs\n\n## Potential Fixes (if buffer is the issue)\n\n### Option A: Increase buffer size\nIf AudioPlayer accepts buffer configuration, increase it.\n\n### Option B: Pre-buffer before starting\nWait for N chunks before starting playback:\n```python\nchunks_to_buffer = 3\nbuffered = []\nfor result in model.generate(...):\n    if len(buffered) \u003c chunks_to_buffer:\n        buffered.append(audio_processor(result.audio))\n    else:\n        if not player.playing:\n            for chunk in buffered:\n                player.queue_audio(chunk)\n            player.start_stream()\n        player.queue_audio(audio_processor(result.audio))\n```\n\n### Option C: Custom AudioPlayer\nIf mlx_audio's player is inflexible, implement custom using sounddevice or pyaudio.\n\n## Files to Investigate\n- `mlx_audio.tts.audio_player` - External package, read-only investigation\n- `scripts/mlx_tts_core.py` - Our usage of AudioPlayer\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Diagnostic: Log buffer levels during playback\n2. Diagnostic: Correlate buffer levels with audible crackles\n3. If fix identified: Before/after comparison\n\n## Success Criteria\n- Determine if buffer underrun is a contributing factor\n- If yes, implement fix that maintains low TTFT\n- Document AudioPlayer's behavior for future reference\n\n## Notes\n- This may reveal it's NOT a buffer issue, which is also valuable\n- Low RTF (\u003c 1.0) from our tests suggests generation is faster than realtime\n- But network/processing jitter could still cause momentary underruns","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-28T18:54:16.94948-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.882391-08:00","deleted_at":"2025-12-28T18:56:28.882391-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-mtz","title":"Organize tests into directories instead of pytest markers","description":"## Current State\nAll tests are in a flat `tests/` directory using pytest markers for categorization.\n\n## Goal\nReorganize tests into subdirectories:\n- `tests/unit/` - Fast, isolated unit tests (mocked deps)\n- `tests/integration/` - Tests requiring MLX, audio hardware, or server processes\n\n## Requirements\n- **MUST use `/tdd-refactor` skill** when executing this work\n- Migrate existing pytest markers to directory-based organization\n- Update `pyproject.toml` pytest config to reflect new structure\n- Ensure all tests still pass after reorganization\n\n## Files to reorganize\n- test_audio_processor.py\n- test_mlx_tts.py\n- test_permission_notify.py\n- test_server_lifecycle.py\n- test_streaming_tts.py\n- test_tts_config.py\n- test_voice_cache.py","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T11:54:34.302334-08:00","updated_at":"2025-12-26T12:39:47.695801-08:00","closed_at":"2025-12-26T12:39:47.695801-08:00","close_reason":"Reorganized tests into directory-based structure: tests/unit/ for fast isolated tests (191 tests), tests/integration/ for MLX/hardware-dependent tests (4 tests). Updated pyproject.toml to run unit tests by default."}
{"id":"mlx-tts-mvt","title":"Support configurable MLX TTS server port","description":"## Problem\nWhen running multiple Claude Code sessions in parallel worktrees, they may conflict if using the same MLX TTS server port (default 5000).\n\n## Proposed Solution\nAllow configuring the TTS server port via project settings.\n\n## Open Questions (needs elaboration)\n- Configuration format: `.env` file vs `pyproject.toml` vs dedicated config file?\n- Should port be auto-detected/incremented if busy?\n- How to handle client-side discovery of which port the server is using?\n- Should this be per-worktree or user-level configuration?\n\n## Context\nSupports parallel development workflows with multiple worktrees/sessions.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-28T14:55:24.544107-08:00","created_by":"agrande","updated_at":"2025-12-28T14:55:40.477062-08:00"}
{"id":"mlx-tts-n2i","title":"clone_voice.py: Voice cloning CLI script","description":"CLI script to extract voice embeddings from WAV and save as .safetensors.\n\n## Parent Epic\nmlx-tts-6j9: Voice Embedding Convention System\n\n## Requirements\n\n### .6.1 - CLI interface\n```bash\nuv run python scripts/clone_voice.py input.wav my_voice\n# Creates: assets/my_voice.safetensors\n```\n\n### .6.2 - Core extraction logic\n```python\ndef clone_voice(source_wav: str, voice_name: str, output_dir: Path = None):\n    # Validate inputs\n    if not Path(source_wav).exists():\n        raise FileNotFoundError(f\"Source WAV not found: {source_wav}\")\n    \n    if not VOICE_NAME_PATTERN.match(voice_name):\n        raise ValueError(f\"Invalid voice name: {voice_name}\")\n    \n    # Load model and extract\n    model = get_model()\n    model.prepare_conditionals(source_wav)\n    \n    # Save embeddings only (no WAV copy)\n    output = (output_dir or ASSETS_DIR) / f\"{voice_name}.safetensors\"\n    save_conditionals_to_file(model._conds, output)\n    \n    # Report size savings\n    src_size = Path(source_wav).stat().st_size\n    dst_size = output.stat().st_size\n    print(f\"Created {output.name}\")\n    print(f\"  Source: {src_size // 1024}KB â†’ Embedding: {dst_size // 1024}KB\")\n    print(f\"  Savings: {(1 - dst_size/src_size) * 100:.0f}%\")\n```\n\n### .6.3 - Argument parsing\n- --output-dir: Custom output directory\n- --force: Overwrite existing\n- --quiet: Suppress output\n\n## Files to Create\n- scripts/clone_voice.py\n\n## Dependencies\n- Requires mlx-tts-6j9.1 (save_conditionals_to_file)\n\n## Testing\n**MANDATORY: Use /tdd-cycle**\n- Test valid WAV extraction\n- Test invalid inputs (missing file, bad name)\n- Test --force overwrite behavior\n- Integration test with real model","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:33:46.936731-08:00","updated_at":"2025-12-26T18:45:44.2875-08:00","closed_at":"2025-12-26T18:45:44.2875-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-n2i","depends_on_id":"mlx-tts-36a","type":"blocks","created_at":"2025-12-26T18:34:28.017967-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-nnu","title":"Add /summary-say command to summarize and speak long input","description":"Create /summary-say skill that takes long input text, summarizes it to 10-15 words using Claude, then speaks the summary. Reuses summarization logic from tts-notify.py. Usage: /summary-say \u003clong text or paste\u003e","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T18:21:33.481445-08:00","updated_at":"2025-12-24T19:03:16.998849-08:00","closed_at":"2025-12-24T19:03:16.998849-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-nnu","depends_on_id":"mlx-tts-pmk","type":"blocks","created_at":"2025-12-24T18:22:16.305279-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-oi4","title":"Experiment with larger interpolation windows (50-100ms)","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nQuick experiment to test if significantly larger interpolation windows (50-100ms) can eliminate crackles. Current 20ms window helps but doesn't fully resolve the issue.\n\n## Technical Background\n\nCurrent implementation in `scripts/audio_processor.py`:\n```python\nINTERP_MS = 20.0  # Currently set to 20ms\ninterp_samples = max(4, int(sample_rate * INTERP_MS / 1000))\ninterp_curve = np.cos(np.linspace(0, np.pi / 2, interp_samples, dtype=np.float32)) ** 2\n\n# In processor():\nif state[\"prev_last\"] is not None and len(audio_f32) \u003e= interp_samples:\n    disc = audio_f32[0] - state[\"prev_last\"]\n    audio_f32 = audio_f32.copy()\n    audio_f32[:interp_samples] -= disc * interp_curve\n```\n\nThe raised cosine curve smoothly interpolates from the discontinuity to zero correction over N samples.\n\n## Experiment Plan\n\nTest these window sizes:\n1. 50ms (~1200 samples at 24kHz)\n2. 75ms (~1800 samples)\n3. 100ms (~2400 samples)\n\nFor each:\n- Listen for crackles with long test text\n- Measure any perceptible audio quality degradation\n- Check if interpolation affects speech intelligibility\n\n## Implementation\n\nSimple change to `INTERP_MS` constant in `audio_processor.py`.\n\nFor testing, can also make it configurable:\n```python\nINTERP_MS = float(os.environ.get(\"TTS_INTERP_MS\", \"20.0\"))\n```\n\n## Files to Modify\n- `scripts/audio_processor.py` - Change INTERP_MS constant\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Parameterized test with different window sizes\n2. Verify interpolation curve is correctly sized\n3. Manual A/B listening comparison\n\n```bash\n# Test with different window sizes\nTTS_INTERP_MS=50 uv run python -c \"\nimport sys; sys.path.insert(0, 'scripts')\nfrom mlx_tts_core import generate_speech\ngenerate_speech('The quick brown fox jumps over the lazy dog. Testing audio quality.', stream=True, play=True)\n\"\n```\n\n## Success Criteria\n- Find optimal window size that eliminates crackles\n- Document if there's a perceptible quality trade-off\n- If successful, update default INTERP_MS value\n\n## Notes\n- Larger windows mean more of the audio is \"corrected\" which could introduce artifacts\n- At 100ms, we're modifying 10% of each ~1s chunk - may be noticeable\n- This is a quick experiment before investing in overlap-add","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-28T18:51:35.566165-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.879661-08:00","deleted_at":"2025-12-28T18:56:28.879661-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-onv","title":"Permission hook ignores voice customization config","description":"The permission hook (hooks/permission-notify.py) has infrastructure for per-hook voice configuration in tts_config.py but doesn't use it. The speak_mlx() function calls speak_mlx_http(message) without passing the voice parameter. Should use get_effective_hook_voice('permission_request') to get the configured voice and pass it to speak_mlx_http(). Also need to log the voice name in the 'Speaking:' log line.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-27T06:45:37.447937-08:00","updated_at":"2025-12-27T06:46:31.389838-08:00","closed_at":"2025-12-27T06:46:31.389838-08:00","close_reason":"Fixed: speak_notification now uses get_effective_hook_voice('permission_request') and passes voice to speak_mlx(). Log line now includes voice name."}
{"id":"mlx-tts-pgo","title":"Per-voice audio configuration (voice = profile)","description":"## Summary\n\nRedesign config schema so each voice has its own compressor/limiter settings. Voice file = profile identity. No separate profile management needed.\n\n## Schema\n\n```json\n{\n  \"voices\": {\n    \"default_voice\": {\n      \"compressor\": { \"enabled\": true, \"threshold_db\": -18, ... },\n      \"limiter\": { \"enabled\": true, \"threshold_db\": -0.5, ... }\n    },\n    \"soft_voice\": { ... }\n  },\n  \"active_voice\": \"default_voice\",\n  \"hooks\": {\n    \"stop\": { \"voice\": \"default_voice\" },\n    \"permission_request\": { \"voice\": \"soft_voice\" }\n  },\n  \"system\": { \"streaming_interval\": 0.5 }\n}\n```\n\n## TUI Behavior Changes\n\n| Action | Current | New |\n|--------|---------|-----|\n| Select voice | Sets active; audio unchanged | Loads voice's audio settings |\n| Edit compressor | Saves to global | Saves to selected voice |\n| Reset | Resets global | Resets selected voice |\n\n## Key Principles\n\n- 1:1 voice â†” audio settings\n- Hooks reference voices (voice = complete audio package)\n- No profile CRUD - voice files ARE profiles\n- Minimal TUI changes - just wire per-voice load/save","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T17:24:35.577225-08:00","updated_at":"2025-12-26T17:59:01.571731-08:00","closed_at":"2025-12-26T17:59:01.571731-08:00","close_reason":"Per-voice audio configuration complete: schema migrated, getters/setters implemented, TUI wired to load/save per-voice settings","dependencies":[{"issue_id":"mlx-tts-pgo","depends_on_id":"mlx-tts-sdi","type":"blocks","created_at":"2025-12-26T17:25:12.850017-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-pgo","depends_on_id":"mlx-tts-8fl","type":"blocks","created_at":"2025-12-26T17:25:28.639622-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-pgo","depends_on_id":"mlx-tts-dm5","type":"blocks","created_at":"2025-12-26T17:25:34.337294-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-pkm","title":"Add config option for streaming quality vs latency trade-off","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nProvide users a configuration option to choose between:\n- **Low latency** (streaming, potential crackles) - current default\n- **High quality** (non-streaming, no crackles, ~16s TTFT)\n- **Balanced** (streaming with aggressive post-processing)\n\nThis is a fallback if we can't fully eliminate streaming artifacts.\n\n## Implementation\n\n### Config in tts_config.py\n```python\n# Audio quality mode\n# \"streaming\" - Low latency (~0.2s TTFT), may have artifacts\n# \"quality\" - High quality (no artifacts), higher latency (~15s TTFT)\n# \"balanced\" - Streaming with aggressive smoothing (compromise)\nDEFAULT_AUDIO_MODE = \"streaming\"\n\ndef get_audio_mode() -\u003e str:\n    \"\"\"Get configured audio mode.\"\"\"\n    config = _load_config()\n    return config.get(\"audio_mode\", DEFAULT_AUDIO_MODE)\n\ndef set_audio_mode(mode: str) -\u003e None:\n    \"\"\"Set audio mode: 'streaming', 'quality', or 'balanced'.\"\"\"\n    if mode not in (\"streaming\", \"quality\", \"balanced\"):\n        raise ValueError(f\"Invalid audio mode: {mode}\")\n    _update_config(\"audio_mode\", mode)\n```\n\n### Integration in mlx_tts_core.py\n```python\ndef generate_speech(...):\n    # Determine streaming based on audio mode\n    audio_mode = tts_config.get_audio_mode()\n    \n    if audio_mode == \"quality\":\n        # Force non-streaming for maximum quality\n        effective_stream = False\n    elif audio_mode == \"balanced\":\n        # Stream but with more aggressive processing\n        effective_stream = True\n        # Could increase INTERP_MS or enable additional processing\n    else:  # \"streaming\"\n        effective_stream = stream  # Use caller's preference\n```\n\n### Environment Variable Override\n```python\n# Allow quick override without config file changes\nAUDIO_MODE = os.environ.get(\"TTS_AUDIO_MODE\", get_audio_mode())\n```\n\n### CLI/Skill Integration\nAdd to `/tts-config` skill if it exists, or document in README:\n```bash\n# Set via environment\nTTS_AUDIO_MODE=quality uv run python -c \"from mlx_tts_core import speak_mlx; speak_mlx('Test')\"\n\n# Or via config\nuv run python -c \"from tts_config import set_audio_mode; set_audio_mode('quality')\"\n```\n\n## Files to Modify\n- `scripts/tts_config.py` - Add audio_mode setting\n- `scripts/mlx_tts_core.py` - Respect audio_mode in generate_speech()\n- `README.md` - Document the option (if requested)\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Unit test: get_audio_mode() returns default when not set\n2. Unit test: set_audio_mode() validates input\n3. Unit test: Environment variable overrides config\n4. Integration test: \"quality\" mode uses non-streaming\n5. Integration test: \"streaming\" mode uses streaming\n\n## Success Criteria\n- Users can easily switch between modes\n- Default remains \"streaming\" for backwards compatibility\n- Clear documentation of trade-offs\n\n## Notes\n- This is a fallback/escape hatch, not the primary fix\n- Should still pursue eliminating streaming artifacts\n- \"balanced\" mode parameters TBD based on other task findings","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-28T18:54:47.468327-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.883079-08:00","deleted_at":"2025-12-28T18:56:28.883079-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-pmk","title":"Add /tts-init command to install MLX dependencies","description":"Create /tts-init skill that runs 'uv sync --extra mlx' to install MLX dependencies. This provides explicit user control over when the ~4GB model and deps are installed, rather than lazy-loading on first TTS notification. Should show progress and handle errors gracefully.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T18:21:33.04575-08:00","updated_at":"2025-12-24T19:13:20.231407-08:00","closed_at":"2025-12-24T19:13:20.231407-08:00","close_reason":"Closed"}
{"id":"mlx-tts-q05","title":"2.2 Create tts_tui.py with Textual app structure","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:18.879992-08:00","updated_at":"2025-12-26T13:30:39.133963-08:00","deleted_at":"2025-12-26T13:30:39.133963-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-r2h","title":"Enable streaming TTS generation for reduced latency","description":"## Goal\n\nAchieve **lowest possible time-to-first-audio (TTFT)** and minimize perceived latency for TTS notifications.\n\n## Problem\n\nCurrent TTS implementation waits for **complete audio generation** before playback starts, causing 1.25s+ delay before user hears anything.\n\n## Solution\n\nEnable mlx_audio built-in streaming support via `stream=True` and `streaming_interval` parameters.\n\n## Benchmarks (Chatterbox-Turbo, M-series Mac)\n\n| Mode | Time-to-first-audio | Latency Reduction |\n|------|---------------------|-------------------|\n| Non-streaming (current) | ~1.25s | - |\n| Streaming (2.0s interval) | ~0.48s | 62% |\n| Streaming (1.0s interval) | ~0.35s | 72% |\n| **Streaming (0.5s interval)** | **~0.26s** | **79% (target)** |\n\n**Target: 0.5s streaming interval for minimum TTFT (~260ms)**\n\n## Implementation\n\nCore change in `mlx_tts_core.py`:\n\n```python\ngenerate_audio(\n    text=text,\n    model=model,\n    stream=True,              # Enable streaming\n    streaming_interval=0.5,   # 0.5s chunks for lowest TTFT\n    play=True,\n)\n```\n\n## Caveats\n\n1. File saving disabled in stream mode - audio plays but save_path wont work\n2. Shorter intervals = more chunks = slightly more overhead (acceptable tradeoff for lower latency)\n\n## Implementation Requirements\n\nâš ï¸ **Use `/tdd-cycle` skill** when implementing this feature. Write tests first, then implement.\n\n## Acceptance Criteria\n\n- [ ] Add stream=True to generate_speech() in mlx_tts_core.py\n- [ ] Use streaming_interval=0.5 for lowest TTFT\n- [ ] Add streaming_interval config option (default 0.5s)\n- [ ] Verify TTFT ~260ms in practice\n- [ ] Test with various text lengths","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-26T09:52:41.562243-08:00","updated_at":"2025-12-26T10:42:16.342642-08:00","closed_at":"2025-12-26T10:42:16.342642-08:00","close_reason":"Implemented streaming TTS with TDD - 16 tests, stream=True default, 0.5s interval for ~260ms TTFT"}
{"id":"mlx-tts-sdi","title":"Schema migration: move global audio to per-voice","description":"- Add `voices` dict to schema (voice_name -\u003e {compressor, limiter})\n- Migrate existing global compressor/limiter to active_voice entry\n- Keep hooks structure (already references voices)\n- Add schema version for future migrations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T17:25:07.458056-08:00","updated_at":"2025-12-26T17:36:36.579538-08:00","closed_at":"2025-12-26T17:36:36.579538-08:00","close_reason":"Schema migration complete: Added schema_version=1, moved global audio settings to per-voice storage in voices dict, updated getters/setters to operate on active voice"}
{"id":"mlx-tts-sqn","title":"Research mlx_audio Python API","description":"## Objective\nDocument the direct Python API for mlx_audio TTS generation.\n\n## Research Findings (Completed)\n\n### Key API Components\n\n**1. Model Loading** (`mlx_audio.tts.utils`)\n```python\nfrom mlx_audio.tts.utils import load_model\n\n# Returns nn.Module, auto-downloads from HuggingFace if needed\nmodel = load_model(model_path=\"mlx-community/chatterbox-turbo-fp16\")\n```\n- `lazy=False` (default): Loads all weights into memory immediately\n- `lazy=True`: Deferred loading, params load on first use\n- Auto-caches via HuggingFace `snapshot_download()`\n\n**2. Audio Generation** (`mlx_audio.tts.generate`)\n```python\nfrom mlx_audio.tts.generate import generate_audio\n\ngenerate_audio(\n    text=\"Hello world\",\n    model=model,              # Pass pre-loaded model OR string path\n    ref_audio=\"voice.wav\",    # Voice reference for cloning\n    ref_text=\".\",             # Reference transcript (optional)\n    speed=1.6,                # 0.5x to 2.0x\n    play=True,                # Direct playback via AudioPlayer\n    file_prefix=\"output\",     # File output (optional)\n    verbose=False,\n)\n```\n- Returns `None`, outputs via file or AudioPlayer\n- Generator yields objects with `.audio`, `.sample_rate`, `.audio_duration`\n\n**3. Model Reuse Pattern**\n```python\n# Load once, reuse many times\nmodel = load_model(\"mlx-community/chatterbox-turbo-fp16\")\n\n# Subsequent calls skip loading\ngenerate_audio(text=\"First\", model=model, play=True)\ngenerate_audio(text=\"Second\", model=model, play=True)  # No reload\n```\n\n**4. Built-in Server** (`mlx_audio.server`)\n```bash\nmlx_audio.server --host 0.0.0.0 --port 9000\n```\n- REST API: `POST /v1/models` to preload, `GET /v1/models` to list\n- Can keep models warm via model management endpoints\n\n### Memory \u0026 Performance\n- Model size: ~4GB for fp16, ~1GB for 4-bit quantized\n- Cold start: 5-10s (model load + first inference)\n- Warm inference: \u003c1s (model already in memory)\n- `MAX_FILE_SIZE_GB = 5` limit per weight file\n\n### TDD Acceptance Criteria\n\n**Unit Tests (test_mlx_api.py)**\n- [ ] `test_load_model_returns_nn_module`: load_model returns valid nn.Module\n- [ ] `test_load_model_caches`: Second load uses cache (no re-download)\n- [ ] `test_generate_audio_with_preloaded_model`: Accepts model object\n- [ ] `test_generate_audio_with_play_flag`: play=True triggers AudioPlayer\n- [ ] `test_generate_audio_speed_parameter`: speed affects output duration\n\n**Integration Tests (test_mlx_integration.py)**\n- [ ] `test_model_reuse_performance`: Second call faster than first\n- [ ] `test_warm_model_latency_under_1s`: Warm inference \u003c1s\n- [ ] `test_fallback_to_say_on_mlx_failure`: Graceful degradation\n\n**Sources**\n- [mlx-audio GitHub](https://github.com/Blaizzy/mlx-audio)\n- [Chatterbox MLX model](https://huggingface.co/mlx-community/Chatterbox-TTS-fp16)\n- generate.py source: function signature with model reuse pattern\n\n## Status: Research Complete\nReady for implementation in mlx-tts-dno","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:51:28.00252-08:00","updated_at":"2025-12-24T16:03:18.51917-08:00","closed_at":"2025-12-24T16:03:18.51917-08:00","close_reason":"Research complete - documented mlx_audio Python API with TDD acceptance criteria"}
{"id":"mlx-tts-twa","title":"tts_server.py: Pre-load voice conditionals","description":"Update TTS server to pre-load conditionals on startup and handle voice changes.\n\n## Parent Epic\nmlx-tts-6j9: Voice Embedding Convention System\n\n## Requirements\n\n### .4.1 - Pre-load on startup\n```python\nclass TTSServer:\n    def __init__(self):\n        self.model = get_model()\n        self._load_voice()\n    \n    def _load_voice(self):\n        voice = get_active_voice()\n        self.model._conds = get_voice_conditionals(self.model, voice)\n        log.info(f\"Loaded voice: {voice}\")\n```\n\n### .4.2 - Voice change handler\n```python\ndef on_voice_changed(self, new_voice: str):\n    \"\"\"Called when config changes or via API.\"\"\"\n    self.model._conds = get_voice_conditionals(self.model, new_voice)\n    log.info(f\"Switched to voice: {new_voice}\")\n```\n\n### .4.3 - Config file watcher (optional)\nWatch .config/config.json for changes, auto-reload voice\n\n## Files to Modify\n- scripts/tts_server.py\n\n## Dependencies\n- Requires mlx-tts-6j9.1 (voice_cache updates)\n\n## Testing\n**MANDATORY: Use /tdd-cycle**\n- Test server starts with correct voice loaded\n- Test voice switching at runtime\n- Test error handling for invalid voice","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:33:46.609031-08:00","updated_at":"2025-12-26T18:45:17.704051-08:00","closed_at":"2025-12-26T18:45:17.704051-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-twa","depends_on_id":"mlx-tts-36a","type":"blocks","created_at":"2025-12-26T18:34:27.959815-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk","title":"Config TUI for plugin settings","description":"Textual-based TUI for configuring MLX TTS voice settings with per-voice compressor/limiter profiles and audio preview. Two screens: Voice Lab (per-voice audio shaping) and System Settings (streaming interval, server status).","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-26T10:12:04.848491-08:00","updated_at":"2025-12-26T16:05:30.231489-08:00","closed_at":"2025-12-26T16:05:30.231489-08:00","close_reason":"Complete TUI implementation with Voice Lab, Hooks, System tabs, audio preview, reset buttons, and per-hook voice configuration"}
{"id":"mlx-tts-tzk.1","title":"Config Schema \u0026 Persistence","description":"Update tts_config.py with new per-voice schema","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:05.061421-08:00","updated_at":"2025-12-26T14:04:59.95484-08:00","closed_at":"2025-12-26T14:04:59.95484-08:00","close_reason":"All subtasks complete: 48 unit tests + 3 integration tests passing","dependencies":[{"issue_id":"mlx-tts-tzk.1","depends_on_id":"mlx-tts-tzk","type":"parent-child","created_at":"2025-12-26T13:31:05.061801-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.1.1","title":"Update tts_config.py with per-voice schema","description":"Config schema with cascading defaults:\n\n```json\n{\n  \"defaults\": {\n    \"voice\": \"default_voice\",\n    \"speed\": 1.3,\n    \"compressor\": { \"enabled\": true, ... },\n    \"limiter\": { ... }\n  },\n  \"voices\": {\n    \"default_voice\": { },\n    \"alert_voice\": { \"speed\": 1.5, \"compressor\": { \"gain_db\": 10 } }\n  },\n  \"hooks\": {\n    \"permission_request\": { \"voice\": \"alert_voice\" },\n    \"stop\": { }\n  },\n  \"system\": { \"streaming_interval\": 0.5 }\n}\n```\n\nResolution order: hook override â†’ voice settings â†’ defaults\nFuture: per-project scope wraps this structure.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:17.183242-08:00","updated_at":"2025-12-26T14:04:03.838057-08:00","closed_at":"2025-12-26T14:04:03.838057-08:00","close_reason":"Implemented with TDD: 48 unit tests passing","dependencies":[{"issue_id":"mlx-tts-tzk.1.1","depends_on_id":"mlx-tts-tzk.1","type":"parent-child","created_at":"2025-12-26T13:31:17.186767-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.1.2","title":"Implement get_voice_config/set_voice_config","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:17.348814-08:00","updated_at":"2025-12-26T14:04:03.839679-08:00","closed_at":"2025-12-26T14:04:03.839679-08:00","close_reason":"Implemented with TDD: 48 unit tests passing","dependencies":[{"issue_id":"mlx-tts-tzk.1.2","depends_on_id":"mlx-tts-tzk.1","type":"parent-child","created_at":"2025-12-26T13:31:17.349257-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.1.3","title":"Add voice discovery from assets/*.wav","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:17.502833-08:00","updated_at":"2025-12-26T14:04:03.840827-08:00","closed_at":"2025-12-26T14:04:03.840827-08:00","close_reason":"Implemented with TDD: 48 unit tests passing","dependencies":[{"issue_id":"mlx-tts-tzk.1.3","depends_on_id":"mlx-tts-tzk.1","type":"parent-child","created_at":"2025-12-26T13:31:17.50324-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.1.4","title":"Add get_active_voice/set_active_voice","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:17.655093-08:00","updated_at":"2025-12-26T14:04:03.841897-08:00","closed_at":"2025-12-26T14:04:03.841897-08:00","close_reason":"Implemented with TDD: 48 unit tests passing","dependencies":[{"issue_id":"mlx-tts-tzk.1.4","depends_on_id":"mlx-tts-tzk.1","type":"parent-child","created_at":"2025-12-26T13:31:17.655453-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.1.5","title":"Implement secure voice name resolution","description":"Voice names resolve to \u003cplugin\u003e/assets/\u003cname\u003e.wav. Security: reject path traversal (../, /, \\), only allow alphanumeric/dash/underscore. See mlx-tts-2yv for full spec.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:38:05.296688-08:00","updated_at":"2025-12-26T14:04:03.842977-08:00","closed_at":"2025-12-26T14:04:03.842977-08:00","close_reason":"Implemented with TDD: 48 unit tests passing","dependencies":[{"issue_id":"mlx-tts-tzk.1.5","depends_on_id":"mlx-tts-tzk.1","type":"parent-child","created_at":"2025-12-26T13:38:05.297116-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.1.6","title":"Implement cascading config resolution","description":"Resolve effective config for a given hook: hook override â†’ voice settings â†’ defaults. Function: get_effective_config(hook_type: str) -\u003e EffectiveConfig. Deep merge with defaults as base.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:42:39.887852-08:00","updated_at":"2025-12-26T14:04:03.843987-08:00","closed_at":"2025-12-26T14:04:03.843987-08:00","close_reason":"Implemented with TDD: 48 unit tests passing","dependencies":[{"issue_id":"mlx-tts-tzk.1.6","depends_on_id":"mlx-tts-tzk.1","type":"parent-child","created_at":"2025-12-26T13:42:39.888265-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.2","title":"Core TUI Framework","description":"Set up Textual app structure with screen navigation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:05.220056-08:00","updated_at":"2025-12-26T14:08:52.535424-08:00","closed_at":"2025-12-26T14:08:52.535424-08:00","close_reason":"Core TUI framework implemented with Textual app, screen navigation, voice selector widget, and server status indicator","dependencies":[{"issue_id":"mlx-tts-tzk.2","depends_on_id":"mlx-tts-tzk","type":"parent-child","created_at":"2025-12-26T13:31:05.220402-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-tzk.2","depends_on_id":"mlx-tts-tzk.1","type":"blocks","created_at":"2025-12-26T13:32:09.548851-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.2.1","title":"Add textual dependency to pyproject.toml","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:27.629502-08:00","updated_at":"2025-12-26T14:08:46.069004-08:00","closed_at":"2025-12-26T14:08:46.069004-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.2.1","depends_on_id":"mlx-tts-tzk.2","type":"parent-child","created_at":"2025-12-26T13:31:27.629961-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.2.2","title":"Create tts_tui.py with Textual app structure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:27.775591-08:00","updated_at":"2025-12-26T14:08:46.070291-08:00","closed_at":"2025-12-26T14:08:46.070291-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.2.2","depends_on_id":"mlx-tts-tzk.2","type":"parent-child","created_at":"2025-12-26T13:31:27.775926-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.2.3","title":"Implement screen navigation (Voice Lab, System, About)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:27.925545-08:00","updated_at":"2025-12-26T14:08:46.071301-08:00","closed_at":"2025-12-26T14:08:46.071301-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.2.3","depends_on_id":"mlx-tts-tzk.2","type":"parent-child","created_at":"2025-12-26T13:31:27.925877-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.2.4","title":"Create voice selector widget","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:28.073627-08:00","updated_at":"2025-12-26T14:08:46.072338-08:00","closed_at":"2025-12-26T14:08:46.072338-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.2.4","depends_on_id":"mlx-tts-tzk.2","type":"parent-child","created_at":"2025-12-26T13:31:28.073984-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.2.5","title":"Add TTS server status indicator to UI","description":"Show indicator of whether MLX TTS server is running. Place in unobtrusive location (header/footer). Use green/red dot or similar.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:34:55.580386-08:00","updated_at":"2025-12-26T14:08:46.073627-08:00","closed_at":"2025-12-26T14:08:46.073627-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.2.5","depends_on_id":"mlx-tts-tzk.2","type":"parent-child","created_at":"2025-12-26T13:34:55.580759-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.3","title":"Compressor Section","description":"Build ADSR envelope widget and compressor controls","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:05.380413-08:00","updated_at":"2025-12-26T14:15:47.930761-08:00","closed_at":"2025-12-26T14:15:47.930761-08:00","close_reason":"Compressor widget with ADSR envelope visualization, sliders for all parameters, preset dropdown, and enable toggle","dependencies":[{"issue_id":"mlx-tts-tzk.3","depends_on_id":"mlx-tts-tzk","type":"parent-child","created_at":"2025-12-26T13:31:05.380768-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-tzk.3","depends_on_id":"mlx-tts-tzk.2","type":"blocks","created_at":"2025-12-26T13:32:09.575601-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.3.1","title":"Build ADSR envelope canvas widget","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:37.557284-08:00","updated_at":"2025-12-26T14:15:28.38656-08:00","closed_at":"2025-12-26T14:15:28.38656-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.3.1","depends_on_id":"mlx-tts-tzk.3","type":"parent-child","created_at":"2025-12-26T13:31:37.560618-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.3.2","title":"Implement attack/release sliders with envelope update","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:37.707902-08:00","updated_at":"2025-12-26T14:15:28.387965-08:00","closed_at":"2025-12-26T14:15:28.387965-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.3.2","depends_on_id":"mlx-tts-tzk.3","type":"parent-child","created_at":"2025-12-26T13:31:37.708293-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.3.3","title":"Add threshold/ratio/gain sliders","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:37.862226-08:00","updated_at":"2025-12-26T14:15:28.38911-08:00","closed_at":"2025-12-26T14:15:28.38911-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.3.3","depends_on_id":"mlx-tts-tzk.3","type":"parent-child","created_at":"2025-12-26T13:31:37.8626-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.3.4","title":"Create preset dropdown (Punchy, Broadcast, Gentle, Podcast)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:38.019669-08:00","updated_at":"2025-12-26T14:15:28.39014-08:00","closed_at":"2025-12-26T14:15:28.39014-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.3.4","depends_on_id":"mlx-tts-tzk.3","type":"parent-child","created_at":"2025-12-26T13:31:38.020028-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.3.5","title":"Wire compressor Enabled toggle","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:38.175808-08:00","updated_at":"2025-12-26T14:15:28.391075-08:00","closed_at":"2025-12-26T14:15:28.391075-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mlx-tts-tzk.3.5","depends_on_id":"mlx-tts-tzk.3","type":"parent-child","created_at":"2025-12-26T13:31:38.17616-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.4","title":"Limiter Section","description":"Build limiter controls as a form (no visualizations).\n\n## Form Design Guidelines (from Compressor implementation)\n\n**Widget Structure:**\n- Use `FormField` class for label + input + unit layout\n- Container with border, padding, centered width (~50 chars)\n- Header row: Switch (enable) + Label + Select (presets)\n- Vertical stack of FormField widgets\n\n**FormField specs:**\n- Label: 14 chars wide, right-padded\n- Input: 12 chars wide, restrict to `^-?[0-9]*\\.?[0-9]*$` (no scientific notation)\n- Unit: 4 chars, muted color, displayed OUTSIDE the input field\n\n**No sliders, no visualizations** - just clean form fields.\n\n**Limiter fields needed:**\n- Threshold (dB): min=-20, max=0\n- Release (ms): min=10, max=200\n\n**Presets to consider:** Transparent, Brick Wall, Soft Clip","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:05.547126-08:00","updated_at":"2025-12-26T14:47:16.897808-08:00","closed_at":"2025-12-26T14:47:16.897808-08:00","close_reason":"Implemented LimiterWidget with FormField controls for threshold and release, plus presets dropdown (Transparent, Brick Wall, Soft Clip)","dependencies":[{"issue_id":"mlx-tts-tzk.4","depends_on_id":"mlx-tts-tzk","type":"parent-child","created_at":"2025-12-26T13:31:05.547482-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-tzk.4","depends_on_id":"mlx-tts-tzk.3","type":"blocks","created_at":"2025-12-26T13:32:09.600695-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.4.1","title":"Create LimiterWidget with FormField controls","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:45.47424-08:00","updated_at":"2025-12-26T14:47:16.894124-08:00","closed_at":"2025-12-26T14:47:16.894124-08:00","close_reason":"Implemented LimiterWidget with FormField controls for threshold and release, plus presets dropdown (Transparent, Brick Wall, Soft Clip)","dependencies":[{"issue_id":"mlx-tts-tzk.4.1","depends_on_id":"mlx-tts-tzk.4","type":"parent-child","created_at":"2025-12-26T13:31:45.477758-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.4.2","title":"Add threshold and release FormFields with proper masking","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:45.635176-08:00","updated_at":"2025-12-26T14:47:16.89562-08:00","closed_at":"2025-12-26T14:47:16.89562-08:00","close_reason":"Implemented LimiterWidget with FormField controls for threshold and release, plus presets dropdown (Transparent, Brick Wall, Soft Clip)","dependencies":[{"issue_id":"mlx-tts-tzk.4.2","depends_on_id":"mlx-tts-tzk.4","type":"parent-child","created_at":"2025-12-26T13:31:45.6357-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.4.3","title":"Add limiter presets dropdown (Transparent, Brick Wall, Soft Clip)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:45.795671-08:00","updated_at":"2025-12-26T14:47:16.896693-08:00","closed_at":"2025-12-26T14:47:16.896693-08:00","close_reason":"Implemented LimiterWidget with FormField controls for threshold and release, plus presets dropdown (Transparent, Brick Wall, Soft Clip)","dependencies":[{"issue_id":"mlx-tts-tzk.4.3","depends_on_id":"mlx-tts-tzk.4","type":"parent-child","created_at":"2025-12-26T13:31:45.796029-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.5","title":"Preview System","description":"Add preview phrase display and Play Preview button","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:05.711522-08:00","updated_at":"2025-12-26T15:06:08.821984-08:00","closed_at":"2025-12-26T15:06:08.821984-08:00","close_reason":"Implemented PreviewWidget with preview phrase display, Play Preview button, loading indicator during playback, HTTP server integration with fallback to direct MLX. Added unit tests for fallback logic.","dependencies":[{"issue_id":"mlx-tts-tzk.5","depends_on_id":"mlx-tts-tzk","type":"parent-child","created_at":"2025-12-26T13:31:05.711889-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-tzk.5","depends_on_id":"mlx-tts-tzk.4","type":"blocks","created_at":"2025-12-26T13:32:09.627262-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.5.1","title":"Add preview phrase display area","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:54.728928-08:00","updated_at":"2025-12-26T15:06:03.059739-08:00","closed_at":"2025-12-26T15:06:03.059739-08:00","close_reason":"Implemented PreviewWidget with phrase display, Play button, loading indicator, and fallback to direct MLX when server unavailable","dependencies":[{"issue_id":"mlx-tts-tzk.5.1","depends_on_id":"mlx-tts-tzk.5","type":"parent-child","created_at":"2025-12-26T13:31:54.729326-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.5.2","title":"Implement Play Preview button","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:54.87249-08:00","updated_at":"2025-12-26T15:06:03.06102-08:00","closed_at":"2025-12-26T15:06:03.06102-08:00","close_reason":"Implemented PreviewWidget with phrase display, Play button, loading indicator, and fallback to direct MLX when server unavailable","dependencies":[{"issue_id":"mlx-tts-tzk.5.2","depends_on_id":"mlx-tts-tzk.5","type":"parent-child","created_at":"2025-12-26T13:31:54.87583-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.5.3","title":"Integrate with speak_mlx_http() for playback","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:55.028828-08:00","updated_at":"2025-12-26T15:06:03.062154-08:00","closed_at":"2025-12-26T15:06:03.062154-08:00","close_reason":"Implemented PreviewWidget with phrase display, Play button, loading indicator, and fallback to direct MLX when server unavailable","dependencies":[{"issue_id":"mlx-tts-tzk.5.3","depends_on_id":"mlx-tts-tzk.5","type":"parent-child","created_at":"2025-12-26T13:31:55.029267-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.5.4","title":"Add loading indicator during playback","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:55.188168-08:00","updated_at":"2025-12-26T15:06:03.063247-08:00","closed_at":"2025-12-26T15:06:03.063247-08:00","close_reason":"Implemented PreviewWidget with phrase display, Play button, loading indicator, and fallback to direct MLX when server unavailable","dependencies":[{"issue_id":"mlx-tts-tzk.5.4","depends_on_id":"mlx-tts-tzk.5","type":"parent-child","created_at":"2025-12-26T13:31:55.188551-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.5.5","title":"Cache voice embeddings in consistent location","description":"Voice embeddings cached at .cache/voice_conds/ keyed by voice name hash. Same location used by runtime TTS. Memory cache in TUI process, disk cache persists. Design supports multi-voice caching per mlx-tts-2yv.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:34:55.283701-08:00","updated_at":"2025-12-26T15:06:03.064204-08:00","closed_at":"2025-12-26T15:06:03.064204-08:00","close_reason":"Implemented PreviewWidget with phrase display, Play button, loading indicator, and fallback to direct MLX when server unavailable","dependencies":[{"issue_id":"mlx-tts-tzk.5.5","depends_on_id":"mlx-tts-tzk.5","type":"parent-child","created_at":"2025-12-26T13:34:55.284091-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.5.6","title":"Exercise MLX invocation fallback path","description":"Preview must try server first (speak_mlx_http), then fallback to direct API call if server unavailable","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:34:55.429731-08:00","updated_at":"2025-12-26T15:06:03.065126-08:00","closed_at":"2025-12-26T15:06:03.065126-08:00","close_reason":"Implemented PreviewWidget with phrase display, Play button, loading indicator, and fallback to direct MLX when server unavailable","dependencies":[{"issue_id":"mlx-tts-tzk.5.6","depends_on_id":"mlx-tts-tzk.5","type":"parent-child","created_at":"2025-12-26T13:34:55.430112-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.6","title":"Polish \u0026 Integration","description":"Save/Reset buttons, System Settings screen, shell wrapper","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:31:05.881376-08:00","updated_at":"2025-12-26T16:05:20.485787-08:00","closed_at":"2025-12-26T16:05:20.485787-08:00","close_reason":"All polish \u0026 integration subtasks completed: shell wrapper, hooks tab, system settings, reset buttons, auto-save indicator","dependencies":[{"issue_id":"mlx-tts-tzk.6","depends_on_id":"mlx-tts-tzk","type":"parent-child","created_at":"2025-12-26T13:31:05.881748-08:00","created_by":"daemon"},{"issue_id":"mlx-tts-tzk.6","depends_on_id":"mlx-tts-tzk.5","type":"blocks","created_at":"2025-12-26T13:32:09.654171-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.6.1","title":"Add unsaved changes indicator","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:32:02.927982-08:00","updated_at":"2025-12-26T16:05:14.599183-08:00","closed_at":"2025-12-26T16:05:14.599183-08:00","close_reason":"Added auto-save notification and Reset buttons to Compressor/Limiter widgets","dependencies":[{"issue_id":"mlx-tts-tzk.6.1","depends_on_id":"mlx-tts-tzk.6","type":"parent-child","created_at":"2025-12-26T13:32:02.931282-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.6.2","title":"Implement Save/Reset Defaults buttons","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:32:03.076627-08:00","updated_at":"2025-12-26T16:05:14.600426-08:00","closed_at":"2025-12-26T16:05:14.600426-08:00","close_reason":"Added auto-save notification and Reset buttons to Compressor/Limiter widgets","dependencies":[{"issue_id":"mlx-tts-tzk.6.2","depends_on_id":"mlx-tts-tzk.6","type":"parent-child","created_at":"2025-12-26T13:32:03.076989-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.6.3","title":"Create System Settings screen","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:32:03.230354-08:00","updated_at":"2025-12-26T16:02:54.395893-08:00","closed_at":"2025-12-26T16:02:54.395893-08:00","close_reason":"System Settings already exists as a tab in TUI with server status, speed, and streaming interval controls","dependencies":[{"issue_id":"mlx-tts-tzk.6.3","depends_on_id":"mlx-tts-tzk.6","type":"parent-child","created_at":"2025-12-26T13:32:03.23068-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.6.4","title":"Create shell wrapper and skill definition","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:32:03.379598-08:00","updated_at":"2025-12-26T15:57:56.984027-08:00","closed_at":"2025-12-26T15:57:56.984027-08:00","close_reason":"Updated tts-config.md to output the uv run command for launching the TUI","dependencies":[{"issue_id":"mlx-tts-tzk.6.4","depends_on_id":"mlx-tts-tzk.6","type":"parent-child","created_at":"2025-12-26T13:32:03.38002-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-tzk.6.5","title":"Add per-hook config section to TUI","description":"UI section to configure per-hook overrides. Initially just 'permission_request' and 'stop' hooks. Allow selecting voice override per hook. Place in Voice Lab screen or dedicated Hooks tab.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:42:40.039752-08:00","updated_at":"2025-12-26T16:02:38.506304-08:00","closed_at":"2025-12-26T16:02:38.506304-08:00","close_reason":"Added Hooks tab to TUI with per-hook voice selectors for stop and permission_request hooks","dependencies":[{"issue_id":"mlx-tts-tzk.6.5","depends_on_id":"mlx-tts-tzk.6","type":"parent-child","created_at":"2025-12-26T13:42:40.040128-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-ux8","title":"3.1 Build ADSR envelope canvas widget","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T13:29:32.685746-08:00","updated_at":"2025-12-26T13:30:39.135239-08:00","deleted_at":"2025-12-26T13:30:39.135239-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-w4b","title":"Add dynamic voice compressor/limiter using Pedalboard","description":"## Overview\nAdd dynamic range compression and limiting to streaming TTS output to ensure consistent volume levels and prevent clipping.\n\n## Chosen Preset: notification_punch\nBased on A/B testing, selected for clear, present audio output.\n\n### Default Parameters\n```python\nCOMPRESSOR_DEFAULTS = {\n    'threshold_db': -18,\n    'ratio': 3.0,\n    'attack_ms': 3,\n    'release_ms': 50,\n}\n\nLIMITER_DEFAULTS = {\n    'threshold_db': -0.5,\n    'release_ms': 40,\n}\n\nGAIN_DEFAULTS = {\n    'gain_db': 4,\n}\n```\n\n## Design Requirements\n\n### Configurable per-request\n- All compressor/limiter/gain parameters exposed as function arguments\n- Defaults loaded from config system (for future TUI management)\n- Easy override at call site\n\n### Config Integration (for future TUI)\n- Store defaults in config file (JSON or similar)\n- Config keys: `compressor.threshold_db`, `compressor.ratio`, etc.\n- TUI will read/write these values\n- Runtime: load from config, allow per-call override\n\n### API Design\n```python\ndef process_audio_chunk(\n    audio: np.ndarray,\n    sample_rate: int,\n    # Compressor params (None = use config default)\n    threshold_db: float | None = None,\n    ratio: float | None = None,\n    attack_ms: float | None = None,\n    release_ms: float | None = None,\n    # Limiter params\n    limiter_threshold_db: float | None = None,\n    limiter_release_ms: float | None = None,\n    # Gain\n    gain_db: float | None = None,\n    # Master enable\n    enabled: bool = True,\n) -\u003e np.ndarray:\n    ...\n```\n\n## Implementation\n- Use Spotify's **pedalboard** library (~2.5MB, zero Python deps)\n- Integrate into existing streaming audio pipeline\n- Maintain compressor state across chunks (`reset=False`)\n\n## Requirements\n- **Use /tdd-cycle skill** for implementation (TDD workflow required)\n- Add pedalboard to optional dependencies âœ… Done\n\n## References\n- https://github.com/spotify/pedalboard\n- https://spotify.github.io/pedalboard/","notes":"Implementation: audio_processor.py with pedalboard (Compressorâ†’Gainâ†’Limiter). Integrated into streaming. 29 tests. Commit 9e0b73c","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T10:05:40.390123-08:00","updated_at":"2025-12-26T12:06:43.258935-08:00","closed_at":"2025-12-26T12:03:29.189017-08:00","close_reason":"Implemented compressor/limiter using pedalboard with stateful streaming support","dependencies":[{"issue_id":"mlx-tts-w4b","depends_on_id":"mlx-tts-r2h","type":"blocks","created_at":"2025-12-26T10:14:44.879379-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-ww0","title":"Add comprehensive tests for voice caching","description":"## Description\nAdd unit and integration tests for the voice caching system.\n\n## Implementation\nUse `/tdd-cycle` skill - tests should be written FIRST.\n\n### Test cases for tests/test_voice_cache.py:\n```python\nclass TestVoiceCache:\n    def test_cache_path_uses_content_hash(self):\n        '''Same file content â†’ same cache path'''\n    \n    def test_cache_path_changes_with_content(self):\n        '''Different content â†’ different cache path'''\n    \n    def test_save_and_load_conditionals(self):\n        '''Round-trip: save â†’ load â†’ verify identical'''\n    \n    def test_load_missing_cache_returns_none(self):\n        '''Graceful handling of cache miss'''\n    \n    def test_get_or_prepare_caches_on_miss(self):\n        '''First call extracts and caches'''\n    \n    def test_get_or_prepare_uses_cache_on_hit(self):\n        '''Second call uses cache (fast)'''\n    \n    def test_cache_invalidates_on_content_change(self):\n        '''Modified voice file gets new cache entry'''\n\nclass TestVoiceCachePerformance:\n    def test_cached_load_under_10ms(self):\n        '''Loading from cache should be \u003c10ms'''\n    \n    def test_memory_cache_under_1ms(self):\n        '''Memory cache should be \u003c1ms'''\n```\n\n## Acceptance Criteria\n- [ ] All cache operations have test coverage\n- [ ] Performance assertions for cache speedup\n- [ ] Tests run in CI without real model (mocked)\n- [ ] Integration test with real model (optional, slow)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T19:30:10.627556-08:00","updated_at":"2025-12-25T20:42:16.609504-08:00","closed_at":"2025-12-25T20:42:16.609504-08:00","close_reason":"All 23 tests pass including new performance test (cached load \u003c10ms)"}
{"id":"mlx-tts-y7b","title":"Test worktree sync v2","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-31T13:50:58.322166-08:00","created_by":"agrande","updated_at":"2025-12-31T13:50:58.322166-08:00"}
{"id":"mlx-tts-yx3","title":"Implement overlap-add synthesis for seamless chunk stitching","description":"## Parent Epic\nmlx-tts-e95: Fix streaming mode audio quality\n\n## Overview\nImplement overlap-add (OLA) synthesis - the standard DSP technique for artifact-free audio chunk processing. This is the most robust solution used in professional audio software.\n\n## Technical Approach\n\n### Algorithm\n1. Each chunk gets windowed with a symmetric window (Hann recommended)\n2. Consecutive chunks overlap by 50%\n3. Overlapping regions are summed together\n4. The window function ensures smooth amplitude transitions\n\n### Implementation Location\n`scripts/audio_processor.py` - modify `create_processor()` function\n\n### Pseudocode\n```python\ndef overlap_add_processor(chunk_size, overlap_ratio=0.5):\n    hop_size = int(chunk_size * (1 - overlap_ratio))\n    window = np.hanning(chunk_size)\n    buffer = None\n    \n    def process(audio_chunk):\n        nonlocal buffer\n        # Window the input\n        windowed = audio_chunk * window\n        \n        if buffer is None:\n            buffer = windowed\n            return np.array([])  # Need more data\n        \n        # Overlap-add\n        output = buffer[:hop_size].copy()\n        buffer = np.zeros(chunk_size)\n        buffer[:len(windowed)] = windowed\n        # Add overlap region\n        # ... (handle variable chunk sizes)\n        \n        return output\n```\n\n### Challenges\n- Streaming chunks from MLX may have variable sizes\n- Need to handle first/last chunk edge cases\n- May need to buffer ~50% of a chunk before output (slight latency increase)\n- Must integrate with existing compressor/limiter pipeline\n\n## Files to Modify\n- `scripts/audio_processor.py` - Add OLA processing before or after interpolation\n\n## Testing Requirements\n**MANDATORY: Use `/tdd-cycle` skill**\n\nTest cases:\n1. Unit test: Verify OLA produces continuous output for known discontinuous input\n2. Unit test: Verify window function is correctly applied\n3. Integration test: Compare streaming vs non-streaming audio quality\n4. Manual listening test with long text\n\n```bash\n# Diagnostic command\nuv run python scripts/diagnose_clipping.py --real \"Long test text here\"\n```\n\n## Success Criteria\n- No audible clicks/crackles in streaming mode\n- TTFT remains under 0.5s\n- RTF (real-time factor) not significantly degraded\n\n## References\n- https://en.wikipedia.org/wiki/Overlap%E2%80%93add_method\n- Current interpolation code in audio_processor.py lines 50-68","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-28T18:50:56.061773-08:00","created_by":"agrande","updated_at":"2025-12-28T18:56:28.878678-08:00","deleted_at":"2025-12-28T18:56:28.878678-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"mlx-tts-z1k","title":"MLX TTS Config TUI (mlx-tts-tzk)","description":"Textual-based TUI for configuring MLX TTS voice settings with per-voice compressor/limiter profiles and audio preview. Two screens: Voice Lab (per-voice audio shaping) and System Settings (streaming interval, server status).","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2025-12-26T13:28:22.509252-08:00","updated_at":"2025-12-26T13:30:39.12529-08:00","deleted_at":"2025-12-26T13:30:39.12529-08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"epic"}
