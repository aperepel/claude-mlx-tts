{"id":"mlx-tts-1qu","title":"Add logging to tts-notify.py","description":"## Decision\nLog file location: logs/tts-notify.log\n\n## Rationale\n- Fully contained within plugin directory (no external paths)\n- Conventional logs/ directory name\n- Discoverable for debugging\n- Filename matches script name (tts-notify.py â†’ tts-notify.log)\n\n## Implementation\n1. Create logs/ directory if not exists\n2. Add file logging to scripts/tts-notify.py\n3. Log hook invocations, threshold checks, TTS events\n\n## Already done\n- .gitignore updated to exclude logs/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:42:07.067722-08:00","updated_at":"2025-12-24T15:55:01.574085-08:00","closed_at":"2025-12-24T15:55:01.574085-08:00","close_reason":"Implemented file logging to logs/tts-notify.log. Logs hook invocations, threshold checks, TTS engine selection, and errors."}
{"id":"mlx-tts-5x9","title":"Implement TTS background daemon","description":"## Objective\nCreate background daemon that keeps MLX model warm for fast TTS response.\n\n## Architecture\n```\n[tts-daemon.py]              [tts-notify.py]\n     |                              |\n Load model                    Check daemon alive?\n Listen on socket              Yes: send text via socket\n Handle requests               No: fall back to direct API\n Auto-shutdown idle            \n```\n\n## Daemon Features\n1. **Unix domain socket**: /tmp/claude-tts.sock\n2. **Protocol**: JSON over socket\n   - Request: {\"text\": \"...\", \"speed\": 1.6}\n   - Response: {\"status\": \"ok\"} (after audio plays)\n3. **Auto-start**: Hook spawns daemon if not running\n4. **Auto-shutdown**: Exit after 5 min of no requests\n5. **PID file**: /tmp/claude-tts.pid for cleanup\n6. **Health check**: Simple ping/pong\n\n## Hook Client Logic\n```python\ndef speak_mlx(message: str):\n    try:\n        # Fast path: daemon running\n        sock = connect_daemon()\n        sock.send(json.dumps({\"text\": message}))\n        sock.recv()  # wait for completion\n    except (ConnectionRefused, FileNotFoundError):\n        # Daemon not running - start it, use direct API this time\n        start_daemon_background()\n        speak_mlx_direct(message)\n```\n\n## Files to Create/Modify\n- scripts/tts-daemon.py (new)\n- scripts/tts-notify.py (add client logic)\n- DEV.md (document daemon management)\n\n## Acceptance Criteria\n- [ ] Daemon starts automatically on first TTS\n- [ ] Subsequent TTS calls complete in \u003c1s\n- [ ] Daemon shuts down after 5 min idle\n- [ ] Graceful fallback if daemon crashes\n- [ ] Logs to logs/tts-daemon.log","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-24T15:51:54.004142-08:00","updated_at":"2025-12-24T15:51:54.004142-08:00","dependencies":[{"issue_id":"mlx-tts-5x9","depends_on_id":"mlx-tts-dno","type":"blocks","created_at":"2025-12-24T15:52:10.264515-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-df0","title":"Migrate to direct mlx_audio Python API","description":"## Goal\nReplace subprocess-based MLX TTS with direct Python API calls. Enable model caching via background daemon for sub-second response times.\n\n## Current Problem\nEach TTS call forks a process and loads ~4GB model from scratch. Latency is 5-10+ seconds.\n\n## Target Architecture\nBackground daemon keeps model warm. Hook sends text via Unix socket. Response in \u003c1 second (warm).\n\n## Success Metrics\n- Warm latency: \u003c1s from trigger to audio\n- Cold start: \u003c10s (acceptable for first call)\n- Memory: Auto-free after 5 min idle","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-24T15:51:13.414815-08:00","updated_at":"2025-12-24T15:51:13.414815-08:00","dependencies":[{"issue_id":"mlx-tts-df0","depends_on_id":"mlx-tts-5x9","type":"blocks","created_at":"2025-12-24T15:52:10.341169-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-dno","title":"Implement direct mlx_audio API calls","description":"## Objective\nReplace subprocess.run() with direct Python imports in speak_mlx().\n\n## Current Code (lines 201-227)\n```python\nsubprocess.run([\n    sys.executable, '-m', 'mlx_audio.tts.generate',\n    '--model', MLX_MODEL,\n    '--text', message,\n    '--ref_audio', MLX_VOICE_REF,\n    '--speed', str(MLX_SPEED),\n    '--play'\n])\n```\n\n## Target Code\n```python\n# Use findings from API research task\nfrom mlx_audio.tts import ...\n\ndef speak_mlx(message: str):\n    model = load_model(MLX_MODEL)  # or cached\n    audio = model.generate(text=message, ref_audio=MLX_VOICE_REF, speed=MLX_SPEED)\n    audio.play()\n```\n\n## Acceptance Criteria\n- [ ] No subprocess.run for MLX generation\n- [ ] Fallback to macOS say still works\n- [ ] Measure and document latency (cold vs warm within same process)\n- [ ] Error handling preserves current behavior\n\n## Files to Modify\n- scripts/tts-notify.py","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-24T15:51:53.806082-08:00","updated_at":"2025-12-24T15:51:53.806082-08:00","dependencies":[{"issue_id":"mlx-tts-dno","depends_on_id":"mlx-tts-sqn","type":"blocks","created_at":"2025-12-24T15:52:10.187281-08:00","created_by":"daemon"}]}
{"id":"mlx-tts-sqn","title":"Research mlx_audio Python API","description":"## Objective\nDocument the direct Python API for mlx_audio TTS generation.\n\n## Tasks\n1. Find programmatic API (not CLI wrapper)\n2. Identify key functions:\n   - Model loading: how to load/cache the model object\n   - Generation: how to generate audio from text\n   - Playback: how to play audio (or save to file)\n3. Check HuggingFace model loading patterns\n4. Document memory footprint and loading time\n\n## Expected Output\n```python\n# Document actual API here:\nfrom mlx_audio.tts import ???\n\n# Model loading\nmodel = ???\n\n# Generation\naudio = model.generate(text='...', ref_audio='...', speed=1.6)\n\n# Playback\naudio.play()  # or save()\n```\n\n## Resources\n- mlx_audio source: https://github.com/ml-explore/mlx-examples\n- Current CLI usage in scripts/tts-notify.py:201-227","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-24T15:51:28.00252-08:00","updated_at":"2025-12-24T15:51:28.00252-08:00"}
